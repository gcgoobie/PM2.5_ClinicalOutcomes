---
title: "NH4_MonthlySatData_2021_11_07"
author: "Gillian Goobie"
date: "07/11/2021"
output: 
  bookdown::html_document2:
    toc: yes
    toc_float: yes
    number_sections: yes
  html_document: 
    toc: yes
    toc_float: yes
    number_sections: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, message=FALSE, warning=FALSE, echo=F}
library(tidyverse)
library(readxl)
library(here)
library(writexl)
library(knitr)
library(lintr)
library(tidync)
library(maps)
library(ncmeta)
library(stars)
library(devtools)
library(RNetCDF)
library(raster)
library(ncdf4)
library(plotly)
library(RANN)
library(R.utils)
```

# Importing CARE Dataset
```{r}
outfile1 <- here::here("MonthlyNH4Data/CAREPF_fILD_PM25_BaselineData_2021_10_25.xlsx")
CARE <- read_excel(outfile1)
```

Remove any patients were lat or lon is missing
```{r}
CARE <- CARE %>% filter(!is.na(lat) & !is.na(lon))
#This removes no patients
```

New dataframe for CARE with lat/long
```{r}
S_coord <- CARE %>% dplyr::select(c("ID", "lon", "lat"))
```


# 2000
## January 2000
```{r}
outfile200001 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200001_200001.nc")
#gunzip(filename="/Users/gcgoobie/Documents/Research/PhD Research/Air Pollution Research/AirPollutionAnalysis/Satellite_NH4/MonthlyNH4Data/GWRwSPEC_NH4_NA_200001_200001.nc", destname="/Users/gcgoobie/Documents/Research/PhD Research/Air Pollution Research/AirPollutionAnalysis/Satellite_NH4/NH4_200001.nc")

PM_200001 <- nc_open(outfile200001)
print(PM_200001)
PM200001.array <- ncvar_get(PM_200001, "NH4")
dim(PM200001.array)
PM200001.array[1,1]
```

```{r}
lon <- ncvar_get(PM_200001, "LON")
lat <- ncvar_get(PM_200001, "LAT")
NH4 <- ncvar_get(PM_200001, "NH4")
```

Convert to a dataframe that you can look up PM2.5 mapped with lat/long coordinates (results in >42 million rows)
```{r}
jan00 <- raster(outfile200001, level=180, varname="NH4")
proj4string(jan00) <- CRS("+init=EPSG:4326")
df_jan00 <- raster::as.data.frame(jan00, xy=T)
```

```{r, eval=F}
#Example of a random selection of latitude and longitude coordinates with Jan 2000 PM2.5 estimates
df_jan00 %>% sample_n(12) %>% kable("html", row.names=F, col.names=c("Longitude", "Latitude", "PM2.5"), align="c")
```

Modify df_jan00 so that it matches CARE
```{r}
str(df_jan00)
df_jan00 <- df_jan00 %>% rename(c("lon"="x", "lat"="y"))
df_jan00$nrow <- seq.int(nrow(df_jan00))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jan00[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2000 <- left_join(match, df_jan00, by="nrow")
str(CARE_NH4_2000)
CARE_NH4_2000 <- CARE_NH4_2000 %>% rename(c("NH4_jan00"="NH4"))
```



## February 2000
```{r}
outfile200002 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200002_200002.nc")

feb00 <- raster(outfile200002, level=180, varname="NH4")
proj4string(feb00) <- CRS("+init=EPSG:4326")
df_feb00 <- raster::as.data.frame(feb00, xy=T)
```

Modify df_feb00 so that it matches CARE
```{r}
str(df_feb00)
df_feb00 <- df_feb00 %>% rename(c("lon"="x", "lat"="y"))
df_feb00$nrow <- seq.int(nrow(df_feb00))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_feb00[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2000 <- left_join(CARE_NH4_2000, df_feb00, by=c("nrow","lon","lat"))
str(CARE_NH4_2000)
CARE_NH4_2000 <- CARE_NH4_2000 %>% rename(c("NH4_feb00"="NH4"))
```

## March 2000
```{r}
outfile200003 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200003_200003.nc")

mar00 <- raster(outfile200003, level=180, varname="NH4")
proj4string(mar00) <- CRS("+init=EPSG:4326")
df_mar00 <- raster::as.data.frame(mar00, xy=T)
```

Modify df_mar00 so that it matches CARE
```{r}
str(df_mar00)
df_mar00 <- df_mar00 %>% rename(c("lon"="x", "lat"="y"))
df_mar00$nrow <- seq.int(nrow(df_mar00))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_mar00[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2000 <- left_join(CARE_NH4_2000, df_mar00, by=c("nrow","lon","lat"))
str(CARE_NH4_2000)
CARE_NH4_2000 <- CARE_NH4_2000 %>% rename(c("NH4_mar00"="NH4"))
```

## April 2000
```{r}
outfile200004 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200004_200004.nc")

apr00 <- raster(outfile200004, level=180, varname="NH4")
proj4string(apr00) <- CRS("+init=EPSG:4326")
df_apr00 <- raster::as.data.frame(apr00, xy=T)
```

Modify df_apr00 so that it matches CARE
```{r}
str(df_apr00)
df_apr00 <- df_apr00 %>% rename(c("lon"="x", "lat"="y"))
df_apr00$nrow <- seq.int(nrow(df_apr00))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_apr00[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2000 <- left_join(CARE_NH4_2000, df_apr00, by=c("nrow","lon","lat"))
str(CARE_NH4_2000)
CARE_NH4_2000 <- CARE_NH4_2000 %>% rename(c("NH4_apr00"="NH4"))
```

## May 2000
```{r}
outfile200005 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200005_200005.nc")

may00 <- raster(outfile200005, level=180, varname="NH4")
proj4string(may00) <- CRS("+init=EPSG:4326")
df_may00 <- raster::as.data.frame(may00, xy=T)
```

Modify df_may00 so that it matches CARE
```{r}
str(df_may00)
df_may00 <- df_may00 %>% rename(c("lon"="x", "lat"="y"))
df_may00$nrow <- seq.int(nrow(df_may00))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_may00[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2000 <- left_join(CARE_NH4_2000, df_may00, by=c("nrow","lon","lat"))
str(CARE_NH4_2000)
CARE_NH4_2000 <- CARE_NH4_2000 %>% rename(c("NH4_may00"="NH4"))
```

## June 2000
```{r}
outfile200006 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200006_200006.nc")

jun00 <- raster(outfile200006, level=180, varname="NH4")
proj4string(jun00) <- CRS("+init=EPSG:4326")
df_jun00 <- raster::as.data.frame(jun00, xy=T)
```

Modify df_jun00 so that it matches CARE
```{r}
str(df_jun00)
df_jun00 <- df_jun00 %>% rename(c("lon"="x", "lat"="y"))
df_jun00$nrow <- seq.int(nrow(df_jun00))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jun00[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2000 <- left_join(CARE_NH4_2000, df_jun00, by=c("nrow","lon","lat"))
str(CARE_NH4_2000)
CARE_NH4_2000 <- CARE_NH4_2000 %>% rename(c("NH4_jun00"="NH4"))
```

## July 2000
```{r}
outfile200007 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200007_200007.nc")

jul00 <- raster(outfile200007, level=180, varname="NH4")
proj4string(jul00) <- CRS("+init=EPSG:4326")
df_jul00 <- raster::as.data.frame(jul00, xy=T)
```

Modify df_jul00 so that it matches CARE
```{r}
str(df_jul00)
df_jul00 <- df_jul00 %>% rename(c("lon"="x", "lat"="y"))
df_jul00$nrow <- seq.int(nrow(df_jul00))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jul00[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2000 <- left_join(CARE_NH4_2000, df_jul00, by=c("nrow","lon","lat"))
str(CARE_NH4_2000)
CARE_NH4_2000 <- CARE_NH4_2000 %>% rename(c("NH4_jul00"="NH4"))
```

## August 2000
```{r}
outfile200008 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200008_200008.nc")

aug00 <- raster(outfile200008, level=180, varname="NH4")
proj4string(aug00) <- CRS("+init=EPSG:4326")
df_aug00 <- raster::as.data.frame(aug00, xy=T)
```

Modify df_aug00 so that it matches CARE
```{r}
str(df_aug00)
df_aug00 <- df_aug00 %>% rename(c("lon"="x", "lat"="y"))
df_aug00$nrow <- seq.int(nrow(df_aug00))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_aug00[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2000 <- left_join(CARE_NH4_2000, df_aug00, by=c("nrow","lon","lat"))
str(CARE_NH4_2000)
CARE_NH4_2000 <- CARE_NH4_2000 %>% rename(c("NH4_aug00"="NH4"))
```

## September 2000
```{r}
outfile200009 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200009_200009.nc")

sep00 <- raster(outfile200009, level=180, varname="NH4")
proj4string(sep00) <- CRS("+init=EPSG:4326")
df_sep00 <- raster::as.data.frame(sep00, xy=T)
```

Modify df_sep00 so that it matches CARE
```{r}
str(df_sep00)
df_sep00 <- df_sep00 %>% rename(c("lon"="x", "lat"="y"))
df_sep00$nrow <- seq.int(nrow(df_sep00))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_sep00[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2000 <- left_join(CARE_NH4_2000, df_sep00, by=c("nrow","lon","lat"))
str(CARE_NH4_2000)
CARE_NH4_2000 <- CARE_NH4_2000 %>% rename(c("NH4_sep00"="NH4"))
```

## October 2000
```{r}
outfile200010 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200010_200010.nc")

oct00 <- raster(outfile200010, level=180, varname="NH4")
proj4string(oct00) <- CRS("+init=EPSG:4326")
df_oct00 <- raster::as.data.frame(oct00, xy=T)
```

Modify df_oct00 so that it matches CARE
```{r}
str(df_oct00)
df_oct00 <- df_oct00 %>% rename(c("lon"="x", "lat"="y"))
df_oct00$nrow <- seq.int(nrow(df_oct00))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_oct00[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2000 <- left_join(CARE_NH4_2000, df_oct00, by=c("nrow","lon","lat"))
str(CARE_NH4_2000)
CARE_NH4_2000 <- CARE_NH4_2000 %>% rename(c("NH4_oct00"="NH4"))
```

## November 2000
```{r}
outfile200011 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200011_200011.nc")

nov00 <- raster(outfile200011, level=180, varname="NH4")
proj4string(nov00) <- CRS("+init=EPSG:4326")
df_nov00 <- raster::as.data.frame(nov00, xy=T)
```

Modify df_nov00 so that it matches CARE
```{r}
str(df_nov00)
df_nov00 <- df_nov00 %>% rename(c("lon"="x", "lat"="y"))
df_nov00$nrow <- seq.int(nrow(df_nov00))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_nov00[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2000 <- left_join(CARE_NH4_2000, df_nov00, by=c("nrow","lon","lat"))
str(CARE_NH4_2000)
CARE_NH4_2000 <- CARE_NH4_2000 %>% rename(c("NH4_nov00"="NH4"))
```

## Remove dataframes not in use
First we need to remove objects not in use in order to create space for our file
```{r}
#Removing files that we don't need anymore
rm(lat, lon, jan00, feb00, mar00, apr00, may00, jun00, jul00, aug00, sep00, oct00, nov00, PM_200001, PM200001.array, NH4)

#Then can remove objects that fit a certain pattern - i.e. those starting with outfile
rm(list=ls(, pattern="^outfile2"))
rm(list=ls(,pattern="^df_"))
```

## December 2000
```{r}
outfile200012 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200012_200012.nc")

dec00 <- raster(outfile200012, level=180, varname="NH4")
proj4string(dec00) <- CRS("+init=EPSG:4326")
df_dec00 <- raster::as.data.frame(dec00, xy=T)
```

Modify df_dec00 so that it matches CARE
```{r}
str(df_dec00)
df_dec00 <- df_dec00 %>% rename(c("lon"="x", "lat"="y"))
df_dec00$nrow <- seq.int(nrow(df_dec00))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_dec00[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2000 <- left_join(CARE_NH4_2000, df_dec00, by=c("nrow","lon","lat"))
str(CARE_NH4_2000)
CARE_NH4_2000 <- CARE_NH4_2000 %>% rename(c("NH4_dec00"="NH4"))
```

## Remove dataframes not in use
```{r}
#Then can remove objects that fit a certain pattern - i.e. those starting with outfile
rm(list=ls(, pattern="^outfile2"))

rm(list=ls(,pattern="^df_"))
```

## Make Excel file for year 2000
```{r}
write_xlsx(CARE_NH4_2000, path="CARE_fILD_2000_NH4_2021_11_05.xlsx")
system("say Just finished!")
```


# 2001
## January 2001
```{r}
outfile200101 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200101_200101.nc")

jan01 <- raster(outfile200101, level=180, varname="NH4")
proj4string(jan01) <- CRS("+init=EPSG:4326")
df_jan01 <- raster::as.data.frame(jan01, xy=T)
```

Modify df_jan01 so that it matches CARE
```{r}
str(df_jan01)
df_jan01 <- df_jan01 %>% rename(c("lon"="x", "lat"="y"))
df_jan01$nrow <- seq.int(nrow(df_jan01))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jan01[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2001 <- left_join(match, df_jan01, by="nrow")
str(CARE_NH4_2001)
CARE_NH4_2001 <- CARE_NH4_2001 %>% rename(c("NH4_jan01"="NH4"))
```



## February 2001
```{r}
outfile200102 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200102_200102.nc")

feb01 <- raster(outfile200102, level=180, varname="NH4")
proj4string(feb01) <- CRS("+init=EPSG:4326")
df_feb01 <- raster::as.data.frame(feb01, xy=T)
```

Modify df_feb01 so that it matches CARE
```{r}
str(df_feb01)
df_feb01 <- df_feb01 %>% rename(c("lon"="x", "lat"="y"))
df_feb01$nrow <- seq.int(nrow(df_feb01))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_feb01[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2001 <- left_join(CARE_NH4_2001, df_feb01, by=c("nrow","lon","lat"))
str(CARE_NH4_2001)
CARE_NH4_2001 <- CARE_NH4_2001 %>% rename(c("NH4_feb01"="NH4"))
```

## March 2001
```{r}
outfile200103 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200103_200103.nc")

mar01 <- raster(outfile200103, level=180, varname="NH4")
proj4string(mar01) <- CRS("+init=EPSG:4326")
df_mar01 <- raster::as.data.frame(mar01, xy=T)
```

Modify df_mar01 so that it matches CARE
```{r}
str(df_mar01)
df_mar01 <- df_mar01 %>% rename(c("lon"="x", "lat"="y"))
df_mar01$nrow <- seq.int(nrow(df_mar01))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_mar01[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2001 <- left_join(CARE_NH4_2001, df_mar01, by=c("nrow","lon","lat"))
str(CARE_NH4_2001)
CARE_NH4_2001 <- CARE_NH4_2001 %>% rename(c("NH4_mar01"="NH4"))
```

## April 2001
```{r}
outfile200104 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200104_200104.nc")

apr01 <- raster(outfile200104, level=180, varname="NH4")
proj4string(apr01) <- CRS("+init=EPSG:4326")
df_apr01 <- raster::as.data.frame(apr01, xy=T)
```

Modify df_apr01 so that it matches CARE
```{r}
str(df_apr01)
df_apr01 <- df_apr01 %>% rename(c("lon"="x", "lat"="y"))
df_apr01$nrow <- seq.int(nrow(df_apr01))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_apr01[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2001 <- left_join(CARE_NH4_2001, df_apr01, by=c("nrow","lon","lat"))
str(CARE_NH4_2001)
CARE_NH4_2001 <- CARE_NH4_2001 %>% rename(c("NH4_apr01"="NH4"))
```

## May 2001
```{r}
outfile200105 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200105_200105.nc")

may01 <- raster(outfile200105, level=180, varname="NH4")
proj4string(may01) <- CRS("+init=EPSG:4326")
df_may01 <- raster::as.data.frame(may01, xy=T)
```

Modify df_may01 so that it matches CARE
```{r}
str(df_may01)
df_may01 <- df_may01 %>% rename(c("lon"="x", "lat"="y"))
df_may01$nrow <- seq.int(nrow(df_may01))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_may01[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2001 <- left_join(CARE_NH4_2001, df_may01, by=c("nrow","lon","lat"))
str(CARE_NH4_2001)
CARE_NH4_2001 <- CARE_NH4_2001 %>% rename(c("NH4_may01"="NH4"))
```

## June 2001
```{r}
outfile200106 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200106_200106.nc")

jun01 <- raster(outfile200106, level=180, varname="NH4")
proj4string(jun01) <- CRS("+init=EPSG:4326")
df_jun01 <- raster::as.data.frame(jun01, xy=T)
```

Modify df_jun01 so that it matches CARE
```{r}
str(df_jun01)
df_jun01 <- df_jun01 %>% rename(c("lon"="x", "lat"="y"))
df_jun01$nrow <- seq.int(nrow(df_jun01))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jun01[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2001 <- left_join(CARE_NH4_2001, df_jun01, by=c("nrow","lon","lat"))
str(CARE_NH4_2001)
CARE_NH4_2001 <- CARE_NH4_2001 %>% rename(c("NH4_jun01"="NH4"))
```

## July 2001
```{r}
outfile200107 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200107_200107.nc")

jul01 <- raster(outfile200107, level=180, varname="NH4")
proj4string(jul01) <- CRS("+init=EPSG:4326")
df_jul01 <- raster::as.data.frame(jul01, xy=T)
```

Modify df_jul01 so that it matches CARE
```{r}
str(df_jul01)
df_jul01 <- df_jul01 %>% rename(c("lon"="x", "lat"="y"))
df_jul01$nrow <- seq.int(nrow(df_jul01))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jul01[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2001 <- left_join(CARE_NH4_2001, df_jul01, by=c("nrow","lon","lat"))
str(CARE_NH4_2001)
CARE_NH4_2001 <- CARE_NH4_2001 %>% rename(c("NH4_jul01"="NH4"))
```

## August 2001
```{r}
outfile200108 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200108_200108.nc")

aug01 <- raster(outfile200108, level=180, varname="NH4")
proj4string(aug01) <- CRS("+init=EPSG:4326")
df_aug01 <- raster::as.data.frame(aug01, xy=T)
```

Modify df_aug01 so that it matches CARE
```{r}
str(df_aug01)
df_aug01 <- df_aug01 %>% rename(c("lon"="x", "lat"="y"))
df_aug01$nrow <- seq.int(nrow(df_aug01))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_aug01[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2001 <- left_join(CARE_NH4_2001, df_aug01, by=c("nrow","lon","lat"))
str(CARE_NH4_2001)
CARE_NH4_2001 <- CARE_NH4_2001 %>% rename(c("NH4_aug01"="NH4"))
```

## September 2001
```{r}
outfile200109 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200109_200109.nc")

sep01 <- raster(outfile200109, level=180, varname="NH4")
proj4string(sep01) <- CRS("+init=EPSG:4326")
df_sep01 <- raster::as.data.frame(sep01, xy=T)
```

Modify df_sep01 so that it matches CARE
```{r}
str(df_sep01)
df_sep01 <- df_sep01 %>% rename(c("lon"="x", "lat"="y"))
df_sep01$nrow <- seq.int(nrow(df_sep01))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_sep01[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2001 <- left_join(CARE_NH4_2001, df_sep01, by=c("nrow","lon","lat"))
str(CARE_NH4_2001)
CARE_NH4_2001 <- CARE_NH4_2001 %>% rename(c("NH4_sep01"="NH4"))
```

## October 2001
```{r}
outfile200110 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200110_200110.nc")

oct01 <- raster(outfile200110, level=180, varname="NH4")
proj4string(oct01) <- CRS("+init=EPSG:4326")
df_oct01 <- raster::as.data.frame(oct01, xy=T)
```

Modify df_oct01 so that it matches CARE
```{r}
str(df_oct01)
df_oct01 <- df_oct01 %>% rename(c("lon"="x", "lat"="y"))
df_oct01$nrow <- seq.int(nrow(df_oct01))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_oct01[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2001 <- left_join(CARE_NH4_2001, df_oct01, by=c("nrow","lon","lat"))
str(CARE_NH4_2001)
CARE_NH4_2001 <- CARE_NH4_2001 %>% rename(c("NH4_oct01"="NH4"))
```

## November 2001
```{r}
outfile200111 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200111_200111.nc")

nov01 <- raster(outfile200111, level=180, varname="NH4")
proj4string(nov01) <- CRS("+init=EPSG:4326")
df_nov01 <- raster::as.data.frame(nov01, xy=T)
```

Modify df_nov01 so that it matches CARE
```{r}
str(df_nov01)
df_nov01 <- df_nov01 %>% rename(c("lon"="x", "lat"="y"))
df_nov01$nrow <- seq.int(nrow(df_nov01))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_nov01[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2001 <- left_join(CARE_NH4_2001, df_nov01, by=c("nrow","lon","lat"))
str(CARE_NH4_2001)
CARE_NH4_2001 <- CARE_NH4_2001 %>% rename(c("NH4_nov01"="NH4"))
```

## Remove dataframes not in use
First we need to remove objects not in use in order to create space for our file
```{r}
#Removing files that we don't need anymore
rm(dec00, jan01, feb01, mar01, apr01, may01, jun01, jul01, aug01, sep01, oct01, nov01, dec01)

#Then can remove objects that fit a certain pattern - i.e. those starting with outfile
rm(list=ls(, pattern="^outfile2"))
rm(list=ls(,pattern="^df_"))
```

## December 2001
```{r}
outfile200112 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200112_200112.nc")

dec01 <- raster(outfile200112, level=180, varname="NH4")
proj4string(dec01) <- CRS("+init=EPSG:4326")
df_dec01 <- raster::as.data.frame(dec01, xy=T)
```

Modify df_dec01 so that it matches CARE
```{r}
str(df_dec01)
df_dec01 <- df_dec01 %>% rename(c("lon"="x", "lat"="y"))
df_dec01$nrow <- seq.int(nrow(df_dec01))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_dec01[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2001 <- left_join(CARE_NH4_2001, df_dec01, by=c("nrow","lon","lat"))
str(CARE_NH4_2001)
CARE_NH4_2001 <- CARE_NH4_2001 %>% rename(c("NH4_dec01"="NH4"))
```


## Remove dataframes not in use
```{r}
#Then can remove objects that fit a certain pattern - i.e. those starting with outfile
rm(list=ls(, pattern="^outfile2"))

rm(list=ls(,pattern="^df_"))
```

## Make Excel file for year 2001
```{r}
write_xlsx(CARE_NH4_2001, path="CARE_fILD_2001_NH4_2021_11_05.xlsx")
system("say Just finished!")
```

# 2002
## January 2002
```{r}
outfile200201 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200201_200201.nc")

jan02 <- raster(outfile200201, level=180, varname="NH4")
proj4string(jan02) <- CRS("+init=EPSG:4326")
df_jan02 <- raster::as.data.frame(jan02, xy=T)
```

Modify df_jan02 so that it matches CARE
```{r}
str(df_jan02)
df_jan02 <- df_jan02 %>% rename(c("lon"="x", "lat"="y"))
df_jan02$nrow <- seq.int(nrow(df_jan02))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jan02[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2002 <- left_join(match, df_jan02, by="nrow")
str(CARE_NH4_2002)
CARE_NH4_2002 <- CARE_NH4_2002 %>% rename(c("NH4_jan02"="NH4"))
```


## February 2002
```{r}
outfile200202 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200202_200202.nc")

feb02 <- raster(outfile200202, level=180, varname="NH4")
proj4string(feb02) <- CRS("+init=EPSG:4326")
df_feb02 <- raster::as.data.frame(feb02, xy=T)
```

Modify df_feb02 so that it matches CARE
```{r}
str(df_feb02)
df_feb02 <- df_feb02 %>% rename(c("lon"="x", "lat"="y"))
df_feb02$nrow <- seq.int(nrow(df_feb02))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_feb02[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2002 <- left_join(CARE_NH4_2002, df_feb02, by=c("nrow","lon","lat"))
str(CARE_NH4_2002)
CARE_NH4_2002 <- CARE_NH4_2002 %>% rename(c("NH4_feb02"="NH4"))
```

## March 2002
```{r}
outfile200203 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200203_200203.nc")

mar02 <- raster(outfile200203, level=180, varname="NH4")
proj4string(mar02) <- CRS("+init=EPSG:4326")
df_mar02 <- raster::as.data.frame(mar02, xy=T)
```

Modify df_mar02 so that it matches CARE
```{r}
str(df_mar02)
df_mar02 <- df_mar02 %>% rename(c("lon"="x", "lat"="y"))
df_mar02$nrow <- seq.int(nrow(df_mar02))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_mar02[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2002 <- left_join(CARE_NH4_2002, df_mar02, by=c("nrow","lon","lat"))
str(CARE_NH4_2002)
CARE_NH4_2002 <- CARE_NH4_2002 %>% rename(c("NH4_mar02"="NH4"))
```

## April 2002
```{r}
outfile200204 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200204_200204.nc")

apr02 <- raster(outfile200204, level=180, varname="NH4")
proj4string(apr02) <- CRS("+init=EPSG:4326")
df_apr02 <- raster::as.data.frame(apr02, xy=T)
```

Modify df_apr02 so that it matches CARE
```{r}
str(df_apr02)
df_apr02 <- df_apr02 %>% rename(c("lon"="x", "lat"="y"))
df_apr02$nrow <- seq.int(nrow(df_apr02))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_apr02[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2002 <- left_join(CARE_NH4_2002, df_apr02, by=c("nrow","lon","lat"))
str(CARE_NH4_2002)
CARE_NH4_2002 <- CARE_NH4_2002 %>% rename(c("NH4_apr02"="NH4"))
```

## May 2002
```{r}
outfile200205 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200205_200205.nc")

may02 <- raster(outfile200205, level=180, varname="NH4")
proj4string(may02) <- CRS("+init=EPSG:4326")
df_may02 <- raster::as.data.frame(may02, xy=T)
```

Modify df_may02 so that it matches CARE
```{r}
str(df_may02)
df_may02 <- df_may02 %>% rename(c("lon"="x", "lat"="y"))
df_may02$nrow <- seq.int(nrow(df_may02))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_may02[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2002 <- left_join(CARE_NH4_2002, df_may02, by=c("nrow","lon","lat"))
str(CARE_NH4_2002)
CARE_NH4_2002 <- CARE_NH4_2002 %>% rename(c("NH4_may02"="NH4"))
```

## June 2002
```{r}
outfile200206 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200206_200206.nc")

jun02 <- raster(outfile200206, level=180, varname="NH4")
proj4string(jun02) <- CRS("+init=EPSG:4326")
df_jun02 <- raster::as.data.frame(jun02, xy=T)
```

Modify df_jun02 so that it matches CARE
```{r}
str(df_jun02)
df_jun02 <- df_jun02 %>% rename(c("lon"="x", "lat"="y"))
df_jun02$nrow <- seq.int(nrow(df_jun02))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jun02[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2002 <- left_join(CARE_NH4_2002, df_jun02, by=c("nrow","lon","lat"))
str(CARE_NH4_2002)
CARE_NH4_2002 <- CARE_NH4_2002 %>% rename(c("NH4_jun02"="NH4"))
```

## July 2002
```{r}
outfile200207 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200207_200207.nc")

jul02 <- raster(outfile200207, level=180, varname="NH4")
proj4string(jul02) <- CRS("+init=EPSG:4326")
df_jul02 <- raster::as.data.frame(jul02, xy=T)
```

Modify df_jul02 so that it matches CARE
```{r}
str(df_jul02)
df_jul02 <- df_jul02 %>% rename(c("lon"="x", "lat"="y"))
df_jul02$nrow <- seq.int(nrow(df_jul02))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jul02[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2002 <- left_join(CARE_NH4_2002, df_jul02, by=c("nrow","lon","lat"))
str(CARE_NH4_2002)
CARE_NH4_2002 <- CARE_NH4_2002 %>% rename(c("NH4_jul02"="NH4"))
```

## August 2002
```{r}
outfile200208 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200208_200208.nc")

aug02 <- raster(outfile200208, level=180, varname="NH4")
proj4string(aug02) <- CRS("+init=EPSG:4326")
df_aug02 <- raster::as.data.frame(aug02, xy=T)
```

Modify df_aug02 so that it matches CARE
```{r}
str(df_aug02)
df_aug02 <- df_aug02 %>% rename(c("lon"="x", "lat"="y"))
df_aug02$nrow <- seq.int(nrow(df_aug02))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_aug02[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2002 <- left_join(CARE_NH4_2002, df_aug02, by=c("nrow","lon","lat"))
str(CARE_NH4_2002)
CARE_NH4_2002 <- CARE_NH4_2002 %>% rename(c("NH4_aug02"="NH4"))
```

## September 2002
```{r}
outfile200209 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200209_200209.nc")

sep02 <- raster(outfile200209, level=180, varname="NH4")
proj4string(sep02) <- CRS("+init=EPSG:4326")
df_sep02 <- raster::as.data.frame(sep02, xy=T)
```

Modify df_sep02 so that it matches CARE
```{r}
str(df_sep02)
df_sep02 <- df_sep02 %>% rename(c("lon"="x", "lat"="y"))
df_sep02$nrow <- seq.int(nrow(df_sep02))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_sep02[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2002 <- left_join(CARE_NH4_2002, df_sep02, by=c("nrow","lon","lat"))
str(CARE_NH4_2002)
CARE_NH4_2002 <- CARE_NH4_2002 %>% rename(c("NH4_sep02"="NH4"))
```

## October 2002
```{r}
outfile200210 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200210_200210.nc")

oct02 <- raster(outfile200210, level=180, varname="NH4")
proj4string(oct02) <- CRS("+init=EPSG:4326")
df_oct02 <- raster::as.data.frame(oct02, xy=T)
```

Modify df_oct02 so that it matches CARE
```{r}
str(df_oct02)
df_oct02 <- df_oct02 %>% rename(c("lon"="x", "lat"="y"))
df_oct02$nrow <- seq.int(nrow(df_oct02))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_oct02[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2002 <- left_join(CARE_NH4_2002, df_oct02, by=c("nrow","lon","lat"))
str(CARE_NH4_2002)
CARE_NH4_2002 <- CARE_NH4_2002 %>% rename(c("NH4_oct02"="NH4"))
```

## November 2002
```{r}
outfile200211 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200211_200211.nc")

nov02 <- raster(outfile200211, level=180, varname="NH4")
proj4string(nov02) <- CRS("+init=EPSG:4326")
df_nov02 <- raster::as.data.frame(nov02, xy=T)
```

Modify df_nov02 so that it matches CARE
```{r}
str(df_nov02)
df_nov02 <- df_nov02 %>% rename(c("lon"="x", "lat"="y"))
df_nov02$nrow <- seq.int(nrow(df_nov02))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_nov02[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2002 <- left_join(CARE_NH4_2002, df_nov02, by=c("nrow","lon","lat"))
str(CARE_NH4_2002)
CARE_NH4_2002 <- CARE_NH4_2002 %>% rename(c("NH4_nov02"="NH4"))
```

## Remove dataframes not in use
First we need to remove objects not in use in order to create space for our file
```{r}
#Removing files that we don't need anymore
rm(dec01, jan02, feb02, mar02, apr02, may02, jun02, jul02, aug02, sep02, oct02, nov02, dec02)

#Then can remove objects that fit a certain pattern - i.e. those starting with outfile
rm(list=ls(, pattern="^outfile2"))
rm(list=ls(,pattern="^df_"))
```

## December 2002
```{r}
outfile200212 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200212_200212.nc")

dec02 <- raster(outfile200212, level=180, varname="NH4")
proj4string(dec02) <- CRS("+init=EPSG:4326")
df_dec02 <- raster::as.data.frame(dec02, xy=T)
```

Modify df_dec02 so that it matches CARE
```{r}
str(df_dec02)
df_dec02 <- df_dec02 %>% rename(c("lon"="x", "lat"="y"))
df_dec02$nrow <- seq.int(nrow(df_dec02))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_dec02[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2002 <- left_join(CARE_NH4_2002, df_dec02, by=c("nrow","lon","lat"))
str(CARE_NH4_2002)
CARE_NH4_2002 <- CARE_NH4_2002 %>% rename(c("NH4_dec02"="NH4"))
```

## Remove dataframes not in use
```{r}
#Then can remove objects that fit a certain pattern - i.e. those starting with outfile
rm(list=ls(, pattern="^outfile2"))

rm(list=ls(,pattern="^df_"))
```

## Make Excel file for year 2002
```{r}
write_xlsx(CARE_NH4_2002, path="CARE_fILD_2002_NH4_2021_11_05.xlsx")
system("say Just finished!")
```

# 2003
## January 2003
```{r}
outfile200301 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200301_200301.nc")

jan03 <- raster(outfile200301, level=180, varname="NH4")
proj4string(jan03) <- CRS("+init=EPSG:4326")
df_jan03 <- raster::as.data.frame(jan03, xy=T)
```

Modify df_jan03 so that it matches CARE
```{r}
str(df_jan03)
df_jan03 <- df_jan03 %>% rename(c("lon"="x", "lat"="y"))
df_jan03$nrow <- seq.int(nrow(df_jan03))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jan03[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2003 <- left_join(match, df_jan03, by="nrow")
str(CARE_NH4_2003)
CARE_NH4_2003 <- CARE_NH4_2003 %>% rename(c("NH4_jan03"="NH4"))
```

## February 2003
```{r}
outfile200302 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200302_200302.nc")

feb03 <- raster(outfile200302, level=180, varname="NH4")
proj4string(feb03) <- CRS("+init=EPSG:4326")
df_feb03 <- raster::as.data.frame(feb03, xy=T)
```

Modify df_feb03 so that it matches CARE
```{r}
str(df_feb03)
df_feb03 <- df_feb03 %>% rename(c("lon"="x", "lat"="y"))
df_feb03$nrow <- seq.int(nrow(df_feb03))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_feb03[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2003 <- left_join(CARE_NH4_2003, df_feb03, by=c("nrow","lon","lat"))
str(CARE_NH4_2003)
CARE_NH4_2003 <- CARE_NH4_2003 %>% rename(c("NH4_feb03"="NH4"))
```

## March 2003
```{r}
outfile200303 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200303_200303.nc")

mar03 <- raster(outfile200303, level=180, varname="NH4")
proj4string(mar03) <- CRS("+init=EPSG:4326")
df_mar03 <- raster::as.data.frame(mar03, xy=T)
```

Modify df_mar03 so that it matches CARE
```{r}
str(df_mar03)
df_mar03 <- df_mar03 %>% rename(c("lon"="x", "lat"="y"))
df_mar03$nrow <- seq.int(nrow(df_mar03))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_mar03[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2003 <- left_join(CARE_NH4_2003, df_mar03, by=c("nrow","lon","lat"))
str(CARE_NH4_2003)
CARE_NH4_2003 <- CARE_NH4_2003 %>% rename(c("NH4_mar03"="NH4"))
```

## April 2003
```{r}
outfile200304 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200304_200304.nc")

apr03 <- raster(outfile200304, level=180, varname="NH4")
proj4string(apr03) <- CRS("+init=EPSG:4326")
df_apr03 <- raster::as.data.frame(apr03, xy=T)
```

Modify df_apr03 so that it matches CARE
```{r}
str(df_apr03)
df_apr03 <- df_apr03 %>% rename(c("lon"="x", "lat"="y"))
df_apr03$nrow <- seq.int(nrow(df_apr03))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_apr03[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2003 <- left_join(CARE_NH4_2003, df_apr03, by=c("nrow","lon","lat"))
str(CARE_NH4_2003)
CARE_NH4_2003 <- CARE_NH4_2003 %>% rename(c("NH4_apr03"="NH4"))
```

## May 2003
```{r}
outfile200305 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200305_200305.nc")

may03 <- raster(outfile200305, level=180, varname="NH4")
proj4string(may03) <- CRS("+init=EPSG:4326")
df_may03 <- raster::as.data.frame(may03, xy=T)
```

Modify df_may03 so that it matches CARE
```{r}
str(df_may03)
df_may03 <- df_may03 %>% rename(c("lon"="x", "lat"="y"))
df_may03$nrow <- seq.int(nrow(df_may03))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_may03[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2003 <- left_join(CARE_NH4_2003, df_may03, by=c("nrow","lon","lat"))
str(CARE_NH4_2003)
CARE_NH4_2003 <- CARE_NH4_2003 %>% rename(c("NH4_may03"="NH4"))
```

## June 2003
```{r}
outfile200306 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200306_200306.nc")

jun03 <- raster(outfile200306, level=180, varname="NH4")
proj4string(jun03) <- CRS("+init=EPSG:4326")
df_jun03 <- raster::as.data.frame(jun03, xy=T)
```

Modify df_jun03 so that it matches CARE
```{r}
str(df_jun03)
df_jun03 <- df_jun03 %>% rename(c("lon"="x", "lat"="y"))
df_jun03$nrow <- seq.int(nrow(df_jun03))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jun03[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2003 <- left_join(CARE_NH4_2003, df_jun03, by=c("nrow","lon","lat"))
str(CARE_NH4_2003)
CARE_NH4_2003 <- CARE_NH4_2003 %>% rename(c("NH4_jun03"="NH4"))
```

## July 2003
```{r}
outfile200307 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200307_200307.nc")

jul03 <- raster(outfile200307, level=180, varname="NH4")
proj4string(jul03) <- CRS("+init=EPSG:4326")
df_jul03 <- raster::as.data.frame(jul03, xy=T)
```

Modify df_jul03 so that it matches CARE
```{r}
str(df_jul03)
df_jul03 <- df_jul03 %>% rename(c("lon"="x", "lat"="y"))
df_jul03$nrow <- seq.int(nrow(df_jul03))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jul03[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2003 <- left_join(CARE_NH4_2003, df_jul03, by=c("nrow","lon","lat"))
str(CARE_NH4_2003)
CARE_NH4_2003 <- CARE_NH4_2003 %>% rename(c("NH4_jul03"="NH4"))
```

## August 2003
```{r}
outfile200308 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200308_200308.nc")

aug03 <- raster(outfile200308, level=180, varname="NH4")
proj4string(aug03) <- CRS("+init=EPSG:4326")
df_aug03 <- raster::as.data.frame(aug03, xy=T)
```

Modify df_aug03 so that it matches CARE
```{r}
str(df_aug03)
df_aug03 <- df_aug03 %>% rename(c("lon"="x", "lat"="y"))
df_aug03$nrow <- seq.int(nrow(df_aug03))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_aug03[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2003 <- left_join(CARE_NH4_2003, df_aug03, by=c("nrow","lon","lat"))
str(CARE_NH4_2003)
CARE_NH4_2003 <- CARE_NH4_2003 %>% rename(c("NH4_aug03"="NH4"))
```

## September 2003
```{r}
outfile200309 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200309_200309.nc")

sep03 <- raster(outfile200309, level=180, varname="NH4")
proj4string(sep03) <- CRS("+init=EPSG:4326")
df_sep03 <- raster::as.data.frame(sep03, xy=T)
```

Modify df_sep03 so that it matches CARE
```{r}
str(df_sep03)
df_sep03 <- df_sep03 %>% rename(c("lon"="x", "lat"="y"))
df_sep03$nrow <- seq.int(nrow(df_sep03))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_sep03[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2003 <- left_join(CARE_NH4_2003, df_sep03, by=c("nrow","lon","lat"))
str(CARE_NH4_2003)
CARE_NH4_2003 <- CARE_NH4_2003 %>% rename(c("NH4_sep03"="NH4"))
```

## October 2003
```{r}
outfile200310 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200310_200310.nc")

oct03 <- raster(outfile200310, level=180, varname="NH4")
proj4string(oct03) <- CRS("+init=EPSG:4326")
df_oct03 <- raster::as.data.frame(oct03, xy=T)
```

Modify df_oct03 so that it matches CARE
```{r}
str(df_oct03)
df_oct03 <- df_oct03 %>% rename(c("lon"="x", "lat"="y"))
df_oct03$nrow <- seq.int(nrow(df_oct03))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_oct03[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2003 <- left_join(CARE_NH4_2003, df_oct03, by=c("nrow","lon","lat"))
str(CARE_NH4_2003)
CARE_NH4_2003 <- CARE_NH4_2003 %>% rename(c("NH4_oct03"="NH4"))
```

## November 2003
```{r}
outfile200311 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200311_200311.nc")

nov03 <- raster(outfile200311, level=180, varname="NH4")
proj4string(nov03) <- CRS("+init=EPSG:4326")
df_nov03 <- raster::as.data.frame(nov03, xy=T)
```

Modify df_nov03 so that it matches CARE
```{r}
str(df_nov03)
df_nov03 <- df_nov03 %>% rename(c("lon"="x", "lat"="y"))
df_nov03$nrow <- seq.int(nrow(df_nov03))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_nov03[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2003 <- left_join(CARE_NH4_2003, df_nov03, by=c("nrow","lon","lat"))
str(CARE_NH4_2003)
CARE_NH4_2003 <- CARE_NH4_2003 %>% rename(c("NH4_nov03"="NH4"))
```

## Remove dataframes not in use
First we need to remove objects not in use in order to create space for our file
```{r}
#Removing files that we don't need anymore
rm(dec02, jan03, feb03, mar03, apr03, may03, jun03, jul03, aug03, sep03, oct03, nov03, dec03)

#Then can remove objects that fit a certain pattern - i.e. those starting with outfile
rm(list=ls(, pattern="^outfile2"))
rm(list=ls(,pattern="^df_"))
```

## December 2003
```{r}
outfile200312 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200312_200312.nc")

dec03 <- raster(outfile200312, level=180, varname="NH4")
proj4string(dec03) <- CRS("+init=EPSG:4326")
df_dec03 <- raster::as.data.frame(dec03, xy=T)
```

Modify df_dec03 so that it matches CARE
```{r}
str(df_dec03)
df_dec03 <- df_dec03 %>% rename(c("lon"="x", "lat"="y"))
df_dec03$nrow <- seq.int(nrow(df_dec03))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_dec03[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2003 <- left_join(CARE_NH4_2003, df_dec03, by=c("nrow","lon","lat"))
str(CARE_NH4_2003)
CARE_NH4_2003 <- CARE_NH4_2003 %>% rename(c("NH4_dec03"="NH4"))
```

## Remove dataframes not in use
```{r}
#Then can remove objects that fit a certain pattern - i.e. those starting with outfile
rm(list=ls(, pattern="^outfile2"))

rm(list=ls(,pattern="^df_"))
```

## Make Excel file for year 2003
```{r}
write_xlsx(CARE_NH4_2003, path="CARE_fILD_2003_NH4_2021_11_05.xlsx")
system("say Just finished!")
```

# 2004
## January 2004
```{r}
outfile200401 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200401_200401.nc")

jan04 <- raster(outfile200401, level=180, varname="NH4")
proj4string(jan04) <- CRS("+init=EPSG:4326")
df_jan04 <- raster::as.data.frame(jan04, xy=T)
```

Modify df_jan04 so that it matches CARE
```{r}
str(df_jan04)
df_jan04 <- df_jan04 %>% rename(c("lon"="x", "lat"="y"))
df_jan04$nrow <- seq.int(nrow(df_jan04))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jan04[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2004 <- left_join(match, df_jan04, by="nrow")
str(CARE_NH4_2004)
CARE_NH4_2004 <- CARE_NH4_2004 %>% rename(c("NH4_jan04"="NH4"))
```

## February 2004
```{r}
outfile200402 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200402_200402.nc")

feb04 <- raster(outfile200402, level=180, varname="NH4")
proj4string(feb04) <- CRS("+init=EPSG:4326")
df_feb04 <- raster::as.data.frame(feb04, xy=T)
```

Modify df_feb04 so that it matches CARE
```{r}
str(df_feb04)
df_feb04 <- df_feb04 %>% rename(c("lon"="x", "lat"="y"))
df_feb04$nrow <- seq.int(nrow(df_feb04))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_feb04[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2004 <- left_join(CARE_NH4_2004, df_feb04, by=c("nrow","lon","lat"))
str(CARE_NH4_2004)
CARE_NH4_2004 <- CARE_NH4_2004 %>% rename(c("NH4_feb04"="NH4"))
```

## March 2004
```{r}
outfile200403 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200403_200403.nc")

mar04 <- raster(outfile200403, level=180, varname="NH4")
proj4string(mar04) <- CRS("+init=EPSG:4326")
df_mar04 <- raster::as.data.frame(mar04, xy=T)
```

Modify df_mar04 so that it matches CARE
```{r}
str(df_mar04)
df_mar04 <- df_mar04 %>% rename(c("lon"="x", "lat"="y"))
df_mar04$nrow <- seq.int(nrow(df_mar04))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_mar04[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2004 <- left_join(CARE_NH4_2004, df_mar04, by=c("nrow","lon","lat"))
str(CARE_NH4_2004)
CARE_NH4_2004 <- CARE_NH4_2004 %>% rename(c("NH4_mar04"="NH4"))
```

## April 2004
```{r}
outfile200404 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200404_200404.nc")

apr04 <- raster(outfile200404, level=180, varname="NH4")
proj4string(apr04) <- CRS("+init=EPSG:4326")
df_apr04 <- raster::as.data.frame(apr04, xy=T)
```

Modify df_apr04 so that it matches CARE
```{r}
str(df_apr04)
df_apr04 <- df_apr04 %>% rename(c("lon"="x", "lat"="y"))
df_apr04$nrow <- seq.int(nrow(df_apr04))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_apr04[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2004 <- left_join(CARE_NH4_2004, df_apr04, by=c("nrow","lon","lat"))
str(CARE_NH4_2004)
CARE_NH4_2004 <- CARE_NH4_2004 %>% rename(c("NH4_apr04"="NH4"))
```

## May 2004
```{r}
outfile200405 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200405_200405.nc")

may04 <- raster(outfile200405, level=180, varname="NH4")
proj4string(may04) <- CRS("+init=EPSG:4326")
df_may04 <- raster::as.data.frame(may04, xy=T)
```

Modify df_may04 so that it matches CARE
```{r}
str(df_may04)
df_may04 <- df_may04 %>% rename(c("lon"="x", "lat"="y"))
df_may04$nrow <- seq.int(nrow(df_may04))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_may04[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2004 <- left_join(CARE_NH4_2004, df_may04, by=c("nrow","lon","lat"))
str(CARE_NH4_2004)
CARE_NH4_2004 <- CARE_NH4_2004 %>% rename(c("NH4_may04"="NH4"))
```

## June 2004
```{r}
outfile200406 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200406_200406.nc")

jun04 <- raster(outfile200406, level=180, varname="NH4")
proj4string(jun04) <- CRS("+init=EPSG:4326")
df_jun04 <- raster::as.data.frame(jun04, xy=T)
```

Modify df_jun04 so that it matches CARE
```{r}
str(df_jun04)
df_jun04 <- df_jun04 %>% rename(c("lon"="x", "lat"="y"))
df_jun04$nrow <- seq.int(nrow(df_jun04))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jun04[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2004 <- left_join(CARE_NH4_2004, df_jun04, by=c("nrow","lon","lat"))
str(CARE_NH4_2004)
CARE_NH4_2004 <- CARE_NH4_2004 %>% rename(c("NH4_jun04"="NH4"))
```

## July 2004
```{r}
outfile200407 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200407_200407.nc")

jul04 <- raster(outfile200407, level=180, varname="NH4")
proj4string(jul04) <- CRS("+init=EPSG:4326")
df_jul04 <- raster::as.data.frame(jul04, xy=T)
```

Modify df_jul04 so that it matches CARE
```{r}
str(df_jul04)
df_jul04 <- df_jul04 %>% rename(c("lon"="x", "lat"="y"))
df_jul04$nrow <- seq.int(nrow(df_jul04))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jul04[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2004 <- left_join(CARE_NH4_2004, df_jul04, by=c("nrow","lon","lat"))
str(CARE_NH4_2004)
CARE_NH4_2004 <- CARE_NH4_2004 %>% rename(c("NH4_jul04"="NH4"))
```

## August 2004
```{r}
outfile200408 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200408_200408.nc")

aug04 <- raster(outfile200408, level=180, varname="NH4")
proj4string(aug04) <- CRS("+init=EPSG:4326")
df_aug04 <- raster::as.data.frame(aug04, xy=T)
```

Modify df_aug04 so that it matches CARE
```{r}
str(df_aug04)
df_aug04 <- df_aug04 %>% rename(c("lon"="x", "lat"="y"))
df_aug04$nrow <- seq.int(nrow(df_aug04))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_aug04[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2004 <- left_join(CARE_NH4_2004, df_aug04, by=c("nrow","lon","lat"))
str(CARE_NH4_2004)
CARE_NH4_2004 <- CARE_NH4_2004 %>% rename(c("NH4_aug04"="NH4"))
```

## September 2004
```{r}
outfile200409 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200409_200409.nc")

sep04 <- raster(outfile200409, level=180, varname="NH4")
proj4string(sep04) <- CRS("+init=EPSG:4326")
df_sep04 <- raster::as.data.frame(sep04, xy=T)
```

Modify df_sep04 so that it matches CARE
```{r}
str(df_sep04)
df_sep04 <- df_sep04 %>% rename(c("lon"="x", "lat"="y"))
df_sep04$nrow <- seq.int(nrow(df_sep04))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_sep04[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2004 <- left_join(CARE_NH4_2004, df_sep04, by=c("nrow","lon","lat"))
str(CARE_NH4_2004)
CARE_NH4_2004 <- CARE_NH4_2004 %>% rename(c("NH4_sep04"="NH4"))
```

## October 2004
```{r}
outfile200410 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200410_200410.nc")

oct04 <- raster(outfile200410, level=180, varname="NH4")
proj4string(oct04) <- CRS("+init=EPSG:4326")
df_oct04 <- raster::as.data.frame(oct04, xy=T)
```

Modify df_oct04 so that it matches CARE
```{r}
str(df_oct04)
df_oct04 <- df_oct04 %>% rename(c("lon"="x", "lat"="y"))
df_oct04$nrow <- seq.int(nrow(df_oct04))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_oct04[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2004 <- left_join(CARE_NH4_2004, df_oct04, by=c("nrow","lon","lat"))
str(CARE_NH4_2004)
CARE_NH4_2004 <- CARE_NH4_2004 %>% rename(c("NH4_oct04"="NH4"))
```

## November 2004
```{r}
outfile200411 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200411_200411.nc")

nov04 <- raster(outfile200411, level=180, varname="NH4")
proj4string(nov04) <- CRS("+init=EPSG:4326")
df_nov04 <- raster::as.data.frame(nov04, xy=T)
```

Modify df_nov04 so that it matches CARE
```{r}
str(df_nov04)
df_nov04 <- df_nov04 %>% rename(c("lon"="x", "lat"="y"))
df_nov04$nrow <- seq.int(nrow(df_nov04))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_nov04[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2004 <- left_join(CARE_NH4_2004, df_nov04, by=c("nrow","lon","lat"))
str(CARE_NH4_2004)
CARE_NH4_2004 <- CARE_NH4_2004 %>% rename(c("NH4_nov04"="NH4"))
```

## Remove dataframes not in use
First we need to remove objects not in use in order to create space for our file
```{r}
#Removing files that we don't need anymore
rm(dec03, jan04, feb04, mar04, apr04, may04, jun04, jul04, aug04, sep04, oct04, nov04, dec04)

#Then can remove objects that fit a certain pattern - i.e. those starting with outfile
rm(list=ls(, pattern="^outfile2"))
rm(list=ls(,pattern="^df_"))
```

## December 2004
```{r}
outfile200412 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200412_200412.nc")

dec04 <- raster(outfile200412, level=180, varname="NH4")
proj4string(dec04) <- CRS("+init=EPSG:4326")
df_dec04 <- raster::as.data.frame(dec04, xy=T)
```

Modify df_dec04 so that it matches CARE
```{r}
str(df_dec04)
df_dec04 <- df_dec04 %>% rename(c("lon"="x", "lat"="y"))
df_dec04$nrow <- seq.int(nrow(df_dec04))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_dec04[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2004 <- left_join(CARE_NH4_2004, df_dec04, by=c("nrow","lon","lat"))
str(CARE_NH4_2004)
CARE_NH4_2004 <- CARE_NH4_2004 %>% rename(c("NH4_dec04"="NH4"))
```


## Remove dataframes not in use
```{r}
#Then can remove objects that fit a certain pattern - i.e. those starting with outfile
rm(list=ls(, pattern="^outfile2"))

rm(list=ls(,pattern="^df_"))
```

## Make Excel file for year 2004
```{r}
write_xlsx(CARE_NH4_2004, path="CARE_fILD_2004_NH4_2021_11_05.xlsx")
system("say Just finished!")
```

# 2005
## January 2005
```{r}
outfile200501 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200501_200501.nc")

jan05 <- raster(outfile200501, level=180, varname="NH4")
proj4string(jan05) <- CRS("+init=EPSG:4326")
df_jan05 <- raster::as.data.frame(jan05, xy=T)
```

Modify df_jan05 so that it matches CARE
```{r}
str(df_jan05)
df_jan05 <- df_jan05 %>% rename(c("lon"="x", "lat"="y"))
df_jan05$nrow <- seq.int(nrow(df_jan05))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jan05[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2005 <- left_join(match, df_jan05, by="nrow")
str(CARE_NH4_2005)
CARE_NH4_2005 <- CARE_NH4_2005 %>% rename(c("NH4_jan05"="NH4"))
```

## February 2005
```{r}
outfile200502 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200502_200502.nc")

feb05 <- raster(outfile200502, level=180, varname="NH4")
proj4string(feb05) <- CRS("+init=EPSG:4326")
df_feb05 <- raster::as.data.frame(feb05, xy=T)
```

Modify df_feb05 so that it matches CARE
```{r}
str(df_feb05)
df_feb05 <- df_feb05 %>% rename(c("lon"="x", "lat"="y"))
df_feb05$nrow <- seq.int(nrow(df_feb05))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_feb05[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2005 <- left_join(CARE_NH4_2005, df_feb05, by=c("nrow","lon","lat"))
str(CARE_NH4_2005)
CARE_NH4_2005 <- CARE_NH4_2005 %>% rename(c("NH4_feb05"="NH4"))
```

## March 2005
```{r}
outfile200503 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200503_200503.nc")

mar05 <- raster(outfile200503, level=180, varname="NH4")
proj4string(mar05) <- CRS("+init=EPSG:4326")
df_mar05 <- raster::as.data.frame(mar05, xy=T)
```

Modify df_mar05 so that it matches CARE
```{r}
str(df_mar05)
df_mar05 <- df_mar05 %>% rename(c("lon"="x", "lat"="y"))
df_mar05$nrow <- seq.int(nrow(df_mar05))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_mar05[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2005 <- left_join(CARE_NH4_2005, df_mar05, by=c("nrow","lon","lat"))
str(CARE_NH4_2005)
CARE_NH4_2005 <- CARE_NH4_2005 %>% rename(c("NH4_mar05"="NH4"))
```

## April 2005
```{r}
outfile200504 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200504_200504.nc")

apr05 <- raster(outfile200504, level=180, varname="NH4")
proj4string(apr05) <- CRS("+init=EPSG:4326")
df_apr05 <- raster::as.data.frame(apr05, xy=T)
```

Modify df_apr05 so that it matches CARE
```{r}
str(df_apr05)
df_apr05 <- df_apr05 %>% rename(c("lon"="x", "lat"="y"))
df_apr05$nrow <- seq.int(nrow(df_apr05))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_apr05[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2005 <- left_join(CARE_NH4_2005, df_apr05, by=c("nrow","lon","lat"))
str(CARE_NH4_2005)
CARE_NH4_2005 <- CARE_NH4_2005 %>% rename(c("NH4_apr05"="NH4"))
```

## May 2005
```{r}
outfile200505 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200505_200505.nc")

may05 <- raster(outfile200505, level=180, varname="NH4")
proj4string(may05) <- CRS("+init=EPSG:4326")
df_may05 <- raster::as.data.frame(may05, xy=T)
```

Modify df_may05 so that it matches CARE
```{r}
str(df_may05)
df_may05 <- df_may05 %>% rename(c("lon"="x", "lat"="y"))
df_may05$nrow <- seq.int(nrow(df_may05))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_may05[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2005 <- left_join(CARE_NH4_2005, df_may05, by=c("nrow","lon","lat"))
str(CARE_NH4_2005)
CARE_NH4_2005 <- CARE_NH4_2005 %>% rename(c("NH4_may05"="NH4"))
```

## June 2005
```{r}
outfile200506 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200506_200506.nc")

jun05 <- raster(outfile200506, level=180, varname="NH4")
proj4string(jun05) <- CRS("+init=EPSG:4326")
df_jun05 <- raster::as.data.frame(jun05, xy=T)
```

Modify df_jun05 so that it matches CARE
```{r}
str(df_jun05)
df_jun05 <- df_jun05 %>% rename(c("lon"="x", "lat"="y"))
df_jun05$nrow <- seq.int(nrow(df_jun05))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jun05[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2005 <- left_join(CARE_NH4_2005, df_jun05, by=c("nrow","lon","lat"))
str(CARE_NH4_2005)
CARE_NH4_2005 <- CARE_NH4_2005 %>% rename(c("NH4_jun05"="NH4"))
```

## July 2005
```{r}
outfile200507 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200507_200507.nc")

jul05 <- raster(outfile200507, level=180, varname="NH4")
proj4string(jul05) <- CRS("+init=EPSG:4326")
df_jul05 <- raster::as.data.frame(jul05, xy=T)
```

Modify df_jul05 so that it matches CARE
```{r}
str(df_jul05)
df_jul05 <- df_jul05 %>% rename(c("lon"="x", "lat"="y"))
df_jul05$nrow <- seq.int(nrow(df_jul05))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jul05[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2005 <- left_join(CARE_NH4_2005, df_jul05, by=c("nrow","lon","lat"))
str(CARE_NH4_2005)
CARE_NH4_2005 <- CARE_NH4_2005 %>% rename(c("NH4_jul05"="NH4"))
```

## August 2005
```{r}
outfile200508 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200508_200508.nc")

aug05 <- raster(outfile200508, level=180, varname="NH4")
proj4string(aug05) <- CRS("+init=EPSG:4326")
df_aug05 <- raster::as.data.frame(aug05, xy=T)
```

Modify df_aug05 so that it matches CARE
```{r}
str(df_aug05)
df_aug05 <- df_aug05 %>% rename(c("lon"="x", "lat"="y"))
df_aug05$nrow <- seq.int(nrow(df_aug05))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_aug05[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2005 <- left_join(CARE_NH4_2005, df_aug05, by=c("nrow","lon","lat"))
str(CARE_NH4_2005)
CARE_NH4_2005 <- CARE_NH4_2005 %>% rename(c("NH4_aug05"="NH4"))
```

## September 2005
```{r}
outfile200509 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200509_200509.nc")

sep05 <- raster(outfile200509, level=180, varname="NH4")
proj4string(sep05) <- CRS("+init=EPSG:4326")
df_sep05 <- raster::as.data.frame(sep05, xy=T)
```

Modify df_sep05 so that it matches CARE
```{r}
str(df_sep05)
df_sep05 <- df_sep05 %>% rename(c("lon"="x", "lat"="y"))
df_sep05$nrow <- seq.int(nrow(df_sep05))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_sep05[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2005 <- left_join(CARE_NH4_2005, df_sep05, by=c("nrow","lon","lat"))
str(CARE_NH4_2005)
CARE_NH4_2005 <- CARE_NH4_2005 %>% rename(c("NH4_sep05"="NH4"))
```

## October 2005
```{r}
outfile200510 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200510_200510.nc")

oct05 <- raster(outfile200510, level=180, varname="NH4")
proj4string(oct05) <- CRS("+init=EPSG:4326")
df_oct05 <- raster::as.data.frame(oct05, xy=T)
```

Modify df_oct05 so that it matches CARE
```{r}
str(df_oct05)
df_oct05 <- df_oct05 %>% rename(c("lon"="x", "lat"="y"))
df_oct05$nrow <- seq.int(nrow(df_oct05))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_oct05[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2005 <- left_join(CARE_NH4_2005, df_oct05, by=c("nrow","lon","lat"))
str(CARE_NH4_2005)
CARE_NH4_2005 <- CARE_NH4_2005 %>% rename(c("NH4_oct05"="NH4"))
```

## November 2005
```{r}
outfile200511 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200511_200511.nc")

nov05 <- raster(outfile200511, level=180, varname="NH4")
proj4string(nov05) <- CRS("+init=EPSG:4326")
df_nov05 <- raster::as.data.frame(nov05, xy=T)
```

Modify df_nov05 so that it matches CARE
```{r}
str(df_nov05)
df_nov05 <- df_nov05 %>% rename(c("lon"="x", "lat"="y"))
df_nov05$nrow <- seq.int(nrow(df_nov05))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_nov05[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2005 <- left_join(CARE_NH4_2005, df_nov05, by=c("nrow","lon","lat"))
str(CARE_NH4_2005)
CARE_NH4_2005 <- CARE_NH4_2005 %>% rename(c("NH4_nov05"="NH4"))
```

## Remove dataframes not in use
First we need to remove objects not in use in order to create space for our file
```{r}
#Removing files that we don't need anymore
rm(dec04, jan05, feb05, mar05, apr05, may05, jun05, jul05, aug05, sep05, oct05, nov05, dec05)

#Then can remove objects that fit a certain pattern - i.e. those starting with outfile
rm(list=ls(, pattern="^outfile2"))
rm(list=ls(,pattern="^df_"))
```

## December 2005
```{r}
outfile200512 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200512_200512.nc")

dec05 <- raster(outfile200512, level=180, varname="NH4")
proj4string(dec05) <- CRS("+init=EPSG:4326")
df_dec05 <- raster::as.data.frame(dec05, xy=T)
```

Modify df_dec05 so that it matches CARE
```{r}
str(df_dec05)
df_dec05 <- df_dec05 %>% rename(c("lon"="x", "lat"="y"))
df_dec05$nrow <- seq.int(nrow(df_dec05))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_dec05[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2005 <- left_join(CARE_NH4_2005, df_dec05, by=c("nrow","lon","lat"))
str(CARE_NH4_2005)
CARE_NH4_2005 <- CARE_NH4_2005 %>% rename(c("NH4_dec05"="NH4"))
```


## Remove dataframes not in use
```{r}
#Then can remove objects that fit a certain pattern - i.e. those starting with outfile
rm(list=ls(, pattern="^outfile2"))

rm(list=ls(,pattern="^df_"))
```

## Make Excel file for year 2005
```{r}
write_xlsx(CARE_NH4_2005, path="CARE_fILD_2005_NH4_2021_11_05.xlsx")
system("say Just finished!")
```

# 2006
## January 2006
```{r}
outfile200601 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200601_200601.nc")

jan06 <- raster(outfile200601, level=180, varname="NH4")
proj4string(jan06) <- CRS("+init=EPSG:4326")
df_jan06 <- raster::as.data.frame(jan06, xy=T)
```

Modify df_jan06 so that it matches CARE
```{r}
str(df_jan06)
df_jan06 <- df_jan06 %>% rename(c("lon"="x", "lat"="y"))
df_jan06$nrow <- seq.int(nrow(df_jan06))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jan06[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2006 <- left_join(match, df_jan06, by="nrow")
str(CARE_NH4_2006)
CARE_NH4_2006 <- CARE_NH4_2006 %>% rename(c("NH4_jan06"="NH4"))
```

## February 2006
```{r}
outfile200602 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200602_200602.nc")

feb06 <- raster(outfile200602, level=180, varname="NH4")
proj4string(feb06) <- CRS("+init=EPSG:4326")
df_feb06 <- raster::as.data.frame(feb06, xy=T)
```

Modify df_feb06 so that it matches CARE
```{r}
str(df_feb06)
df_feb06 <- df_feb06 %>% rename(c("lon"="x", "lat"="y"))
df_feb06$nrow <- seq.int(nrow(df_feb06))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_feb06[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2006 <- left_join(CARE_NH4_2006, df_feb06, by=c("nrow","lon","lat"))
str(CARE_NH4_2006)
CARE_NH4_2006 <- CARE_NH4_2006 %>% rename(c("NH4_feb06"="NH4"))
```

## March 2006
```{r}
outfile200603 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200603_200603.nc")

mar06 <- raster(outfile200603, level=180, varname="NH4")
proj4string(mar06) <- CRS("+init=EPSG:4326")
df_mar06 <- raster::as.data.frame(mar06, xy=T)
```

Modify df_mar06 so that it matches CARE
```{r}
str(df_mar06)
df_mar06 <- df_mar06 %>% rename(c("lon"="x", "lat"="y"))
df_mar06$nrow <- seq.int(nrow(df_mar06))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_mar06[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2006 <- left_join(CARE_NH4_2006, df_mar06, by=c("nrow","lon","lat"))
str(CARE_NH4_2006)
CARE_NH4_2006 <- CARE_NH4_2006 %>% rename(c("NH4_mar06"="NH4"))
```

## April 2006
```{r}
outfile200604 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200604_200604.nc")

apr06 <- raster(outfile200604, level=180, varname="NH4")
proj4string(apr06) <- CRS("+init=EPSG:4326")
df_apr06 <- raster::as.data.frame(apr06, xy=T)
```

Modify df_apr06 so that it matches CARE
```{r}
str(df_apr06)
df_apr06 <- df_apr06 %>% rename(c("lon"="x", "lat"="y"))
df_apr06$nrow <- seq.int(nrow(df_apr06))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_apr06[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2006 <- left_join(CARE_NH4_2006, df_apr06, by=c("nrow","lon","lat"))
str(CARE_NH4_2006)
CARE_NH4_2006 <- CARE_NH4_2006 %>% rename(c("NH4_apr06"="NH4"))
```

## May 2006
```{r}
outfile200605 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200605_200605.nc")

may06 <- raster(outfile200605, level=180, varname="NH4")
proj4string(may06) <- CRS("+init=EPSG:4326")
df_may06 <- raster::as.data.frame(may06, xy=T)
```

Modify df_may06 so that it matches CARE
```{r}
str(df_may06)
df_may06 <- df_may06 %>% rename(c("lon"="x", "lat"="y"))
df_may06$nrow <- seq.int(nrow(df_may06))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_may06[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2006 <- left_join(CARE_NH4_2006, df_may06, by=c("nrow","lon","lat"))
str(CARE_NH4_2006)
CARE_NH4_2006 <- CARE_NH4_2006 %>% rename(c("NH4_may06"="NH4"))
```

## June 2006
```{r}
outfile200606 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200606_200606.nc")

jun06 <- raster(outfile200606, level=180, varname="NH4")
proj4string(jun06) <- CRS("+init=EPSG:4326")
df_jun06 <- raster::as.data.frame(jun06, xy=T)
```

Modify df_jun06 so that it matches CARE
```{r}
str(df_jun06)
df_jun06 <- df_jun06 %>% rename(c("lon"="x", "lat"="y"))
df_jun06$nrow <- seq.int(nrow(df_jun06))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jun06[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2006 <- left_join(CARE_NH4_2006, df_jun06, by=c("nrow","lon","lat"))
str(CARE_NH4_2006)
CARE_NH4_2006 <- CARE_NH4_2006 %>% rename(c("NH4_jun06"="NH4"))
```

## July 2006
```{r}
outfile200607 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200607_200607.nc")

jul06 <- raster(outfile200607, level=180, varname="NH4")
proj4string(jul06) <- CRS("+init=EPSG:4326")
df_jul06 <- raster::as.data.frame(jul06, xy=T)
```

Modify df_jul06 so that it matches CARE
```{r}
str(df_jul06)
df_jul06 <- df_jul06 %>% rename(c("lon"="x", "lat"="y"))
df_jul06$nrow <- seq.int(nrow(df_jul06))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jul06[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2006 <- left_join(CARE_NH4_2006, df_jul06, by=c("nrow","lon","lat"))
str(CARE_NH4_2006)
CARE_NH4_2006 <- CARE_NH4_2006 %>% rename(c("NH4_jul06"="NH4"))
```

## August 2006
```{r}
outfile200608 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200608_200608.nc")

aug06 <- raster(outfile200608, level=180, varname="NH4")
proj4string(aug06) <- CRS("+init=EPSG:4326")
df_aug06 <- raster::as.data.frame(aug06, xy=T)
```

Modify df_aug06 so that it matches CARE
```{r}
str(df_aug06)
df_aug06 <- df_aug06 %>% rename(c("lon"="x", "lat"="y"))
df_aug06$nrow <- seq.int(nrow(df_aug06))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_aug06[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2006 <- left_join(CARE_NH4_2006, df_aug06, by=c("nrow","lon","lat"))
str(CARE_NH4_2006)
CARE_NH4_2006 <- CARE_NH4_2006 %>% rename(c("NH4_aug06"="NH4"))
```

## September 2006
```{r}
outfile200609 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200609_200609.nc")

sep06 <- raster(outfile200609, level=180, varname="NH4")
proj4string(sep06) <- CRS("+init=EPSG:4326")
df_sep06 <- raster::as.data.frame(sep06, xy=T)
```

Modify df_sep06 so that it matches CARE
```{r}
str(df_sep06)
df_sep06 <- df_sep06 %>% rename(c("lon"="x", "lat"="y"))
df_sep06$nrow <- seq.int(nrow(df_sep06))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_sep06[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2006 <- left_join(CARE_NH4_2006, df_sep06, by=c("nrow","lon","lat"))
str(CARE_NH4_2006)
CARE_NH4_2006 <- CARE_NH4_2006 %>% rename(c("NH4_sep06"="NH4"))
```

## October 2006
```{r}
outfile200610 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200610_200610.nc")

oct06 <- raster(outfile200610, level=180, varname="NH4")
proj4string(oct06) <- CRS("+init=EPSG:4326")
df_oct06 <- raster::as.data.frame(oct06, xy=T)
```

Modify df_oct06 so that it matches CARE
```{r}
str(df_oct06)
df_oct06 <- df_oct06 %>% rename(c("lon"="x", "lat"="y"))
df_oct06$nrow <- seq.int(nrow(df_oct06))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_oct06[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2006 <- left_join(CARE_NH4_2006, df_oct06, by=c("nrow","lon","lat"))
str(CARE_NH4_2006)
CARE_NH4_2006 <- CARE_NH4_2006 %>% rename(c("NH4_oct06"="NH4"))
```

## November 2006
```{r}
outfile200611 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200611_200611.nc")

nov06 <- raster(outfile200611, level=180, varname="NH4")
proj4string(nov06) <- CRS("+init=EPSG:4326")
df_nov06 <- raster::as.data.frame(nov06, xy=T)
```

Modify df_nov06 so that it matches CARE
```{r}
str(df_nov06)
df_nov06 <- df_nov06 %>% rename(c("lon"="x", "lat"="y"))
df_nov06$nrow <- seq.int(nrow(df_nov06))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_nov06[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2006 <- left_join(CARE_NH4_2006, df_nov06, by=c("nrow","lon","lat"))
str(CARE_NH4_2006)
CARE_NH4_2006 <- CARE_NH4_2006 %>% rename(c("NH4_nov06"="NH4"))
```

## Remove dataframes not in use
First we need to remove objects not in use in order to create space for our file
```{r}
#Removing files that we don't need anymore
rm(dec05, jan06, feb06, mar06, apr06, may06, jun06, jul06, aug06, sep06, oct06, nov06, dec06)

#Then can remove objects that fit a certain pattern - i.e. those starting with outfile
rm(list=ls(, pattern="^outfile2"))
rm(list=ls(,pattern="^df_"))
```

## December 2006
```{r}
outfile200612 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200612_200612.nc")

dec06 <- raster(outfile200612, level=180, varname="NH4")
proj4string(dec06) <- CRS("+init=EPSG:4326")
df_dec06 <- raster::as.data.frame(dec06, xy=T)
```

Modify df_dec06 so that it matches CARE
```{r}
str(df_dec06)
df_dec06 <- df_dec06 %>% rename(c("lon"="x", "lat"="y"))
df_dec06$nrow <- seq.int(nrow(df_dec06))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_dec06[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2006 <- left_join(CARE_NH4_2006, df_dec06, by=c("nrow","lon","lat"))
str(CARE_NH4_2006)
CARE_NH4_2006 <- CARE_NH4_2006 %>% rename(c("NH4_dec06"="NH4"))
```


## Remove dataframes not in use
```{r}
#Then can remove objects that fit a certain pattern - i.e. those starting with outfile
rm(list=ls(, pattern="^outfile2"))

rm(list=ls(,pattern="^df_"))
```

## Make Excel file for year 2006
```{r}
write_xlsx(CARE_NH4_2006, path="CARE_fILD_2006_NH4_2021_11_05.xlsx")
system("say Just finished!")
```

# 2007
## January 2007
```{r}
outfile200701 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200701_200701.nc")

jan07 <- raster(outfile200701, level=180, varname="NH4")
proj4string(jan07) <- CRS("+init=EPSG:4326")
df_jan07 <- raster::as.data.frame(jan07, xy=T)
```

Modify df_jan07 so that it matches CARE
```{r}
str(df_jan07)
df_jan07 <- df_jan07 %>% rename(c("lon"="x", "lat"="y"))
df_jan07$nrow <- seq.int(nrow(df_jan07))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jan07[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2007 <- left_join(match, df_jan07, by="nrow")
str(CARE_NH4_2007)
CARE_NH4_2007 <- CARE_NH4_2007 %>% rename(c("NH4_jan07"="NH4"))
```

## February 2007
```{r}
outfile200702 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200702_200702.nc")

feb07 <- raster(outfile200702, level=180, varname="NH4")
proj4string(feb07) <- CRS("+init=EPSG:4326")
df_feb07 <- raster::as.data.frame(feb07, xy=T)
```

Modify df_feb07 so that it matches CARE
```{r}
str(df_feb07)
df_feb07 <- df_feb07 %>% rename(c("lon"="x", "lat"="y"))
df_feb07$nrow <- seq.int(nrow(df_feb07))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_feb07[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2007 <- left_join(CARE_NH4_2007, df_feb07, by=c("nrow","lon","lat"))
str(CARE_NH4_2007)
CARE_NH4_2007 <- CARE_NH4_2007 %>% rename(c("NH4_feb07"="NH4"))
```

## March 2007
```{r}
outfile200703 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200703_200703.nc")

mar07 <- raster(outfile200703, level=180, varname="NH4")
proj4string(mar07) <- CRS("+init=EPSG:4326")
df_mar07 <- raster::as.data.frame(mar07, xy=T)
```

Modify df_mar07 so that it matches CARE
```{r}
str(df_mar07)
df_mar07 <- df_mar07 %>% rename(c("lon"="x", "lat"="y"))
df_mar07$nrow <- seq.int(nrow(df_mar07))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_mar07[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2007 <- left_join(CARE_NH4_2007, df_mar07, by=c("nrow","lon","lat"))
str(CARE_NH4_2007)
CARE_NH4_2007 <- CARE_NH4_2007 %>% rename(c("NH4_mar07"="NH4"))
```

## April 2007
```{r}
outfile200704 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200704_200704.nc")

apr07 <- raster(outfile200704, level=180, varname="NH4")
proj4string(apr07) <- CRS("+init=EPSG:4326")
df_apr07 <- raster::as.data.frame(apr07, xy=T)
```

Modify df_apr07 so that it matches CARE
```{r}
str(df_apr07)
df_apr07 <- df_apr07 %>% rename(c("lon"="x", "lat"="y"))
df_apr07$nrow <- seq.int(nrow(df_apr07))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_apr07[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2007 <- left_join(CARE_NH4_2007, df_apr07, by=c("nrow","lon","lat"))
str(CARE_NH4_2007)
CARE_NH4_2007 <- CARE_NH4_2007 %>% rename(c("NH4_apr07"="NH4"))
```

## May 2007
```{r}
outfile200705 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200705_200705.nc")

may07 <- raster(outfile200705, level=180, varname="NH4")
proj4string(may07) <- CRS("+init=EPSG:4326")
df_may07 <- raster::as.data.frame(may07, xy=T)
```

Modify df_may07 so that it matches CARE
```{r}
str(df_may07)
df_may07 <- df_may07 %>% rename(c("lon"="x", "lat"="y"))
df_may07$nrow <- seq.int(nrow(df_may07))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_may07[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2007 <- left_join(CARE_NH4_2007, df_may07, by=c("nrow","lon","lat"))
str(CARE_NH4_2007)
CARE_NH4_2007 <- CARE_NH4_2007 %>% rename(c("NH4_may07"="NH4"))
```

## June 2007
```{r}
outfile200706 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200706_200706.nc")

jun07 <- raster(outfile200706, level=180, varname="NH4")
proj4string(jun07) <- CRS("+init=EPSG:4326")
df_jun07 <- raster::as.data.frame(jun07, xy=T)
```

Modify df_jun07 so that it matches CARE
```{r}
str(df_jun07)
df_jun07 <- df_jun07 %>% rename(c("lon"="x", "lat"="y"))
df_jun07$nrow <- seq.int(nrow(df_jun07))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jun07[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2007 <- left_join(CARE_NH4_2007, df_jun07, by=c("nrow","lon","lat"))
str(CARE_NH4_2007)
CARE_NH4_2007 <- CARE_NH4_2007 %>% rename(c("NH4_jun07"="NH4"))
```

## July 2007
```{r}
outfile200707 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200707_200707.nc")

jul07 <- raster(outfile200707, level=180, varname="NH4")
proj4string(jul07) <- CRS("+init=EPSG:4326")
df_jul07 <- raster::as.data.frame(jul07, xy=T)
```

Modify df_jul07 so that it matches CARE
```{r}
str(df_jul07)
df_jul07 <- df_jul07 %>% rename(c("lon"="x", "lat"="y"))
df_jul07$nrow <- seq.int(nrow(df_jul07))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jul07[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2007 <- left_join(CARE_NH4_2007, df_jul07, by=c("nrow","lon","lat"))
str(CARE_NH4_2007)
CARE_NH4_2007 <- CARE_NH4_2007 %>% rename(c("NH4_jul07"="NH4"))
```

## August 2007
```{r}
outfile200708 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200708_200708.nc")

aug07 <- raster(outfile200708, level=180, varname="NH4")
proj4string(aug07) <- CRS("+init=EPSG:4326")
df_aug07 <- raster::as.data.frame(aug07, xy=T)
```

Modify df_aug07 so that it matches CARE
```{r}
str(df_aug07)
df_aug07 <- df_aug07 %>% rename(c("lon"="x", "lat"="y"))
df_aug07$nrow <- seq.int(nrow(df_aug07))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_aug07[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2007 <- left_join(CARE_NH4_2007, df_aug07, by=c("nrow","lon","lat"))
str(CARE_NH4_2007)
CARE_NH4_2007 <- CARE_NH4_2007 %>% rename(c("NH4_aug07"="NH4"))
```

## September 2007
```{r}
outfile200709 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200709_200709.nc")

sep07 <- raster(outfile200709, level=180, varname="NH4")
proj4string(sep07) <- CRS("+init=EPSG:4326")
df_sep07 <- raster::as.data.frame(sep07, xy=T)
```

Modify df_sep07 so that it matches CARE
```{r}
str(df_sep07)
df_sep07 <- df_sep07 %>% rename(c("lon"="x", "lat"="y"))
df_sep07$nrow <- seq.int(nrow(df_sep07))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_sep07[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2007 <- left_join(CARE_NH4_2007, df_sep07, by=c("nrow","lon","lat"))
str(CARE_NH4_2007)
CARE_NH4_2007 <- CARE_NH4_2007 %>% rename(c("NH4_sep07"="NH4"))
```

## October 2007
```{r}
outfile200710 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200710_200710.nc")

oct07 <- raster(outfile200710, level=180, varname="NH4")
proj4string(oct07) <- CRS("+init=EPSG:4326")
df_oct07 <- raster::as.data.frame(oct07, xy=T)
```

Modify df_oct07 so that it matches CARE
```{r}
str(df_oct07)
df_oct07 <- df_oct07 %>% rename(c("lon"="x", "lat"="y"))
df_oct07$nrow <- seq.int(nrow(df_oct07))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_oct07[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2007 <- left_join(CARE_NH4_2007, df_oct07, by=c("nrow","lon","lat"))
str(CARE_NH4_2007)
CARE_NH4_2007 <- CARE_NH4_2007 %>% rename(c("NH4_oct07"="NH4"))
```

## November 2007
```{r}
outfile200711 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200711_200711.nc")

nov07 <- raster(outfile200711, level=180, varname="NH4")
proj4string(nov07) <- CRS("+init=EPSG:4326")
df_nov07 <- raster::as.data.frame(nov07, xy=T)
```

Modify df_nov07 so that it matches CARE
```{r}
str(df_nov07)
df_nov07 <- df_nov07 %>% rename(c("lon"="x", "lat"="y"))
df_nov07$nrow <- seq.int(nrow(df_nov07))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_nov07[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2007 <- left_join(CARE_NH4_2007, df_nov07, by=c("nrow","lon","lat"))
str(CARE_NH4_2007)
CARE_NH4_2007 <- CARE_NH4_2007 %>% rename(c("NH4_nov07"="NH4"))
```

## Remove dataframes not in use
First we need to remove objects not in use in order to create space for our file
```{r}
#Removing files that we don't need anymore
rm(dec06, jan07, feb07, mar07, apr07, may07, jun07, jul07, aug07, sep07, oct07, nov07, dec07)

#Then can remove objects that fit a certain pattern - i.e. those starting with outfile
rm(list=ls(, pattern="^outfile2"))
rm(list=ls(,pattern="^df_"))
```

## December 2007
```{r}
outfile200712 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200712_200712.nc")

dec07 <- raster(outfile200712, level=180, varname="NH4")
proj4string(dec07) <- CRS("+init=EPSG:4326")
df_dec07 <- raster::as.data.frame(dec07, xy=T)
```

Modify df_dec07 so that it matches CARE
```{r}
str(df_dec07)
df_dec07 <- df_dec07 %>% rename(c("lon"="x", "lat"="y"))
df_dec07$nrow <- seq.int(nrow(df_dec07))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_dec07[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2007 <- left_join(CARE_NH4_2007, df_dec07, by=c("nrow","lon","lat"))
str(CARE_NH4_2007)
CARE_NH4_2007 <- CARE_NH4_2007 %>% rename(c("NH4_dec07"="NH4"))
```

## Remove dataframes not in use
```{r}
#Then can remove objects that fit a certain pattern - i.e. those starting with outfile
rm(list=ls(, pattern="^outfile2"))

rm(list=ls(,pattern="^df_"))
```

## Make Excel file for year 2007
```{r}
write_xlsx(CARE_NH4_2007, path="CARE_fILD_2007_NH4_2021_11_05.xlsx")
system("say Just finished!")
```

# 2008
## January 2008
```{r}
outfile200801 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200801_200801.nc")

jan08 <- raster(outfile200801, level=180, varname="NH4")
proj4string(jan08) <- CRS("+init=EPSG:4326")
df_jan08 <- raster::as.data.frame(jan08, xy=T)
```

Modify df_jan08 so that it matches CARE
```{r}
str(df_jan08)
df_jan08 <- df_jan08 %>% rename(c("lon"="x", "lat"="y"))
df_jan08$nrow <- seq.int(nrow(df_jan08))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jan08[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2008 <- left_join(match, df_jan08, by="nrow")
str(CARE_NH4_2008)
CARE_NH4_2008 <- CARE_NH4_2008 %>% rename(c("NH4_jan08"="NH4"))
```

## February 2008
```{r}
outfile200802 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200802_200802.nc")

feb08 <- raster(outfile200802, level=180, varname="NH4")
proj4string(feb08) <- CRS("+init=EPSG:4326")
df_feb08 <- raster::as.data.frame(feb08, xy=T)
```

Modify df_feb08 so that it matches CARE
```{r}
str(df_feb08)
df_feb08 <- df_feb08 %>% rename(c("lon"="x", "lat"="y"))
df_feb08$nrow <- seq.int(nrow(df_feb08))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_feb08[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2008 <- left_join(CARE_NH4_2008, df_feb08, by=c("nrow","lon","lat"))
str(CARE_NH4_2008)
CARE_NH4_2008 <- CARE_NH4_2008 %>% rename(c("NH4_feb08"="NH4"))
```

## March 2008
```{r}
outfile200803 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200803_200803.nc")

mar08 <- raster(outfile200803, level=180, varname="NH4")
proj4string(mar08) <- CRS("+init=EPSG:4326")
df_mar08 <- raster::as.data.frame(mar08, xy=T)
```

Modify df_mar08 so that it matches CARE
```{r}
str(df_mar08)
df_mar08 <- df_mar08 %>% rename(c("lon"="x", "lat"="y"))
df_mar08$nrow <- seq.int(nrow(df_mar08))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_mar08[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2008 <- left_join(CARE_NH4_2008, df_mar08, by=c("nrow","lon","lat"))
str(CARE_NH4_2008)
CARE_NH4_2008 <- CARE_NH4_2008 %>% rename(c("NH4_mar08"="NH4"))
```

## April 2008
```{r}
outfile200804 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200804_200804.nc")

apr08 <- raster(outfile200804, level=180, varname="NH4")
proj4string(apr08) <- CRS("+init=EPSG:4326")
df_apr08 <- raster::as.data.frame(apr08, xy=T)
```

Modify df_apr08 so that it matches CARE
```{r}
str(df_apr08)
df_apr08 <- df_apr08 %>% rename(c("lon"="x", "lat"="y"))
df_apr08$nrow <- seq.int(nrow(df_apr08))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_apr08[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2008 <- left_join(CARE_NH4_2008, df_apr08, by=c("nrow","lon","lat"))
str(CARE_NH4_2008)
CARE_NH4_2008 <- CARE_NH4_2008 %>% rename(c("NH4_apr08"="NH4"))
```

## May 2008
```{r}
outfile200805 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200805_200805.nc")

may08 <- raster(outfile200805, level=180, varname="NH4")
proj4string(may08) <- CRS("+init=EPSG:4326")
df_may08 <- raster::as.data.frame(may08, xy=T)
```

Modify df_may08 so that it matches CARE
```{r}
str(df_may08)
df_may08 <- df_may08 %>% rename(c("lon"="x", "lat"="y"))
df_may08$nrow <- seq.int(nrow(df_may08))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_may08[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2008 <- left_join(CARE_NH4_2008, df_may08, by=c("nrow","lon","lat"))
str(CARE_NH4_2008)
CARE_NH4_2008 <- CARE_NH4_2008 %>% rename(c("NH4_may08"="NH4"))
```

## June 2008
```{r}
outfile200806 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200806_200806.nc")

jun08 <- raster(outfile200806, level=180, varname="NH4")
proj4string(jun08) <- CRS("+init=EPSG:4326")
df_jun08 <- raster::as.data.frame(jun08, xy=T)
```

Modify df_jun08 so that it matches CARE
```{r}
str(df_jun08)
df_jun08 <- df_jun08 %>% rename(c("lon"="x", "lat"="y"))
df_jun08$nrow <- seq.int(nrow(df_jun08))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jun08[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2008 <- left_join(CARE_NH4_2008, df_jun08, by=c("nrow","lon","lat"))
str(CARE_NH4_2008)
CARE_NH4_2008 <- CARE_NH4_2008 %>% rename(c("NH4_jun08"="NH4"))
```

## July 2008
```{r}
outfile200807 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200807_200807.nc")

jul08 <- raster(outfile200807, level=180, varname="NH4")
proj4string(jul08) <- CRS("+init=EPSG:4326")
df_jul08 <- raster::as.data.frame(jul08, xy=T)
```

Modify df_jul08 so that it matches CARE
```{r}
str(df_jul08)
df_jul08 <- df_jul08 %>% rename(c("lon"="x", "lat"="y"))
df_jul08$nrow <- seq.int(nrow(df_jul08))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jul08[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2008 <- left_join(CARE_NH4_2008, df_jul08, by=c("nrow","lon","lat"))
str(CARE_NH4_2008)
CARE_NH4_2008 <- CARE_NH4_2008 %>% rename(c("NH4_jul08"="NH4"))
```

## August 2008
```{r}
outfile200808 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200808_200808.nc")

aug08 <- raster(outfile200808, level=180, varname="NH4")
proj4string(aug08) <- CRS("+init=EPSG:4326")
df_aug08 <- raster::as.data.frame(aug08, xy=T)
```

Modify df_aug08 so that it matches CARE
```{r}
str(df_aug08)
df_aug08 <- df_aug08 %>% rename(c("lon"="x", "lat"="y"))
df_aug08$nrow <- seq.int(nrow(df_aug08))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_aug08[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2008 <- left_join(CARE_NH4_2008, df_aug08, by=c("nrow","lon","lat"))
str(CARE_NH4_2008)
CARE_NH4_2008 <- CARE_NH4_2008 %>% rename(c("NH4_aug08"="NH4"))
```

## September 2008
```{r}
outfile200809 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200809_200809.nc")

sep08 <- raster(outfile200809, level=180, varname="NH4")
proj4string(sep08) <- CRS("+init=EPSG:4326")
df_sep08 <- raster::as.data.frame(sep08, xy=T)
```

Modify df_sep08 so that it matches CARE
```{r}
str(df_sep08)
df_sep08 <- df_sep08 %>% rename(c("lon"="x", "lat"="y"))
df_sep08$nrow <- seq.int(nrow(df_sep08))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_sep08[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2008 <- left_join(CARE_NH4_2008, df_sep08, by=c("nrow","lon","lat"))
str(CARE_NH4_2008)
CARE_NH4_2008 <- CARE_NH4_2008 %>% rename(c("NH4_sep08"="NH4"))
```

## October 2008
```{r}
outfile200810 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200810_200810.nc")

oct08 <- raster(outfile200810, level=180, varname="NH4")
proj4string(oct08) <- CRS("+init=EPSG:4326")
df_oct08 <- raster::as.data.frame(oct08, xy=T)
```

Modify df_oct08 so that it matches CARE
```{r}
str(df_oct08)
df_oct08 <- df_oct08 %>% rename(c("lon"="x", "lat"="y"))
df_oct08$nrow <- seq.int(nrow(df_oct08))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_oct08[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2008 <- left_join(CARE_NH4_2008, df_oct08, by=c("nrow","lon","lat"))
str(CARE_NH4_2008)
CARE_NH4_2008 <- CARE_NH4_2008 %>% rename(c("NH4_oct08"="NH4"))
```

## November 2008
```{r}
outfile200811 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200811_200811.nc")

nov08 <- raster(outfile200811, level=180, varname="NH4")
proj4string(nov08) <- CRS("+init=EPSG:4326")
df_nov08 <- raster::as.data.frame(nov08, xy=T)
```

Modify df_nov08 so that it matches CARE
```{r}
str(df_nov08)
df_nov08 <- df_nov08 %>% rename(c("lon"="x", "lat"="y"))
df_nov08$nrow <- seq.int(nrow(df_nov08))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_nov08[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2008 <- left_join(CARE_NH4_2008, df_nov08, by=c("nrow","lon","lat"))
str(CARE_NH4_2008)
CARE_NH4_2008 <- CARE_NH4_2008 %>% rename(c("NH4_nov08"="NH4"))
```

## Remove dataframes not in use
First we need to remove objects not in use in order to create space for our file
```{r}
#Removing files that we don't need anymore
rm(dec07, jan08, feb08, mar08, apr08, may08, jun08, jul08, aug08, sep08, oct08, nov08, dec08)

#Then can remove objects that fit a certain pattern - i.e. those starting with outfile
rm(list=ls(, pattern="^outfile2"))
rm(list=ls(,pattern="^df_"))
```

## December 2008
```{r}
outfile200812 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200812_200812.nc")

dec08 <- raster(outfile200812, level=180, varname="NH4")
proj4string(dec08) <- CRS("+init=EPSG:4326")
df_dec08 <- raster::as.data.frame(dec08, xy=T)
```

Modify df_dec08 so that it matches CARE
```{r}
str(df_dec08)
df_dec08 <- df_dec08 %>% rename(c("lon"="x", "lat"="y"))
df_dec08$nrow <- seq.int(nrow(df_dec08))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_dec08[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2008 <- left_join(CARE_NH4_2008, df_dec08, by=c("nrow","lon","lat"))
str(CARE_NH4_2008)
CARE_NH4_2008 <- CARE_NH4_2008 %>% rename(c("NH4_dec08"="NH4"))
```

## Remove dataframes not in use
```{r}
#Then can remove objects that fit a certain pattern - i.e. those starting with outfile
rm(list=ls(, pattern="^outfile2"))

rm(list=ls(,pattern="^df_"))
```

## Make Excel file for year 2008
```{r}
write_xlsx(CARE_NH4_2008, path="CARE_fILD_2008_NH4_2021_11_05.xlsx")
system("say Just finished!")
```

# 2009
## January 2009
```{r}
outfile200901 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200901_200901.nc")

jan09 <- raster(outfile200901, level=180, varname="NH4")
proj4string(jan09) <- CRS("+init=EPSG:4326")
df_jan09 <- raster::as.data.frame(jan09, xy=T)
```

Modify df_jan09 so that it matches CARE
```{r}
str(df_jan09)
df_jan09 <- df_jan09 %>% rename(c("lon"="x", "lat"="y"))
df_jan09$nrow <- seq.int(nrow(df_jan09))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jan09[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2009 <- left_join(match, df_jan09, by="nrow")
str(CARE_NH4_2009)
CARE_NH4_2009 <- CARE_NH4_2009 %>% rename(c("NH4_jan09"="NH4"))
```

## February 2009
```{r}
outfile200902 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200902_200902.nc")

feb09 <- raster(outfile200902, level=180, varname="NH4")
proj4string(feb09) <- CRS("+init=EPSG:4326")
df_feb09 <- raster::as.data.frame(feb09, xy=T)
```

Modify df_feb09 so that it matches CARE
```{r}
str(df_feb09)
df_feb09 <- df_feb09 %>% rename(c("lon"="x", "lat"="y"))
df_feb09$nrow <- seq.int(nrow(df_feb09))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_feb09[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2009 <- left_join(CARE_NH4_2009, df_feb09, by=c("nrow","lon","lat"))
str(CARE_NH4_2009)
CARE_NH4_2009 <- CARE_NH4_2009 %>% rename(c("NH4_feb09"="NH4"))
```

## March 2009
```{r}
outfile200903 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200903_200903.nc")

mar09 <- raster(outfile200903, level=180, varname="NH4")
proj4string(mar09) <- CRS("+init=EPSG:4326")
df_mar09 <- raster::as.data.frame(mar09, xy=T)
```

Modify df_mar09 so that it matches CARE
```{r}
str(df_mar09)
df_mar09 <- df_mar09 %>% rename(c("lon"="x", "lat"="y"))
df_mar09$nrow <- seq.int(nrow(df_mar09))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_mar09[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2009 <- left_join(CARE_NH4_2009, df_mar09, by=c("nrow","lon","lat"))
str(CARE_NH4_2009)
CARE_NH4_2009 <- CARE_NH4_2009 %>% rename(c("NH4_mar09"="NH4"))
```

## April 2009
```{r}
outfile200904 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200904_200904.nc")

apr09 <- raster(outfile200904, level=180, varname="NH4")
proj4string(apr09) <- CRS("+init=EPSG:4326")
df_apr09 <- raster::as.data.frame(apr09, xy=T)
```

Modify df_apr09 so that it matches CARE
```{r}
str(df_apr09)
df_apr09 <- df_apr09 %>% rename(c("lon"="x", "lat"="y"))
df_apr09$nrow <- seq.int(nrow(df_apr09))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_apr09[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2009 <- left_join(CARE_NH4_2009, df_apr09, by=c("nrow","lon","lat"))
str(CARE_NH4_2009)
CARE_NH4_2009 <- CARE_NH4_2009 %>% rename(c("NH4_apr09"="NH4"))
```

## May 2009
```{r}
outfile200905 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200905_200905.nc")

may09 <- raster(outfile200905, level=180, varname="NH4")
proj4string(may09) <- CRS("+init=EPSG:4326")
df_may09 <- raster::as.data.frame(may09, xy=T)
```

Modify df_may09 so that it matches CARE
```{r}
str(df_may09)
df_may09 <- df_may09 %>% rename(c("lon"="x", "lat"="y"))
df_may09$nrow <- seq.int(nrow(df_may09))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_may09[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2009 <- left_join(CARE_NH4_2009, df_may09, by=c("nrow","lon","lat"))
str(CARE_NH4_2009)
CARE_NH4_2009 <- CARE_NH4_2009 %>% rename(c("NH4_may09"="NH4"))
```

## June 2009
```{r}
outfile200906 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200906_200906.nc")

jun09 <- raster(outfile200906, level=180, varname="NH4")
proj4string(jun09) <- CRS("+init=EPSG:4326")
df_jun09 <- raster::as.data.frame(jun09, xy=T)
```

Modify df_jun09 so that it matches CARE
```{r}
str(df_jun09)
df_jun09 <- df_jun09 %>% rename(c("lon"="x", "lat"="y"))
df_jun09$nrow <- seq.int(nrow(df_jun09))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jun09[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2009 <- left_join(CARE_NH4_2009, df_jun09, by=c("nrow","lon","lat"))
str(CARE_NH4_2009)
CARE_NH4_2009 <- CARE_NH4_2009 %>% rename(c("NH4_jun09"="NH4"))
```

## July 2009
```{r}
outfile200907 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200907_200907.nc")

jul09 <- raster(outfile200907, level=180, varname="NH4")
proj4string(jul09) <- CRS("+init=EPSG:4326")
df_jul09 <- raster::as.data.frame(jul09, xy=T)
```

Modify df_jul09 so that it matches CARE
```{r}
str(df_jul09)
df_jul09 <- df_jul09 %>% rename(c("lon"="x", "lat"="y"))
df_jul09$nrow <- seq.int(nrow(df_jul09))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jul09[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2009 <- left_join(CARE_NH4_2009, df_jul09, by=c("nrow","lon","lat"))
str(CARE_NH4_2009)
CARE_NH4_2009 <- CARE_NH4_2009 %>% rename(c("NH4_jul09"="NH4"))
```

## August 2009
```{r}
outfile200908 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200908_200908.nc")

aug09 <- raster(outfile200908, level=180, varname="NH4")
proj4string(aug09) <- CRS("+init=EPSG:4326")
df_aug09 <- raster::as.data.frame(aug09, xy=T)
```

Modify df_aug09 so that it matches CARE
```{r}
str(df_aug09)
df_aug09 <- df_aug09 %>% rename(c("lon"="x", "lat"="y"))
df_aug09$nrow <- seq.int(nrow(df_aug09))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_aug09[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2009 <- left_join(CARE_NH4_2009, df_aug09, by=c("nrow","lon","lat"))
str(CARE_NH4_2009)
CARE_NH4_2009 <- CARE_NH4_2009 %>% rename(c("NH4_aug09"="NH4"))
```

## September 2009
```{r}
outfile200909 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200909_200909.nc")

sep09 <- raster(outfile200909, level=180, varname="NH4")
proj4string(sep09) <- CRS("+init=EPSG:4326")
df_sep09 <- raster::as.data.frame(sep09, xy=T)
```

Modify df_sep09 so that it matches CARE
```{r}
str(df_sep09)
df_sep09 <- df_sep09 %>% rename(c("lon"="x", "lat"="y"))
df_sep09$nrow <- seq.int(nrow(df_sep09))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_sep09[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2009 <- left_join(CARE_NH4_2009, df_sep09, by=c("nrow","lon","lat"))
str(CARE_NH4_2009)
CARE_NH4_2009 <- CARE_NH4_2009 %>% rename(c("NH4_sep09"="NH4"))
```

## October 2009
```{r}
outfile200910 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200910_200910.nc")

oct09 <- raster(outfile200910, level=180, varname="NH4")
proj4string(oct09) <- CRS("+init=EPSG:4326")
df_oct09 <- raster::as.data.frame(oct09, xy=T)
```

Modify df_oct09 so that it matches CARE
```{r}
str(df_oct09)
df_oct09 <- df_oct09 %>% rename(c("lon"="x", "lat"="y"))
df_oct09$nrow <- seq.int(nrow(df_oct09))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_oct09[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2009 <- left_join(CARE_NH4_2009, df_oct09, by=c("nrow","lon","lat"))
str(CARE_NH4_2009)
CARE_NH4_2009 <- CARE_NH4_2009 %>% rename(c("NH4_oct09"="NH4"))
```

## November 2009
```{r}
outfile200911 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200911_200911.nc")

nov09 <- raster(outfile200911, level=180, varname="NH4")
proj4string(nov09) <- CRS("+init=EPSG:4326")
df_nov09 <- raster::as.data.frame(nov09, xy=T)
```

Modify df_nov09 so that it matches CARE
```{r}
str(df_nov09)
df_nov09 <- df_nov09 %>% rename(c("lon"="x", "lat"="y"))
df_nov09$nrow <- seq.int(nrow(df_nov09))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_nov09[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2009 <- left_join(CARE_NH4_2009, df_nov09, by=c("nrow","lon","lat"))
str(CARE_NH4_2009)
CARE_NH4_2009 <- CARE_NH4_2009 %>% rename(c("NH4_nov09"="NH4"))
```

## Remove dataframes not in use
First we need to remove objects not in use in order to create space for our file
```{r}
#Removing files that we don't need anymore
rm(dec08, jan09, feb09, mar09, apr09, may09, jun09, jul09, aug09, sep09, oct09, nov09, dec09)

#Then can remove objects that fit a certain pattern - i.e. those starting with outfile
rm(list=ls(, pattern="^outfile2"))
rm(list=ls(,pattern="^df_"))
```

## December 2009
```{r}
outfile200912 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_200912_200912.nc")

dec09 <- raster(outfile200912, level=180, varname="NH4")
proj4string(dec09) <- CRS("+init=EPSG:4326")
df_dec09 <- raster::as.data.frame(dec09, xy=T)
```

Modify df_dec09 so that it matches CARE
```{r}
str(df_dec09)
df_dec09 <- df_dec09 %>% rename(c("lon"="x", "lat"="y"))
df_dec09$nrow <- seq.int(nrow(df_dec09))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_dec09[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2009 <- left_join(CARE_NH4_2009, df_dec09, by=c("nrow","lon","lat"))
str(CARE_NH4_2009)
CARE_NH4_2009 <- CARE_NH4_2009 %>% rename(c("NH4_dec09"="NH4"))
```

## Remove dataframes not in use
```{r}
#Then can remove objects that fit a certain pattern - i.e. those starting with outfile
rm(list=ls(, pattern="^outfile2"))

rm(list=ls(,pattern="^df_"))
```

## Make Excel file for year 2009
```{r}
write_xlsx(CARE_NH4_2009, path="CARE_fILD_2009_NH4_2021_11_05.xlsx")
system("say Just finished!")
```

# 2010
## January 2010
```{r}
outfile201001 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201001_201001.nc")

jan10 <- raster(outfile201001, level=180, varname="NH4")
proj4string(jan10) <- CRS("+init=EPSG:4326")
df_jan10 <- raster::as.data.frame(jan10, xy=T)
```

Modify df_jan10 so that it matches CARE
```{r}
str(df_jan10)
df_jan10 <- df_jan10 %>% rename(c("lon"="x", "lat"="y"))
df_jan10$nrow <- seq.int(nrow(df_jan10))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jan10[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2010 <- left_join(match, df_jan10, by="nrow")
str(CARE_NH4_2010)
CARE_NH4_2010 <- CARE_NH4_2010 %>% rename(c("NH4_jan10"="NH4"))
```

## February 2010
```{r}
outfile201002 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201002_201002.nc")

feb10 <- raster(outfile201002, level=180, varname="NH4")
proj4string(feb10) <- CRS("+init=EPSG:4326")
df_feb10 <- raster::as.data.frame(feb10, xy=T)
```

Modify df_feb10 so that it matches CARE
```{r}
str(df_feb10)
df_feb10 <- df_feb10 %>% rename(c("lon"="x", "lat"="y"))
df_feb10$nrow <- seq.int(nrow(df_feb10))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_feb10[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2010 <- left_join(CARE_NH4_2010, df_feb10, by=c("nrow","lon","lat"))
str(CARE_NH4_2010)
CARE_NH4_2010 <- CARE_NH4_2010 %>% rename(c("NH4_feb10"="NH4"))
```

## March 2010
```{r}
outfile201003 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201003_201003.nc")

mar10 <- raster(outfile201003, level=180, varname="NH4")
proj4string(mar10) <- CRS("+init=EPSG:4326")
df_mar10 <- raster::as.data.frame(mar10, xy=T)
```

Modify df_mar10 so that it matches CARE
```{r}
str(df_mar10)
df_mar10 <- df_mar10 %>% rename(c("lon"="x", "lat"="y"))
df_mar10$nrow <- seq.int(nrow(df_mar10))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_mar10[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2010 <- left_join(CARE_NH4_2010, df_mar10, by=c("nrow","lon","lat"))
str(CARE_NH4_2010)
CARE_NH4_2010 <- CARE_NH4_2010 %>% rename(c("NH4_mar10"="NH4"))
```

## April 2010
```{r}
outfile201004 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201004_201004.nc")

apr10 <- raster(outfile201004, level=180, varname="NH4")
proj4string(apr10) <- CRS("+init=EPSG:4326")
df_apr10 <- raster::as.data.frame(apr10, xy=T)
```

Modify df_apr10 so that it matches CARE
```{r}
str(df_apr10)
df_apr10 <- df_apr10 %>% rename(c("lon"="x", "lat"="y"))
df_apr10$nrow <- seq.int(nrow(df_apr10))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_apr10[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2010 <- left_join(CARE_NH4_2010, df_apr10, by=c("nrow","lon","lat"))
str(CARE_NH4_2010)
CARE_NH4_2010 <- CARE_NH4_2010 %>% rename(c("NH4_apr10"="NH4"))
```

## May 2010
```{r}
outfile201005 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201005_201005.nc")

may10 <- raster(outfile201005, level=180, varname="NH4")
proj4string(may10) <- CRS("+init=EPSG:4326")
df_may10 <- raster::as.data.frame(may10, xy=T)
```

Modify df_may10 so that it matches CARE
```{r}
str(df_may10)
df_may10 <- df_may10 %>% rename(c("lon"="x", "lat"="y"))
df_may10$nrow <- seq.int(nrow(df_may10))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_may10[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2010 <- left_join(CARE_NH4_2010, df_may10, by=c("nrow","lon","lat"))
str(CARE_NH4_2010)
CARE_NH4_2010 <- CARE_NH4_2010 %>% rename(c("NH4_may10"="NH4"))
```

## June 2010
```{r}
outfile201006 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201006_201006.nc")

jun10 <- raster(outfile201006, level=180, varname="NH4")
proj4string(jun10) <- CRS("+init=EPSG:4326")
df_jun10 <- raster::as.data.frame(jun10, xy=T)
```

Modify df_jun10 so that it matches CARE
```{r}
str(df_jun10)
df_jun10 <- df_jun10 %>% rename(c("lon"="x", "lat"="y"))
df_jun10$nrow <- seq.int(nrow(df_jun10))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jun10[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2010 <- left_join(CARE_NH4_2010, df_jun10, by=c("nrow","lon","lat"))
str(CARE_NH4_2010)
CARE_NH4_2010 <- CARE_NH4_2010 %>% rename(c("NH4_jun10"="NH4"))
```

## July 2010
```{r}
outfile201007 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201007_201007.nc")

jul10 <- raster(outfile201007, level=180, varname="NH4")
proj4string(jul10) <- CRS("+init=EPSG:4326")
df_jul10 <- raster::as.data.frame(jul10, xy=T)
```

Modify df_jul10 so that it matches CARE
```{r}
str(df_jul10)
df_jul10 <- df_jul10 %>% rename(c("lon"="x", "lat"="y"))
df_jul10$nrow <- seq.int(nrow(df_jul10))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jul10[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2010 <- left_join(CARE_NH4_2010, df_jul10, by=c("nrow","lon","lat"))
str(CARE_NH4_2010)
CARE_NH4_2010 <- CARE_NH4_2010 %>% rename(c("NH4_jul10"="NH4"))
```

## August 2010
```{r}
outfile201008 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201008_201008.nc")

aug10 <- raster(outfile201008, level=180, varname="NH4")
proj4string(aug10) <- CRS("+init=EPSG:4326")
df_aug10 <- raster::as.data.frame(aug10, xy=T)
```

Modify df_aug10 so that it matches CARE
```{r}
str(df_aug10)
df_aug10 <- df_aug10 %>% rename(c("lon"="x", "lat"="y"))
df_aug10$nrow <- seq.int(nrow(df_aug10))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_aug10[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2010 <- left_join(CARE_NH4_2010, df_aug10, by=c("nrow","lon","lat"))
str(CARE_NH4_2010)
CARE_NH4_2010 <- CARE_NH4_2010 %>% rename(c("NH4_aug10"="NH4"))
```

## September 2010
```{r}
outfile201009 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201009_201009.nc")

sep10 <- raster(outfile201009, level=180, varname="NH4")
proj4string(sep10) <- CRS("+init=EPSG:4326")
df_sep10 <- raster::as.data.frame(sep10, xy=T)
```

Modify df_sep10 so that it matches CARE
```{r}
str(df_sep10)
df_sep10 <- df_sep10 %>% rename(c("lon"="x", "lat"="y"))
df_sep10$nrow <- seq.int(nrow(df_sep10))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_sep10[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2010 <- left_join(CARE_NH4_2010, df_sep10, by=c("nrow","lon","lat"))
str(CARE_NH4_2010)
CARE_NH4_2010 <- CARE_NH4_2010 %>% rename(c("NH4_sep10"="NH4"))
```

## October 2010
```{r}
outfile201010 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201010_201010.nc")

oct10 <- raster(outfile201010, level=180, varname="NH4")
proj4string(oct10) <- CRS("+init=EPSG:4326")
df_oct10 <- raster::as.data.frame(oct10, xy=T)
```

Modify df_oct10 so that it matches CARE
```{r}
str(df_oct10)
df_oct10 <- df_oct10 %>% rename(c("lon"="x", "lat"="y"))
df_oct10$nrow <- seq.int(nrow(df_oct10))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_oct10[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2010 <- left_join(CARE_NH4_2010, df_oct10, by=c("nrow","lon","lat"))
str(CARE_NH4_2010)
CARE_NH4_2010 <- CARE_NH4_2010 %>% rename(c("NH4_oct10"="NH4"))
```

## November 2010
```{r}
outfile201011 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201011_201011.nc")

nov10 <- raster(outfile201011, level=180, varname="NH4")
proj4string(nov10) <- CRS("+init=EPSG:4326")
df_nov10 <- raster::as.data.frame(nov10, xy=T)
```

Modify df_nov10 so that it matches CARE
```{r}
str(df_nov10)
df_nov10 <- df_nov10 %>% rename(c("lon"="x", "lat"="y"))
df_nov10$nrow <- seq.int(nrow(df_nov10))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_nov10[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2010 <- left_join(CARE_NH4_2010, df_nov10, by=c("nrow","lon","lat"))
str(CARE_NH4_2010)
CARE_NH4_2010 <- CARE_NH4_2010 %>% rename(c("NH4_nov10"="NH4"))
```

## Remove dataframes not in use
First we need to remove objects not in use in order to create space for our file
```{r}
#Removing files that we don't need anymore
rm(dec09, jan10, feb10, mar10, apr10, may10, jun10, jul10, aug10, sep10, oct10, nov10, dec10)

#Then can remove objects that fit a certain pattern - i.e. those starting with outfile
rm(list=ls(, pattern="^outfile2"))
rm(list=ls(,pattern="^df_"))
```

## December 2010
```{r}
outfile201012 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201012_201012.nc")

dec10 <- raster(outfile201012, level=180, varname="NH4")
proj4string(dec10) <- CRS("+init=EPSG:4326")
df_dec10 <- raster::as.data.frame(dec10, xy=T)
```

Modify df_dec10 so that it matches CARE
```{r}
str(df_dec10)
df_dec10 <- df_dec10 %>% rename(c("lon"="x", "lat"="y"))
df_dec10$nrow <- seq.int(nrow(df_dec10))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_dec10[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2010 <- left_join(CARE_NH4_2010, df_dec10, by=c("nrow","lon","lat"))
str(CARE_NH4_2010)
CARE_NH4_2010 <- CARE_NH4_2010 %>% rename(c("NH4_dec10"="NH4"))
```

## Remove dataframes not in use
```{r}
#Then can remove objects that fit a certain pattern - i.e. those starting with outfile
rm(list=ls(, pattern="^outfile2"))

rm(list=ls(,pattern="^df_"))
```

## Make Excel file for year 2010
```{r}
write_xlsx(CARE_NH4_2010, path="CARE_fILD_2010_NH4_2021_11_05.xlsx")
system("say Just finished!")
```

# 2011
## January 2011
```{r}
outfile201101 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201101_201101.nc")

jan11 <- raster(outfile201101, level=180, varname="NH4")
proj4string(jan11) <- CRS("+init=EPSG:4326")
df_jan11 <- raster::as.data.frame(jan11, xy=T)
```

Modify df_jan11 so that it matches CARE
```{r}
str(df_jan11)
df_jan11 <- df_jan11 %>% rename(c("lon"="x", "lat"="y"))
df_jan11$nrow <- seq.int(nrow(df_jan11))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jan11[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2011 <- left_join(match, df_jan11, by="nrow")
str(CARE_NH4_2011)
CARE_NH4_2011 <- CARE_NH4_2011 %>% rename(c("NH4_jan11"="NH4"))
```

## February 2011
```{r}
outfile201102 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201102_201102.nc")

feb11 <- raster(outfile201102, level=180, varname="NH4")
proj4string(feb11) <- CRS("+init=EPSG:4326")
df_feb11 <- raster::as.data.frame(feb11, xy=T)
```

Modify df_feb11 so that it matches CARE
```{r}
str(df_feb11)
df_feb11 <- df_feb11 %>% rename(c("lon"="x", "lat"="y"))
df_feb11$nrow <- seq.int(nrow(df_feb11))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_feb11[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2011 <- left_join(CARE_NH4_2011, df_feb11, by=c("nrow","lon","lat"))
str(CARE_NH4_2011)
CARE_NH4_2011 <- CARE_NH4_2011 %>% rename(c("NH4_feb11"="NH4"))
```

## March 2011
```{r}
outfile201103 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201103_201103.nc")

mar11 <- raster(outfile201103, level=180, varname="NH4")
proj4string(mar11) <- CRS("+init=EPSG:4326")
df_mar11 <- raster::as.data.frame(mar11, xy=T)
```

Modify df_mar11 so that it matches CARE
```{r}
str(df_mar11)
df_mar11 <- df_mar11 %>% rename(c("lon"="x", "lat"="y"))
df_mar11$nrow <- seq.int(nrow(df_mar11))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_mar11[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2011 <- left_join(CARE_NH4_2011, df_mar11, by=c("nrow","lon","lat"))
str(CARE_NH4_2011)
CARE_NH4_2011 <- CARE_NH4_2011 %>% rename(c("NH4_mar11"="NH4"))
```

## April 2011
```{r}
outfile201104 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201104_201104.nc")

apr11 <- raster(outfile201104, level=180, varname="NH4")
proj4string(apr11) <- CRS("+init=EPSG:4326")
df_apr11 <- raster::as.data.frame(apr11, xy=T)
```

Modify df_apr11 so that it matches CARE
```{r}
str(df_apr11)
df_apr11 <- df_apr11 %>% rename(c("lon"="x", "lat"="y"))
df_apr11$nrow <- seq.int(nrow(df_apr11))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_apr11[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2011 <- left_join(CARE_NH4_2011, df_apr11, by=c("nrow","lon","lat"))
str(CARE_NH4_2011)
CARE_NH4_2011 <- CARE_NH4_2011 %>% rename(c("NH4_apr11"="NH4"))
```

## May 2011
```{r}
outfile201105 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201105_201105.nc")

may11 <- raster(outfile201105, level=180, varname="NH4")
proj4string(may11) <- CRS("+init=EPSG:4326")
df_may11 <- raster::as.data.frame(may11, xy=T)
```

Modify df_may11 so that it matches CARE
```{r}
str(df_may11)
df_may11 <- df_may11 %>% rename(c("lon"="x", "lat"="y"))
df_may11$nrow <- seq.int(nrow(df_may11))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_may11[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2011 <- left_join(CARE_NH4_2011, df_may11, by=c("nrow","lon","lat"))
str(CARE_NH4_2011)
CARE_NH4_2011 <- CARE_NH4_2011 %>% rename(c("NH4_may11"="NH4"))
```

## June 2011
```{r}
outfile201106 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201106_201106.nc")

jun11 <- raster(outfile201106, level=180, varname="NH4")
proj4string(jun11) <- CRS("+init=EPSG:4326")
df_jun11 <- raster::as.data.frame(jun11, xy=T)
```

Modify df_jun11 so that it matches CARE
```{r}
str(df_jun11)
df_jun11 <- df_jun11 %>% rename(c("lon"="x", "lat"="y"))
df_jun11$nrow <- seq.int(nrow(df_jun11))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jun11[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2011 <- left_join(CARE_NH4_2011, df_jun11, by=c("nrow","lon","lat"))
str(CARE_NH4_2011)
CARE_NH4_2011 <- CARE_NH4_2011 %>% rename(c("NH4_jun11"="NH4"))
```

## July 2011
```{r}
outfile201107 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201107_201107.nc")

jul11 <- raster(outfile201107, level=180, varname="NH4")
proj4string(jul11) <- CRS("+init=EPSG:4326")
df_jul11 <- raster::as.data.frame(jul11, xy=T)
```

Modify df_jul11 so that it matches CARE
```{r}
str(df_jul11)
df_jul11 <- df_jul11 %>% rename(c("lon"="x", "lat"="y"))
df_jul11$nrow <- seq.int(nrow(df_jul11))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jul11[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2011 <- left_join(CARE_NH4_2011, df_jul11, by=c("nrow","lon","lat"))
str(CARE_NH4_2011)
CARE_NH4_2011 <- CARE_NH4_2011 %>% rename(c("NH4_jul11"="NH4"))
```

## August 2011
```{r}
outfile201108 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201108_201108.nc")

aug11 <- raster(outfile201108, level=180, varname="NH4")
proj4string(aug11) <- CRS("+init=EPSG:4326")
df_aug11 <- raster::as.data.frame(aug11, xy=T)
```

Modify df_aug11 so that it matches CARE
```{r}
str(df_aug11)
df_aug11 <- df_aug11 %>% rename(c("lon"="x", "lat"="y"))
df_aug11$nrow <- seq.int(nrow(df_aug11))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_aug11[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2011 <- left_join(CARE_NH4_2011, df_aug11, by=c("nrow","lon","lat"))
str(CARE_NH4_2011)
CARE_NH4_2011 <- CARE_NH4_2011 %>% rename(c("NH4_aug11"="NH4"))
```

## September 2011
```{r}
outfile201109 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201109_201109.nc")

sep11 <- raster(outfile201109, level=180, varname="NH4")
proj4string(sep11) <- CRS("+init=EPSG:4326")
df_sep11 <- raster::as.data.frame(sep11, xy=T)
```

Modify df_sep11 so that it matches CARE
```{r}
str(df_sep11)
df_sep11 <- df_sep11 %>% rename(c("lon"="x", "lat"="y"))
df_sep11$nrow <- seq.int(nrow(df_sep11))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_sep11[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2011 <- left_join(CARE_NH4_2011, df_sep11, by=c("nrow","lon","lat"))
str(CARE_NH4_2011)
CARE_NH4_2011 <- CARE_NH4_2011 %>% rename(c("NH4_sep11"="NH4"))
```

## October 2011
```{r}
outfile201110 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201110_201110.nc")

oct11 <- raster(outfile201110, level=180, varname="NH4")
proj4string(oct11) <- CRS("+init=EPSG:4326")
df_oct11 <- raster::as.data.frame(oct11, xy=T)
```

Modify df_oct11 so that it matches CARE
```{r}
str(df_oct11)
df_oct11 <- df_oct11 %>% rename(c("lon"="x", "lat"="y"))
df_oct11$nrow <- seq.int(nrow(df_oct11))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_oct11[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2011 <- left_join(CARE_NH4_2011, df_oct11, by=c("nrow","lon","lat"))
str(CARE_NH4_2011)
CARE_NH4_2011 <- CARE_NH4_2011 %>% rename(c("NH4_oct11"="NH4"))
```

## November 2011
```{r}
outfile201111 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201111_201111.nc")

nov11 <- raster(outfile201111, level=180, varname="NH4")
proj4string(nov11) <- CRS("+init=EPSG:4326")
df_nov11 <- raster::as.data.frame(nov11, xy=T)
```

Modify df_nov11 so that it matches CARE
```{r}
str(df_nov11)
df_nov11 <- df_nov11 %>% rename(c("lon"="x", "lat"="y"))
df_nov11$nrow <- seq.int(nrow(df_nov11))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_nov11[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2011 <- left_join(CARE_NH4_2011, df_nov11, by=c("nrow","lon","lat"))
str(CARE_NH4_2011)
CARE_NH4_2011 <- CARE_NH4_2011 %>% rename(c("NH4_nov11"="NH4"))
```

## Remove dataframes not in use
First we need to remove objects not in use in order to create space for our file
```{r}
#Removing files that we don't need anymore
rm(dec10, jan11, feb11, mar11, apr11, may11, jun11, jul11, aug11, sep11, oct11, nov11, dec11)

#Then can remove objects that fit a certain pattern - i.e. those starting with outfile
rm(list=ls(, pattern="^outfile2"))
rm(list=ls(,pattern="^df_"))
```

## December 2011
```{r}
outfile201112 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201112_201112.nc")

dec11 <- raster(outfile201112, level=180, varname="NH4")
proj4string(dec11) <- CRS("+init=EPSG:4326")
df_dec11 <- raster::as.data.frame(dec11, xy=T)
```

Modify df_dec11 so that it matches CARE
```{r}
str(df_dec11)
df_dec11 <- df_dec11 %>% rename(c("lon"="x", "lat"="y"))
df_dec11$nrow <- seq.int(nrow(df_dec11))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_dec11[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2011 <- left_join(CARE_NH4_2011, df_dec11, by=c("nrow","lon","lat"))
str(CARE_NH4_2011)
CARE_NH4_2011 <- CARE_NH4_2011 %>% rename(c("NH4_dec11"="NH4"))
```

## Remove dataframes not in use
```{r}
#Then can remove objects that fit a certain pattern - i.e. those starting with outfile
rm(list=ls(, pattern="^outfile2"))

rm(list=ls(,pattern="^df_"))
```

## Make Excel file for year 2011
```{r}
write_xlsx(CARE_NH4_2011, path="CARE_fILD_2011_NH4_2021_11_05.xlsx")
system("say Just finished!")
```


# 2012
## January 2012
```{r}
outfile201201 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201201_201201.nc")

jan12 <- raster(outfile201201, level=180, varname="NH4")
proj4string(jan12) <- CRS("+init=EPSG:4326")
df_jan12 <- raster::as.data.frame(jan12, xy=T)
```

Modify df_jan12 so that it matches CARE
```{r}
str(df_jan12)
df_jan12 <- df_jan12 %>% rename(c("lon"="x", "lat"="y"))
df_jan12$nrow <- seq.int(nrow(df_jan12))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jan12[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2012 <- left_join(match, df_jan12, by="nrow")
str(CARE_NH4_2012)
CARE_NH4_2012 <- CARE_NH4_2012 %>% rename(c("NH4_jan12"="NH4"))
```

## February 2012
```{r}
outfile201202 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201202_201202.nc")

feb12 <- raster(outfile201202, level=180, varname="NH4")
proj4string(feb12) <- CRS("+init=EPSG:4326")
df_feb12 <- raster::as.data.frame(feb12, xy=T)
```

Modify df_feb12 so that it matches CARE
```{r}
str(df_feb12)
df_feb12 <- df_feb12 %>% rename(c("lon"="x", "lat"="y"))
df_feb12$nrow <- seq.int(nrow(df_feb12))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_feb12[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2012 <- left_join(CARE_NH4_2012, df_feb12, by=c("nrow","lon","lat"))
str(CARE_NH4_2012)
CARE_NH4_2012 <- CARE_NH4_2012 %>% rename(c("NH4_feb12"="NH4"))
```

## March 2012
```{r}
outfile201203 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201203_201203.nc")

mar12 <- raster(outfile201203, level=180, varname="NH4")
proj4string(mar12) <- CRS("+init=EPSG:4326")
df_mar12 <- raster::as.data.frame(mar12, xy=T)
```

Modify df_mar12 so that it matches CARE
```{r}
str(df_mar12)
df_mar12 <- df_mar12 %>% rename(c("lon"="x", "lat"="y"))
df_mar12$nrow <- seq.int(nrow(df_mar12))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_mar12[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2012 <- left_join(CARE_NH4_2012, df_mar12, by=c("nrow","lon","lat"))
str(CARE_NH4_2012)
CARE_NH4_2012 <- CARE_NH4_2012 %>% rename(c("NH4_mar12"="NH4"))
```

## April 2012
```{r}
outfile201204 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201204_201204.nc")

apr12 <- raster(outfile201204, level=180, varname="NH4")
proj4string(apr12) <- CRS("+init=EPSG:4326")
df_apr12 <- raster::as.data.frame(apr12, xy=T)
```

Modify df_apr12 so that it matches CARE
```{r}
str(df_apr12)
df_apr12 <- df_apr12 %>% rename(c("lon"="x", "lat"="y"))
df_apr12$nrow <- seq.int(nrow(df_apr12))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_apr12[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2012 <- left_join(CARE_NH4_2012, df_apr12, by=c("nrow","lon","lat"))
str(CARE_NH4_2012)
CARE_NH4_2012 <- CARE_NH4_2012 %>% rename(c("NH4_apr12"="NH4"))
```

## May 2012
```{r}
outfile201205 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201205_201205.nc")

may12 <- raster(outfile201205, level=180, varname="NH4")
proj4string(may12) <- CRS("+init=EPSG:4326")
df_may12 <- raster::as.data.frame(may12, xy=T)
```

Modify df_may12 so that it matches CARE
```{r}
str(df_may12)
df_may12 <- df_may12 %>% rename(c("lon"="x", "lat"="y"))
df_may12$nrow <- seq.int(nrow(df_may12))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_may12[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2012 <- left_join(CARE_NH4_2012, df_may12, by=c("nrow","lon","lat"))
str(CARE_NH4_2012)
CARE_NH4_2012 <- CARE_NH4_2012 %>% rename(c("NH4_may12"="NH4"))
```

## June 2012
```{r}
outfile201206 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201206_201206.nc")

jun12 <- raster(outfile201206, level=180, varname="NH4")
proj4string(jun12) <- CRS("+init=EPSG:4326")
df_jun12 <- raster::as.data.frame(jun12, xy=T)
```

Modify df_jun12 so that it matches CARE
```{r}
str(df_jun12)
df_jun12 <- df_jun12 %>% rename(c("lon"="x", "lat"="y"))
df_jun12$nrow <- seq.int(nrow(df_jun12))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jun12[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2012 <- left_join(CARE_NH4_2012, df_jun12, by=c("nrow","lon","lat"))
str(CARE_NH4_2012)
CARE_NH4_2012 <- CARE_NH4_2012 %>% rename(c("NH4_jun12"="NH4"))
```

## July 2012
```{r}
outfile201207 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201207_201207.nc")

jul12 <- raster(outfile201207, level=180, varname="NH4")
proj4string(jul12) <- CRS("+init=EPSG:4326")
df_jul12 <- raster::as.data.frame(jul12, xy=T)
```

Modify df_jul12 so that it matches CARE
```{r}
str(df_jul12)
df_jul12 <- df_jul12 %>% rename(c("lon"="x", "lat"="y"))
df_jul12$nrow <- seq.int(nrow(df_jul12))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jul12[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2012 <- left_join(CARE_NH4_2012, df_jul12, by=c("nrow","lon","lat"))
str(CARE_NH4_2012)
CARE_NH4_2012 <- CARE_NH4_2012 %>% rename(c("NH4_jul12"="NH4"))
```

## August 2012
```{r}
outfile201208 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201208_201208.nc")

aug12 <- raster(outfile201208, level=180, varname="NH4")
proj4string(aug12) <- CRS("+init=EPSG:4326")
df_aug12 <- raster::as.data.frame(aug12, xy=T)
```

Modify df_aug12 so that it matches CARE
```{r}
str(df_aug12)
df_aug12 <- df_aug12 %>% rename(c("lon"="x", "lat"="y"))
df_aug12$nrow <- seq.int(nrow(df_aug12))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_aug12[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2012 <- left_join(CARE_NH4_2012, df_aug12, by=c("nrow","lon","lat"))
str(CARE_NH4_2012)
CARE_NH4_2012 <- CARE_NH4_2012 %>% rename(c("NH4_aug12"="NH4"))
```

## September 2012
```{r}
outfile201209 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201209_201209.nc")

sep12 <- raster(outfile201209, level=180, varname="NH4")
proj4string(sep12) <- CRS("+init=EPSG:4326")
df_sep12 <- raster::as.data.frame(sep12, xy=T)
```

Modify df_sep12 so that it matches CARE
```{r}
str(df_sep12)
df_sep12 <- df_sep12 %>% rename(c("lon"="x", "lat"="y"))
df_sep12$nrow <- seq.int(nrow(df_sep12))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_sep12[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2012 <- left_join(CARE_NH4_2012, df_sep12, by=c("nrow","lon","lat"))
str(CARE_NH4_2012)
CARE_NH4_2012 <- CARE_NH4_2012 %>% rename(c("NH4_sep12"="NH4"))
```

## October 2012
```{r}
outfile201210 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201210_201210.nc")

oct12 <- raster(outfile201210, level=180, varname="NH4")
proj4string(oct12) <- CRS("+init=EPSG:4326")
df_oct12 <- raster::as.data.frame(oct12, xy=T)
```

Modify df_oct12 so that it matches CARE
```{r}
str(df_oct12)
df_oct12 <- df_oct12 %>% rename(c("lon"="x", "lat"="y"))
df_oct12$nrow <- seq.int(nrow(df_oct12))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_oct12[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2012 <- left_join(CARE_NH4_2012, df_oct12, by=c("nrow","lon","lat"))
str(CARE_NH4_2012)
CARE_NH4_2012 <- CARE_NH4_2012 %>% rename(c("NH4_oct12"="NH4"))
```

## November 2012
```{r}
outfile201211 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201211_201211.nc")

nov12 <- raster(outfile201211, level=180, varname="NH4")
proj4string(nov12) <- CRS("+init=EPSG:4326")
df_nov12 <- raster::as.data.frame(nov12, xy=T)
```

Modify df_nov12 so that it matches CARE
```{r}
str(df_nov12)
df_nov12 <- df_nov12 %>% rename(c("lon"="x", "lat"="y"))
df_nov12$nrow <- seq.int(nrow(df_nov12))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_nov12[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2012 <- left_join(CARE_NH4_2012, df_nov12, by=c("nrow","lon","lat"))
str(CARE_NH4_2012)
CARE_NH4_2012 <- CARE_NH4_2012 %>% rename(c("NH4_nov12"="NH4"))
```

## Remove dataframes not in use
First we need to remove objects not in use in order to create space for our file
```{r}
#Removing files that we don't need anymore
rm(dec11, jan12, feb12, mar12, apr12, may12, jun12, jul12, aug12, sep12, oct12, nov12, dec12)

#Then can remove objects that fit a certain pattern - i.e. those starting with outfile
rm(list=ls(, pattern="^outfile2"))
rm(list=ls(,pattern="^df_"))
```

## December 2012
```{r}
outfile201212 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201212_201212.nc")

dec12 <- raster(outfile201212, level=180, varname="NH4")
proj4string(dec12) <- CRS("+init=EPSG:4326")
df_dec12 <- raster::as.data.frame(dec12, xy=T)
```

Modify df_dec12 so that it matches CARE
```{r}
str(df_dec12)
df_dec12 <- df_dec12 %>% rename(c("lon"="x", "lat"="y"))
df_dec12$nrow <- seq.int(nrow(df_dec12))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_dec12[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2012 <- left_join(CARE_NH4_2012, df_dec12, by=c("nrow","lon","lat"))
str(CARE_NH4_2012)
CARE_NH4_2012 <- CARE_NH4_2012 %>% rename(c("NH4_dec12"="NH4"))
```

## Remove dataframes not in use
```{r}
#Then can remove objects that fit a certain pattern - i.e. those starting with outfile
rm(list=ls(, pattern="^outfile2"))

rm(list=ls(,pattern="^df_"))
```

## Make Excel file for year 2012
```{r}
write_xlsx(CARE_NH4_2012, path="CARE_fILD_2012_NH4_2021_11_05.xlsx")
system("say Just finished!")
```


# 2013
## January 2013
```{r}
outfile201301 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201301_201301.nc")

jan13 <- raster(outfile201301, level=180, varname="NH4")
proj4string(jan13) <- CRS("+init=EPSG:4326")
df_jan13 <- raster::as.data.frame(jan13, xy=T)
```

Modify df_jan13 so that it matches CARE
```{r}
str(df_jan13)
df_jan13 <- df_jan13 %>% rename(c("lon"="x", "lat"="y"))
df_jan13$nrow <- seq.int(nrow(df_jan13))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jan13[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2013 <- left_join(match, df_jan13, by="nrow")
str(CARE_NH4_2013)
CARE_NH4_2013 <- CARE_NH4_2013 %>% rename(c("NH4_jan13"="NH4"))
```

## February 2013
```{r}
outfile201302 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201302_201302.nc")

feb13 <- raster(outfile201302, level=180, varname="NH4")
proj4string(feb13) <- CRS("+init=EPSG:4326")
df_feb13 <- raster::as.data.frame(feb13, xy=T)
```

Modify df_feb13 so that it matches CARE
```{r}
str(df_feb13)
df_feb13 <- df_feb13 %>% rename(c("lon"="x", "lat"="y"))
df_feb13$nrow <- seq.int(nrow(df_feb13))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_feb13[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2013 <- left_join(CARE_NH4_2013, df_feb13, by=c("nrow","lon","lat"))
str(CARE_NH4_2013)
CARE_NH4_2013 <- CARE_NH4_2013 %>% rename(c("NH4_feb13"="NH4"))
```

## March 2003
```{r}
outfile201303 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201303_201303.nc")

mar13 <- raster(outfile201303, level=180, varname="NH4")
proj4string(mar13) <- CRS("+init=EPSG:4326")
df_mar13 <- raster::as.data.frame(mar13, xy=T)
```

Modify df_mar13 so that it matches CARE
```{r}
str(df_mar13)
df_mar13 <- df_mar13 %>% rename(c("lon"="x", "lat"="y"))
df_mar13$nrow <- seq.int(nrow(df_mar13))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_mar13[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2013 <- left_join(CARE_NH4_2013, df_mar13, by=c("nrow","lon","lat"))
str(CARE_NH4_2013)
CARE_NH4_2013 <- CARE_NH4_2013 %>% rename(c("NH4_mar13"="NH4"))
```

## April 2013
```{r}
outfile201304 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201304_201304.nc")

apr13 <- raster(outfile201304, level=180, varname="NH4")
proj4string(apr13) <- CRS("+init=EPSG:4326")
df_apr13 <- raster::as.data.frame(apr13, xy=T)
```

Modify df_apr13 so that it matches CARE
```{r}
str(df_apr13)
df_apr13 <- df_apr13 %>% rename(c("lon"="x", "lat"="y"))
df_apr13$nrow <- seq.int(nrow(df_apr13))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_apr13[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2013 <- left_join(CARE_NH4_2013, df_apr13, by=c("nrow","lon","lat"))
str(CARE_NH4_2013)
CARE_NH4_2013 <- CARE_NH4_2013 %>% rename(c("NH4_apr13"="NH4"))
```

## May 2013
```{r}
outfile201305 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201305_201305.nc")

may13 <- raster(outfile201305, level=180, varname="NH4")
proj4string(may13) <- CRS("+init=EPSG:4326")
df_may13 <- raster::as.data.frame(may13, xy=T)
```

Modify df_may13 so that it matches CARE
```{r}
str(df_may13)
df_may13 <- df_may13 %>% rename(c("lon"="x", "lat"="y"))
df_may13$nrow <- seq.int(nrow(df_may13))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_may13[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2013 <- left_join(CARE_NH4_2013, df_may13, by=c("nrow","lon","lat"))
str(CARE_NH4_2013)
CARE_NH4_2013 <- CARE_NH4_2013 %>% rename(c("NH4_may13"="NH4"))
```

## June 2013
```{r}
outfile201306 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201306_201306.nc")

jun13 <- raster(outfile201306, level=180, varname="NH4")
proj4string(jun13) <- CRS("+init=EPSG:4326")
df_jun13 <- raster::as.data.frame(jun13, xy=T)
```

Modify df_jun13 so that it matches CARE
```{r}
str(df_jun13)
df_jun13 <- df_jun13 %>% rename(c("lon"="x", "lat"="y"))
df_jun13$nrow <- seq.int(nrow(df_jun13))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jun13[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2013 <- left_join(CARE_NH4_2013, df_jun13, by=c("nrow","lon","lat"))
str(CARE_NH4_2013)
CARE_NH4_2013 <- CARE_NH4_2013 %>% rename(c("NH4_jun13"="NH4"))
```

## July 2013
```{r}
outfile201307 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201307_201307.nc")

jul13 <- raster(outfile201307, level=180, varname="NH4")
proj4string(jul13) <- CRS("+init=EPSG:4326")
df_jul13 <- raster::as.data.frame(jul13, xy=T)
```

Modify df_jul13 so that it matches CARE
```{r}
str(df_jul13)
df_jul13 <- df_jul13 %>% rename(c("lon"="x", "lat"="y"))
df_jul13$nrow <- seq.int(nrow(df_jul13))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jul13[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2013 <- left_join(CARE_NH4_2013, df_jul13, by=c("nrow","lon","lat"))
str(CARE_NH4_2013)
CARE_NH4_2013 <- CARE_NH4_2013 %>% rename(c("NH4_jul13"="NH4"))
```

## August 2013
```{r}
outfile201308 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201308_201308.nc")

aug13 <- raster(outfile201308, level=180, varname="NH4")
proj4string(aug13) <- CRS("+init=EPSG:4326")
df_aug13 <- raster::as.data.frame(aug13, xy=T)
```

Modify df_aug13 so that it matches CARE
```{r}
str(df_aug13)
df_aug13 <- df_aug13 %>% rename(c("lon"="x", "lat"="y"))
df_aug13$nrow <- seq.int(nrow(df_aug13))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_aug13[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2013 <- left_join(CARE_NH4_2013, df_aug13, by=c("nrow","lon","lat"))
str(CARE_NH4_2013)
CARE_NH4_2013 <- CARE_NH4_2013 %>% rename(c("NH4_aug13"="NH4"))
```

## September 2013
```{r}
outfile201309 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201309_201309.nc")

sep13 <- raster(outfile201309, level=180, varname="NH4")
proj4string(sep13) <- CRS("+init=EPSG:4326")
df_sep13 <- raster::as.data.frame(sep13, xy=T)
```

Modify df_sep13 so that it matches CARE
```{r}
str(df_sep13)
df_sep13 <- df_sep13 %>% rename(c("lon"="x", "lat"="y"))
df_sep13$nrow <- seq.int(nrow(df_sep13))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_sep13[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2013 <- left_join(CARE_NH4_2013, df_sep13, by=c("nrow","lon","lat"))
str(CARE_NH4_2013)
CARE_NH4_2013 <- CARE_NH4_2013 %>% rename(c("NH4_sep13"="NH4"))
```

## October 2013
```{r}
outfile201310 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201310_201310.nc")

oct13 <- raster(outfile201310, level=180, varname="NH4")
proj4string(oct13) <- CRS("+init=EPSG:4326")
df_oct13 <- raster::as.data.frame(oct13, xy=T)
```

Modify df_oct13 so that it matches CARE
```{r}
str(df_oct13)
df_oct13 <- df_oct13 %>% rename(c("lon"="x", "lat"="y"))
df_oct13$nrow <- seq.int(nrow(df_oct13))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_oct13[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2013 <- left_join(CARE_NH4_2013, df_oct13, by=c("nrow","lon","lat"))
str(CARE_NH4_2013)
CARE_NH4_2013 <- CARE_NH4_2013 %>% rename(c("NH4_oct13"="NH4"))
```

## November 2013
```{r}
outfile201311 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201311_201311.nc")

nov13 <- raster(outfile201311, level=180, varname="NH4")
proj4string(nov13) <- CRS("+init=EPSG:4326")
df_nov13 <- raster::as.data.frame(nov13, xy=T)
```

Modify df_nov13 so that it matches CARE
```{r}
str(df_nov13)
df_nov13 <- df_nov13 %>% rename(c("lon"="x", "lat"="y"))
df_nov13$nrow <- seq.int(nrow(df_nov13))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_nov13[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2013 <- left_join(CARE_NH4_2013, df_nov13, by=c("nrow","lon","lat"))
str(CARE_NH4_2013)
CARE_NH4_2013 <- CARE_NH4_2013 %>% rename(c("NH4_nov13"="NH4"))
```

## Remove dataframes not in use
First we need to remove objects not in use in order to create space for our file
```{r}
#Removing files that we don't need anymore
rm(dec12, jan13, feb13, mar13, apr13, may13, jun13, jul13, aug13, sep13, oct13, nov13, dec13)

#Then can remove objects that fit a certain pattern - i.e. those starting with outfile
rm(list=ls(, pattern="^outfile2"))
rm(list=ls(,pattern="^df_"))
```

## December 2013
```{r}
outfile201312 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201312_201312.nc")

dec13 <- raster(outfile201312, level=180, varname="NH4")
proj4string(dec13) <- CRS("+init=EPSG:4326")
df_dec13 <- raster::as.data.frame(dec13, xy=T)
```

Modify df_dec13 so that it matches CARE
```{r}
str(df_dec13)
df_dec13 <- df_dec13 %>% rename(c("lon"="x", "lat"="y"))
df_dec13$nrow <- seq.int(nrow(df_dec13))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_dec13[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2013 <- left_join(CARE_NH4_2013, df_dec13, by=c("nrow","lon","lat"))
str(CARE_NH4_2013)
CARE_NH4_2013 <- CARE_NH4_2013 %>% rename(c("NH4_dec13"="NH4"))
```

## Remove dataframes not in use
```{r}
#Then can remove objects that fit a certain pattern - i.e. those starting with outfile
rm(list=ls(, pattern="^outfile2"))

rm(list=ls(,pattern="^df_"))
```

## Make Excel file for year 2013
```{r}
write_xlsx(CARE_NH4_2013, path="CARE_fILD_2013_NH4_2021_11_05.xlsx")
system("say Just finished!")
```


# 2014
## January 2014
```{r}
outfile201401 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201401_201401.nc")

jan14 <- raster(outfile201401, level=180, varname="NH4")
proj4string(jan14) <- CRS("+init=EPSG:4326")
df_jan14 <- raster::as.data.frame(jan14, xy=T)
```

Modify df_jan14 so that it matches CARE
```{r}
str(df_jan14)
df_jan14 <- df_jan14 %>% rename(c("lon"="x", "lat"="y"))
df_jan14$nrow <- seq.int(nrow(df_jan14))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jan14[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2014 <- left_join(match, df_jan14, by="nrow")
str(CARE_NH4_2014)
CARE_NH4_2014 <- CARE_NH4_2014 %>% rename(c("NH4_jan14"="NH4"))
```

## February 2014
```{r}
outfile201402 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201402_201402.nc")

feb14 <- raster(outfile201402, level=180, varname="NH4")
proj4string(feb14) <- CRS("+init=EPSG:4326")
df_feb14 <- raster::as.data.frame(feb14, xy=T)
```

Modify df_feb14 so that it matches CARE
```{r}
str(df_feb14)
df_feb14 <- df_feb14 %>% rename(c("lon"="x", "lat"="y"))
df_feb14$nrow <- seq.int(nrow(df_feb14))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_feb14[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2014 <- left_join(CARE_NH4_2014, df_feb14, by=c("nrow","lon","lat"))
str(CARE_NH4_2014)
CARE_NH4_2014 <- CARE_NH4_2014 %>% rename(c("NH4_feb14"="NH4"))
```

## March 2014
```{r}
outfile201403 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201403_201403.nc")

mar14 <- raster(outfile201403, level=180, varname="NH4")
proj4string(mar14) <- CRS("+init=EPSG:4326")
df_mar14 <- raster::as.data.frame(mar14, xy=T)
```

Modify df_mar14 so that it matches CARE
```{r}
str(df_mar14)
df_mar14 <- df_mar14 %>% rename(c("lon"="x", "lat"="y"))
df_mar14$nrow <- seq.int(nrow(df_mar14))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_mar14[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2014 <- left_join(CARE_NH4_2014, df_mar14, by=c("nrow","lon","lat"))
str(CARE_NH4_2014)
CARE_NH4_2014 <- CARE_NH4_2014 %>% rename(c("NH4_mar14"="NH4"))
```

## April 2014
```{r}
outfile201404 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201404_201404.nc")

apr14 <- raster(outfile201404, level=180, varname="NH4")
proj4string(apr14) <- CRS("+init=EPSG:4326")
df_apr14 <- raster::as.data.frame(apr14, xy=T)
```

Modify df_apr14 so that it matches CARE
```{r}
str(df_apr14)
df_apr14 <- df_apr14 %>% rename(c("lon"="x", "lat"="y"))
df_apr14$nrow <- seq.int(nrow(df_apr14))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_apr14[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2014 <- left_join(CARE_NH4_2014, df_apr14, by=c("nrow","lon","lat"))
str(CARE_NH4_2014)
CARE_NH4_2014 <- CARE_NH4_2014 %>% rename(c("NH4_apr14"="NH4"))
```

## May 2014
```{r}
outfile201405 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201405_201405.nc")

may14 <- raster(outfile201405, level=180, varname="NH4")
proj4string(may14) <- CRS("+init=EPSG:4326")
df_may14 <- raster::as.data.frame(may14, xy=T)
```

Modify df_may14 so that it matches CARE
```{r}
str(df_may14)
df_may14 <- df_may14 %>% rename(c("lon"="x", "lat"="y"))
df_may14$nrow <- seq.int(nrow(df_may14))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_may14[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2014 <- left_join(CARE_NH4_2014, df_may14, by=c("nrow","lon","lat"))
str(CARE_NH4_2014)
CARE_NH4_2014 <- CARE_NH4_2014 %>% rename(c("NH4_may14"="NH4"))
```

## June 2014
```{r}
outfile201406 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201406_201406.nc")

jun14 <- raster(outfile201406, level=180, varname="NH4")
proj4string(jun14) <- CRS("+init=EPSG:4326")
df_jun14 <- raster::as.data.frame(jun14, xy=T)
```

Modify df_jun14 so that it matches CARE
```{r}
str(df_jun14)
df_jun14 <- df_jun14 %>% rename(c("lon"="x", "lat"="y"))
df_jun14$nrow <- seq.int(nrow(df_jun14))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jun14[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2014 <- left_join(CARE_NH4_2014, df_jun14, by=c("nrow","lon","lat"))
str(CARE_NH4_2014)
CARE_NH4_2014 <- CARE_NH4_2014 %>% rename(c("NH4_jun14"="NH4"))
```

## July 2014
```{r}
outfile201407 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201407_201407.nc")

jul14 <- raster(outfile201407, level=180, varname="NH4")
proj4string(jul14) <- CRS("+init=EPSG:4326")
df_jul14 <- raster::as.data.frame(jul14, xy=T)
```

Modify df_jul14 so that it matches CARE
```{r}
str(df_jul14)
df_jul14 <- df_jul14 %>% rename(c("lon"="x", "lat"="y"))
df_jul14$nrow <- seq.int(nrow(df_jul14))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jul14[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2014 <- left_join(CARE_NH4_2014, df_jul14, by=c("nrow","lon","lat"))
str(CARE_NH4_2014)
CARE_NH4_2014 <- CARE_NH4_2014 %>% rename(c("NH4_jul14"="NH4"))
```

## August 2014
```{r}
outfile201408 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201408_201408.nc")

aug14 <- raster(outfile201408, level=180, varname="NH4")
proj4string(aug14) <- CRS("+init=EPSG:4326")
df_aug14 <- raster::as.data.frame(aug14, xy=T)
```

Modify df_aug14 so that it matches CARE
```{r}
str(df_aug14)
df_aug14 <- df_aug14 %>% rename(c("lon"="x", "lat"="y"))
df_aug14$nrow <- seq.int(nrow(df_aug14))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_aug14[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2014 <- left_join(CARE_NH4_2014, df_aug14, by=c("nrow","lon","lat"))
str(CARE_NH4_2014)
CARE_NH4_2014 <- CARE_NH4_2014 %>% rename(c("NH4_aug14"="NH4"))
```

## September 2014
```{r}
outfile201409 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201409_201409.nc")

sep14 <- raster(outfile201409, level=180, varname="NH4")
proj4string(sep14) <- CRS("+init=EPSG:4326")
df_sep14 <- raster::as.data.frame(sep14, xy=T)
```

Modify df_sep14 so that it matches CARE
```{r}
str(df_sep14)
df_sep14 <- df_sep14 %>% rename(c("lon"="x", "lat"="y"))
df_sep14$nrow <- seq.int(nrow(df_sep14))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_sep14[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2014 <- left_join(CARE_NH4_2014, df_sep14, by=c("nrow","lon","lat"))
str(CARE_NH4_2014)
CARE_NH4_2014 <- CARE_NH4_2014 %>% rename(c("NH4_sep14"="NH4"))
```

## October 2014
```{r}
outfile201410 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201410_201410.nc")

oct14 <- raster(outfile201410, level=180, varname="NH4")
proj4string(oct14) <- CRS("+init=EPSG:4326")
df_oct14 <- raster::as.data.frame(oct14, xy=T)
```

Modify df_oct14 so that it matches CARE
```{r}
str(df_oct14)
df_oct14 <- df_oct14 %>% rename(c("lon"="x", "lat"="y"))
df_oct14$nrow <- seq.int(nrow(df_oct14))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_oct14[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2014 <- left_join(CARE_NH4_2014, df_oct14, by=c("nrow","lon","lat"))
str(CARE_NH4_2014)
CARE_NH4_2014 <- CARE_NH4_2014 %>% rename(c("NH4_oct14"="NH4"))
```

## November 2014
```{r}
outfile201411 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201411_201411.nc")

nov14 <- raster(outfile201411, level=180, varname="NH4")
proj4string(nov14) <- CRS("+init=EPSG:4326")
df_nov14 <- raster::as.data.frame(nov14, xy=T)
```

Modify df_nov14 so that it matches CARE
```{r}
str(df_nov14)
df_nov14 <- df_nov14 %>% rename(c("lon"="x", "lat"="y"))
df_nov14$nrow <- seq.int(nrow(df_nov14))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_nov14[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2014 <- left_join(CARE_NH4_2014, df_nov14, by=c("nrow","lon","lat"))
str(CARE_NH4_2014)
CARE_NH4_2014 <- CARE_NH4_2014 %>% rename(c("NH4_nov14"="NH4"))
```

## Remove dataframes not in use
First we need to remove objects not in use in order to create space for our file
```{r}
#Removing files that we don't need anymore
rm(dec13, jan14, feb14, mar14, apr14, may14, jun14, jul14, aug14, sep14, oct14, nov14, dec14)

#Then can remove objects that fit a certain pattern - i.e. those starting with outfile
rm(list=ls(, pattern="^outfile2"))
rm(list=ls(,pattern="^df_"))
```

## December 2014
```{r}
outfile201412 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201412_201412.nc")

dec14 <- raster(outfile201412, level=180, varname="NH4")
proj4string(dec14) <- CRS("+init=EPSG:4326")
df_dec14 <- raster::as.data.frame(dec14, xy=T)
```

Modify df_dec14 so that it matches CARE
```{r}
str(df_dec14)
df_dec14 <- df_dec14 %>% rename(c("lon"="x", "lat"="y"))
df_dec14$nrow <- seq.int(nrow(df_dec14))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_dec14[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2014 <- left_join(CARE_NH4_2014, df_dec14, by=c("nrow","lon","lat"))
str(CARE_NH4_2014)
CARE_NH4_2014 <- CARE_NH4_2014 %>% rename(c("NH4_dec14"="NH4"))
```

## Remove dataframes not in use
```{r}
#Then can remove objects that fit a certain pattern - i.e. those starting with outfile
rm(list=ls(, pattern="^outfile2"))

rm(list=ls(,pattern="^df_"))
```

## Make Excel file for year 2014
```{r}
write_xlsx(CARE_NH4_2014, path="CARE_fILD_2014_NH4_2021_11_05.xlsx")
system("say Just finished!")
```


# 2015
## January 2015
```{r}
outfile201501 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201501_201501.nc")

jan15 <- raster(outfile201501, level=180, varname="NH4")
proj4string(jan15) <- CRS("+init=EPSG:4326")
df_jan15 <- raster::as.data.frame(jan15, xy=T)
```

Modify df_jan15 so that it matches CARE
```{r}
str(df_jan15)
df_jan15 <- df_jan15 %>% rename(c("lon"="x", "lat"="y"))
df_jan15$nrow <- seq.int(nrow(df_jan15))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jan15[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2015 <- left_join(match, df_jan15, by="nrow")
str(CARE_NH4_2015)
CARE_NH4_2015 <- CARE_NH4_2015 %>% rename(c("NH4_jan15"="NH4"))
```

## February 2015
```{r}
outfile201502 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201502_201502.nc")

feb15 <- raster(outfile201502, level=180, varname="NH4")
proj4string(feb15) <- CRS("+init=EPSG:4326")
df_feb15 <- raster::as.data.frame(feb15, xy=T)
```

Modify df_feb15 so that it matches CARE
```{r}
str(df_feb15)
df_feb15 <- df_feb15 %>% rename(c("lon"="x", "lat"="y"))
df_feb15$nrow <- seq.int(nrow(df_feb15))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_feb15[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2015 <- left_join(CARE_NH4_2015, df_feb15, by=c("nrow","lon","lat"))
str(CARE_NH4_2015)
CARE_NH4_2015 <- CARE_NH4_2015 %>% rename(c("NH4_feb15"="NH4"))
```

## March 2015
```{r}
outfile201503 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201503_201503.nc")

mar15 <- raster(outfile201503, level=180, varname="NH4")
proj4string(mar15) <- CRS("+init=EPSG:4326")
df_mar15 <- raster::as.data.frame(mar15, xy=T)
```

Modify df_mar15 so that it matches CARE
```{r}
str(df_mar15)
df_mar15 <- df_mar15 %>% rename(c("lon"="x", "lat"="y"))
df_mar15$nrow <- seq.int(nrow(df_mar15))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_mar15[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2015 <- left_join(CARE_NH4_2015, df_mar15, by=c("nrow","lon","lat"))
str(CARE_NH4_2015)
CARE_NH4_2015 <- CARE_NH4_2015 %>% rename(c("NH4_mar15"="NH4"))
```

## April 2015
```{r}
outfile201504 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201504_201504.nc")

apr15 <- raster(outfile201504, level=180, varname="NH4")
proj4string(apr15) <- CRS("+init=EPSG:4326")
df_apr15 <- raster::as.data.frame(apr15, xy=T)
```

Modify df_apr15 so that it matches CARE
```{r}
str(df_apr15)
df_apr15 <- df_apr15 %>% rename(c("lon"="x", "lat"="y"))
df_apr15$nrow <- seq.int(nrow(df_apr15))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_apr15[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2015 <- left_join(CARE_NH4_2015, df_apr15, by=c("nrow","lon","lat"))
str(CARE_NH4_2015)
CARE_NH4_2015 <- CARE_NH4_2015 %>% rename(c("NH4_apr15"="NH4"))
```

## May 2015
```{r}
outfile201505 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201505_201505.nc")

may15 <- raster(outfile201505, level=180, varname="NH4")
proj4string(may15) <- CRS("+init=EPSG:4326")
df_may15 <- raster::as.data.frame(may15, xy=T)
```

Modify df_may15 so that it matches CARE
```{r}
str(df_may15)
df_may15 <- df_may15 %>% rename(c("lon"="x", "lat"="y"))
df_may15$nrow <- seq.int(nrow(df_may15))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_may15[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2015 <- left_join(CARE_NH4_2015, df_may15, by=c("nrow","lon","lat"))
str(CARE_NH4_2015)
CARE_NH4_2015 <- CARE_NH4_2015 %>% rename(c("NH4_may15"="NH4"))
```

## June 2015
```{r}
outfile201506 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201506_201506.nc")

jun15 <- raster(outfile201506, level=180, varname="NH4")
proj4string(jun15) <- CRS("+init=EPSG:4326")
df_jun15 <- raster::as.data.frame(jun15, xy=T)
```

Modify df_jun15 so that it matches CARE
```{r}
str(df_jun15)
df_jun15 <- df_jun15 %>% rename(c("lon"="x", "lat"="y"))
df_jun15$nrow <- seq.int(nrow(df_jun15))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jun15[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2015 <- left_join(CARE_NH4_2015, df_jun15, by=c("nrow","lon","lat"))
str(CARE_NH4_2015)
CARE_NH4_2015 <- CARE_NH4_2015 %>% rename(c("NH4_jun15"="NH4"))
```

## July 2015
```{r}
outfile201507 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201507_201507.nc")

jul15 <- raster(outfile201507, level=180, varname="NH4")
proj4string(jul15) <- CRS("+init=EPSG:4326")
df_jul15 <- raster::as.data.frame(jul15, xy=T)
```

Modify df_jul15 so that it matches CARE
```{r}
str(df_jul15)
df_jul15 <- df_jul15 %>% rename(c("lon"="x", "lat"="y"))
df_jul15$nrow <- seq.int(nrow(df_jul15))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jul15[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2015 <- left_join(CARE_NH4_2015, df_jul15, by=c("nrow","lon","lat"))
str(CARE_NH4_2015)
CARE_NH4_2015 <- CARE_NH4_2015 %>% rename(c("NH4_jul15"="NH4"))
```

## August 2015
```{r}
outfile201508 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201508_201508.nc")

aug15 <- raster(outfile201508, level=180, varname="NH4")
proj4string(aug15) <- CRS("+init=EPSG:4326")
df_aug15 <- raster::as.data.frame(aug15, xy=T)
```

Modify df_aug15 so that it matches CARE
```{r}
str(df_aug15)
df_aug15 <- df_aug15 %>% rename(c("lon"="x", "lat"="y"))
df_aug15$nrow <- seq.int(nrow(df_aug15))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_aug15[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2015 <- left_join(CARE_NH4_2015, df_aug15, by=c("nrow","lon","lat"))
str(CARE_NH4_2015)
CARE_NH4_2015 <- CARE_NH4_2015 %>% rename(c("NH4_aug15"="NH4"))
```

## September 2015
```{r}
outfile201509 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201509_201509.nc")

sep15 <- raster(outfile201509, level=180, varname="NH4")
proj4string(sep15) <- CRS("+init=EPSG:4326")
df_sep15 <- raster::as.data.frame(sep15, xy=T)
```

Modify df_sep15 so that it matches CARE
```{r}
str(df_sep15)
df_sep15 <- df_sep15 %>% rename(c("lon"="x", "lat"="y"))
df_sep15$nrow <- seq.int(nrow(df_sep15))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_sep15[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2015 <- left_join(CARE_NH4_2015, df_sep15, by=c("nrow","lon","lat"))
str(CARE_NH4_2015)
CARE_NH4_2015 <- CARE_NH4_2015 %>% rename(c("NH4_sep15"="NH4"))
```

## October 2015
```{r}
outfile201510 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201510_201510.nc")

oct15 <- raster(outfile201510, level=180, varname="NH4")
proj4string(oct15) <- CRS("+init=EPSG:4326")
df_oct15 <- raster::as.data.frame(oct15, xy=T)
```

Modify df_oct15 so that it matches CARE
```{r}
str(df_oct15)
df_oct15 <- df_oct15 %>% rename(c("lon"="x", "lat"="y"))
df_oct15$nrow <- seq.int(nrow(df_oct15))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_oct15[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2015 <- left_join(CARE_NH4_2015, df_oct15, by=c("nrow","lon","lat"))
str(CARE_NH4_2015)
CARE_NH4_2015 <- CARE_NH4_2015 %>% rename(c("NH4_oct15"="NH4"))
```

## November 2015
```{r}
outfile201511 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201511_201511.nc")

nov15 <- raster(outfile201511, level=180, varname="NH4")
proj4string(nov15) <- CRS("+init=EPSG:4326")
df_nov15 <- raster::as.data.frame(nov15, xy=T)
```

Modify df_nov15 so that it matches CARE
```{r}
str(df_nov15)
df_nov15 <- df_nov15 %>% rename(c("lon"="x", "lat"="y"))
df_nov15$nrow <- seq.int(nrow(df_nov15))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_nov15[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2015 <- left_join(CARE_NH4_2015, df_nov15, by=c("nrow","lon","lat"))
str(CARE_NH4_2015)
CARE_NH4_2015 <- CARE_NH4_2015 %>% rename(c("NH4_nov15"="NH4"))
```

## Remove dataframes not in use
First we need to remove objects not in use in order to create space for our file
```{r}
#Removing files that we don't need anymore
rm(dec14, jan15, feb15, mar15, apr15, may15, jun15, jul15, aug15, sep15, oct15, nov15, dec15)

#Then can remove objects that fit a certain pattern - i.e. those starting with outfile
rm(list=ls(, pattern="^outfile2"))
rm(list=ls(,pattern="^df_"))
```

## December 2015
```{r}
outfile201512 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201512_201512.nc")

dec15 <- raster(outfile201512, level=180, varname="NH4")
proj4string(dec15) <- CRS("+init=EPSG:4326")
df_dec15 <- raster::as.data.frame(dec15, xy=T)
```

Modify df_dec15 so that it matches CARE
```{r}
str(df_dec15)
df_dec15 <- df_dec15 %>% rename(c("lon"="x", "lat"="y"))
df_dec15$nrow <- seq.int(nrow(df_dec15))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_dec15[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2015 <- left_join(CARE_NH4_2015, df_dec15, by=c("nrow","lon","lat"))
str(CARE_NH4_2015)
CARE_NH4_2015 <- CARE_NH4_2015 %>% rename(c("NH4_dec15"="NH4"))
```

## Remove dataframes not in use
```{r}
#Then can remove objects that fit a certain pattern - i.e. those starting with outfile
rm(list=ls(, pattern="^outfile2"))

rm(list=ls(,pattern="^df_"))
```

## Make Excel file for year 2015
```{r}
write_xlsx(CARE_NH4_2015, path="CARE_fILD_2015_NH4_2021_11_05.xlsx")
system("say Just finished!")
```


# 2016
## January 2016
```{r}
outfile201601 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201601_201601.nc")

jan16 <- raster(outfile201601, level=180, varname="NH4")
proj4string(jan16) <- CRS("+init=EPSG:4326")
df_jan16 <- raster::as.data.frame(jan16, xy=T)
```

Modify df_jan16 so that it matches CARE
```{r}
str(df_jan16)
df_jan16 <- df_jan16 %>% rename(c("lon"="x", "lat"="y"))
df_jan16$nrow <- seq.int(nrow(df_jan16))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jan16[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2016 <- left_join(match, df_jan16, by="nrow")
str(CARE_NH4_2016)
CARE_NH4_2016 <- CARE_NH4_2016 %>% rename(c("NH4_jan16"="NH4"))
```

## February 2016
```{r}
outfile201602 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201602_201602.nc")

feb16 <- raster(outfile201602, level=180, varname="NH4")
proj4string(feb16) <- CRS("+init=EPSG:4326")
df_feb16 <- raster::as.data.frame(feb16, xy=T)
```

Modify df_feb16 so that it matches CARE
```{r}
str(df_feb16)
df_feb16 <- df_feb16 %>% rename(c("lon"="x", "lat"="y"))
df_feb16$nrow <- seq.int(nrow(df_feb16))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_feb16[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2016 <- left_join(CARE_NH4_2016, df_feb16, by=c("nrow","lon","lat"))
str(CARE_NH4_2016)
CARE_NH4_2016 <- CARE_NH4_2016 %>% rename(c("NH4_feb16"="NH4"))
```

## March 2016
```{r}
outfile201603 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201603_201603.nc")

mar16 <- raster(outfile201603, level=180, varname="NH4")
proj4string(mar16) <- CRS("+init=EPSG:4326")
df_mar16 <- raster::as.data.frame(mar16, xy=T)
```

Modify df_mar16 so that it matches CARE
```{r}
str(df_mar16)
df_mar16 <- df_mar16 %>% rename(c("lon"="x", "lat"="y"))
df_mar16$nrow <- seq.int(nrow(df_mar16))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_mar16[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2016 <- left_join(CARE_NH4_2016, df_mar16, by=c("nrow","lon","lat"))
str(CARE_NH4_2016)
CARE_NH4_2016 <- CARE_NH4_2016 %>% rename(c("NH4_mar16"="NH4"))
```

## April 2016
```{r}
outfile201604 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201604_201604.nc")

apr16 <- raster(outfile201604, level=180, varname="NH4")
proj4string(apr16) <- CRS("+init=EPSG:4326")
df_apr16 <- raster::as.data.frame(apr16, xy=T)
```

Modify df_apr16 so that it matches CARE
```{r}
str(df_apr16)
df_apr16 <- df_apr16 %>% rename(c("lon"="x", "lat"="y"))
df_apr16$nrow <- seq.int(nrow(df_apr16))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_apr16[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2016 <- left_join(CARE_NH4_2016, df_apr16, by=c("nrow","lon","lat"))
str(CARE_NH4_2016)
CARE_NH4_2016 <- CARE_NH4_2016 %>% rename(c("NH4_apr16"="NH4"))
```

## May 2016
```{r}
outfile201605 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201605_201605.nc")

may16 <- raster(outfile201605, level=180, varname="NH4")
proj4string(may16) <- CRS("+init=EPSG:4326")
df_may16 <- raster::as.data.frame(may16, xy=T)
```

Modify df_may16 so that it matches CARE
```{r}
str(df_may16)
df_may16 <- df_may16 %>% rename(c("lon"="x", "lat"="y"))
df_may16$nrow <- seq.int(nrow(df_may16))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_may16[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2016 <- left_join(CARE_NH4_2016, df_may16, by=c("nrow","lon","lat"))
str(CARE_NH4_2016)
CARE_NH4_2016 <- CARE_NH4_2016 %>% rename(c("NH4_may16"="NH4"))
```

## June 2016
```{r}
outfile201606 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201606_201606.nc")

jun16 <- raster(outfile201606, level=180, varname="NH4")
proj4string(jun16) <- CRS("+init=EPSG:4326")
df_jun16 <- raster::as.data.frame(jun16, xy=T)
```

Modify df_jun16 so that it matches CARE
```{r}
str(df_jun16)
df_jun16 <- df_jun16 %>% rename(c("lon"="x", "lat"="y"))
df_jun16$nrow <- seq.int(nrow(df_jun16))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jun16[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2016 <- left_join(CARE_NH4_2016, df_jun16, by=c("nrow","lon","lat"))
str(CARE_NH4_2016)
CARE_NH4_2016 <- CARE_NH4_2016 %>% rename(c("NH4_jun16"="NH4"))
```

## July 2016
```{r}
outfile201607 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201607_201607.nc")

jul16 <- raster(outfile201607, level=180, varname="NH4")
proj4string(jul16) <- CRS("+init=EPSG:4326")
df_jul16 <- raster::as.data.frame(jul16, xy=T)
```

Modify df_jul16 so that it matches CARE
```{r}
str(df_jul16)
df_jul16 <- df_jul16 %>% rename(c("lon"="x", "lat"="y"))
df_jul16$nrow <- seq.int(nrow(df_jul16))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jul16[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2016 <- left_join(CARE_NH4_2016, df_jul16, by=c("nrow","lon","lat"))
str(CARE_NH4_2016)
CARE_NH4_2016 <- CARE_NH4_2016 %>% rename(c("NH4_jul16"="NH4"))
```

## August 2016
```{r}
outfile201608 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201608_201608.nc")

aug16 <- raster(outfile201608, level=180, varname="NH4")
proj4string(aug16) <- CRS("+init=EPSG:4326")
df_aug16 <- raster::as.data.frame(aug16, xy=T)
```

Modify df_aug16 so that it matches CARE
```{r}
str(df_aug16)
df_aug16 <- df_aug16 %>% rename(c("lon"="x", "lat"="y"))
df_aug16$nrow <- seq.int(nrow(df_aug16))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_aug16[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2016 <- left_join(CARE_NH4_2016, df_aug16, by=c("nrow","lon","lat"))
str(CARE_NH4_2016)
CARE_NH4_2016 <- CARE_NH4_2016 %>% rename(c("NH4_aug16"="NH4"))
```

## September 2016
```{r}
outfile201609 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201609_201609.nc")

sep16 <- raster(outfile201609, level=180, varname="NH4")
proj4string(sep16) <- CRS("+init=EPSG:4326")
df_sep16 <- raster::as.data.frame(sep16, xy=T)
```

Modify df_sep16 so that it matches CARE
```{r}
str(df_sep16)
df_sep16 <- df_sep16 %>% rename(c("lon"="x", "lat"="y"))
df_sep16$nrow <- seq.int(nrow(df_sep16))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_sep16[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2016 <- left_join(CARE_NH4_2016, df_sep16, by=c("nrow","lon","lat"))
str(CARE_NH4_2016)
CARE_NH4_2016 <- CARE_NH4_2016 %>% rename(c("NH4_sep16"="NH4"))
```

## October 2016
```{r}
outfile201610 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201610_201610.nc")

oct16 <- raster(outfile201610, level=180, varname="NH4")
proj4string(oct16) <- CRS("+init=EPSG:4326")
df_oct16 <- raster::as.data.frame(oct16, xy=T)
```

Modify df_oct16 so that it matches CARE
```{r}
str(df_oct16)
df_oct16 <- df_oct16 %>% rename(c("lon"="x", "lat"="y"))
df_oct16$nrow <- seq.int(nrow(df_oct16))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_oct16[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2016 <- left_join(CARE_NH4_2016, df_oct16, by=c("nrow","lon","lat"))
str(CARE_NH4_2016)
CARE_NH4_2016 <- CARE_NH4_2016 %>% rename(c("NH4_oct16"="NH4"))
```

## November 2016
```{r}
outfile201611 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201611_201611.nc")

nov16 <- raster(outfile201611, level=180, varname="NH4")
proj4string(nov16) <- CRS("+init=EPSG:4326")
df_nov16 <- raster::as.data.frame(nov16, xy=T)
```

Modify df_nov16 so that it matches CARE
```{r}
str(df_nov16)
df_nov16 <- df_nov16 %>% rename(c("lon"="x", "lat"="y"))
df_nov16$nrow <- seq.int(nrow(df_nov16))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_nov16[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2016 <- left_join(CARE_NH4_2016, df_nov16, by=c("nrow","lon","lat"))
str(CARE_NH4_2016)
CARE_NH4_2016 <- CARE_NH4_2016 %>% rename(c("NH4_nov16"="NH4"))
```

## Remove dataframes not in use
First we need to remove objects not in use in order to create space for our file
```{r}
#Removing files that we don't need anymore
rm(dec15, jan16, feb16, mar16, apr16, may16, jun16, jul16, aug16, sep16, oct16, nov16, dec16)

#Then can remove objects that fit a certain pattern - i.e. those starting with outfile
rm(list=ls(, pattern="^outfile2"))
rm(list=ls(,pattern="^df_"))
```

## December 2016
```{r}
outfile201612 <- here::here("MonthlyNH4Data/GWRwSPEC_NH4_NA_201612_201612.nc")

dec16 <- raster(outfile201612, level=180, varname="NH4")
proj4string(dec16) <- CRS("+init=EPSG:4326")
df_dec16 <- raster::as.data.frame(dec16, xy=T)
```

Modify df_dec16 so that it matches CARE
```{r}
str(df_dec16)
df_dec16 <- df_dec16 %>% rename(c("lon"="x", "lat"="y"))
df_dec16$nrow <- seq.int(nrow(df_dec16))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_dec16[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2016 <- left_join(CARE_NH4_2016, df_dec16, by=c("nrow","lon","lat"))
str(CARE_NH4_2016)
CARE_NH4_2016 <- CARE_NH4_2016 %>% rename(c("NH4_dec16"="NH4"))
```

## Remove dataframes not in use
```{r}
#Then can remove objects that fit a certain pattern - i.e. those starting with outfile
rm(list=ls(, pattern="^outfile2"))

rm(list=ls(,pattern="^df_"))
```

## Make Excel file for year 2016
```{r}
write_xlsx(CARE_NH4_2016, path="CARE_fILD_2016_NH4_2021_11_05.xlsx")
system("say Just finished!")
```


# 2017
## January 2017
```{r}
outfile201701 <- here::here("MonthlyNH4Data/GWRwSPEC.HEI_NH4_NA_201701_201701.nc")

jan17 <- raster(outfile201701, level=180, varname="NH4")
proj4string(jan17) <- CRS("+init=EPSG:4326")
df_jan17 <- raster::as.data.frame(jan17, xy=T)
```

Modify df_jan17 so that it matches CARE
```{r}
str(df_jan17)
df_jan17 <- df_jan17 %>% rename(c("lon"="x", "lat"="y"))
df_jan17$nrow <- seq.int(nrow(df_jan17))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jan17[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2017 <- left_join(match, df_jan17, by="nrow")
str(CARE_NH4_2017)
CARE_NH4_2017 <- CARE_NH4_2017 %>% rename(c("NH4_jan17"="NH4"))
```

## February 2017
```{r}
outfile201702 <- here::here("MonthlyNH4Data/GWRwSPEC.HEI_NH4_NA_201702_201702.nc")

feb17 <- raster(outfile201702, level=180, varname="NH4")
proj4string(feb17) <- CRS("+init=EPSG:4326")
df_feb17 <- raster::as.data.frame(feb17, xy=T)
```

Modify df_feb17 so that it matches CARE
```{r}
str(df_feb17)
df_feb17 <- df_feb17 %>% rename(c("lon"="x", "lat"="y"))
df_feb17$nrow <- seq.int(nrow(df_feb17))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_feb17[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2017 <- left_join(CARE_NH4_2017, df_feb17, by=c("nrow","lon","lat"))
str(CARE_NH4_2017)
CARE_NH4_2017 <- CARE_NH4_2017 %>% rename(c("NH4_feb17"="NH4"))
```

## March 2017
```{r}
outfile201703 <- here::here("MonthlyNH4Data/GWRwSPEC.HEI_NH4_NA_201703_201703.nc")

mar17 <- raster(outfile201703, level=180, varname="NH4")
proj4string(mar17) <- CRS("+init=EPSG:4326")
df_mar17 <- raster::as.data.frame(mar17, xy=T)
```

Modify df_mar17 so that it matches CARE
```{r}
str(df_mar17)
df_mar17 <- df_mar17 %>% rename(c("lon"="x", "lat"="y"))
df_mar17$nrow <- seq.int(nrow(df_mar17))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_mar17[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2017 <- left_join(CARE_NH4_2017, df_mar17, by=c("nrow","lon","lat"))
str(CARE_NH4_2017)
CARE_NH4_2017 <- CARE_NH4_2017 %>% rename(c("NH4_mar17"="NH4"))
```

## April 2017
```{r}
outfile201704 <- here::here("MonthlyNH4Data/GWRwSPEC.HEI_NH4_NA_201704_201704.nc")

apr17 <- raster(outfile201704, level=180, varname="NH4")
proj4string(apr17) <- CRS("+init=EPSG:4326")
df_apr17 <- raster::as.data.frame(apr17, xy=T)
```

Modify df_apr17 so that it matches CARE
```{r}
str(df_apr17)
df_apr17 <- df_apr17 %>% rename(c("lon"="x", "lat"="y"))
df_apr17$nrow <- seq.int(nrow(df_apr17))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_apr17[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2017 <- left_join(CARE_NH4_2017, df_apr17, by=c("nrow","lon","lat"))
str(CARE_NH4_2017)
CARE_NH4_2017 <- CARE_NH4_2017 %>% rename(c("NH4_apr17"="NH4"))
```

## May 2017
```{r}
outfile201705 <- here::here("MonthlyNH4Data/GWRwSPEC.HEI_NH4_NA_201705_201705.nc")

may17 <- raster(outfile201705, level=180, varname="NH4")
proj4string(may17) <- CRS("+init=EPSG:4326")
df_may17 <- raster::as.data.frame(may17, xy=T)
```

Modify df_may17 so that it matches CARE
```{r}
str(df_may17)
df_may17 <- df_may17 %>% rename(c("lon"="x", "lat"="y"))
df_may17$nrow <- seq.int(nrow(df_may17))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_may17[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2017 <- left_join(CARE_NH4_2017, df_may17, by=c("nrow","lon","lat"))
str(CARE_NH4_2017)
CARE_NH4_2017 <- CARE_NH4_2017 %>% rename(c("NH4_may17"="NH4"))
```

## June 2017
```{r}
outfile201706 <- here::here("MonthlyNH4Data/GWRwSPEC.HEI_NH4_NA_201706_201706.nc")

jun17 <- raster(outfile201706, level=180, varname="NH4")
proj4string(jun17) <- CRS("+init=EPSG:4326")
df_jun17 <- raster::as.data.frame(jun17, xy=T)
```

Modify df_jun17 so that it matches CARE
```{r}
str(df_jun17)
df_jun17 <- df_jun17 %>% rename(c("lon"="x", "lat"="y"))
df_jun17$nrow <- seq.int(nrow(df_jun17))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jun17[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2017 <- left_join(CARE_NH4_2017, df_jun17, by=c("nrow","lon","lat"))
str(CARE_NH4_2017)
CARE_NH4_2017 <- CARE_NH4_2017 %>% rename(c("NH4_jun17"="NH4"))
```

## July 2017
```{r}
outfile201707 <- here::here("MonthlyNH4Data/GWRwSPEC.HEI_NH4_NA_201707_201707.nc")

jul17 <- raster(outfile201707, level=180, varname="NH4")
proj4string(jul17) <- CRS("+init=EPSG:4326")
df_jul17 <- raster::as.data.frame(jul17, xy=T)
```

Modify df_jul17 so that it matches CARE
```{r}
str(df_jul17)
df_jul17 <- df_jul17 %>% rename(c("lon"="x", "lat"="y"))
df_jul17$nrow <- seq.int(nrow(df_jul17))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_jul17[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2017 <- left_join(CARE_NH4_2017, df_jul17, by=c("nrow","lon","lat"))
str(CARE_NH4_2017)
CARE_NH4_2017 <- CARE_NH4_2017 %>% rename(c("NH4_jul17"="NH4"))
```

## August 2017
```{r}
outfile201708 <- here::here("MonthlyNH4Data/GWRwSPEC.HEI_NH4_NA_201708_201708.nc")

aug17 <- raster(outfile201708, level=180, varname="NH4")
proj4string(aug17) <- CRS("+init=EPSG:4326")
df_aug17 <- raster::as.data.frame(aug17, xy=T)
```

Modify df_aug17 so that it matches CARE
```{r}
str(df_aug17)
df_aug17 <- df_aug17 %>% rename(c("lon"="x", "lat"="y"))
df_aug17$nrow <- seq.int(nrow(df_aug17))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_aug17[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2017 <- left_join(CARE_NH4_2017, df_aug17, by=c("nrow","lon","lat"))
str(CARE_NH4_2017)
CARE_NH4_2017 <- CARE_NH4_2017 %>% rename(c("NH4_aug17"="NH4"))
```

## September 2017
```{r}
outfile201709 <- here::here("MonthlyNH4Data/GWRwSPEC.HEI_NH4_NA_201709_201709.nc")

sep17 <- raster(outfile201709, level=180, varname="NH4")
proj4string(sep17) <- CRS("+init=EPSG:4326")
df_sep17 <- raster::as.data.frame(sep17, xy=T)
```

Modify df_sep17 so that it matches CARE
```{r}
str(df_sep17)
df_sep17 <- df_sep17 %>% rename(c("lon"="x", "lat"="y"))
df_sep17$nrow <- seq.int(nrow(df_sep17))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_sep17[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2017 <- left_join(CARE_NH4_2017, df_sep17, by=c("nrow","lon","lat"))
str(CARE_NH4_2017)
CARE_NH4_2017 <- CARE_NH4_2017 %>% rename(c("NH4_sep17"="NH4"))
```

## October 2017
```{r}
outfile201710 <- here::here("MonthlyNH4Data/GWRwSPEC.HEI_NH4_NA_201710_201710.nc")

oct17 <- raster(outfile201710, level=180, varname="NH4")
proj4string(oct17) <- CRS("+init=EPSG:4326")
df_oct17 <- raster::as.data.frame(oct17, xy=T)
```

Modify df_oct17 so that it matches CARE
```{r}
str(df_oct17)
df_oct17 <- df_oct17 %>% rename(c("lon"="x", "lat"="y"))
df_oct17$nrow <- seq.int(nrow(df_oct17))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_oct17[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2017 <- left_join(CARE_NH4_2017, df_oct17, by=c("nrow","lon","lat"))
str(CARE_NH4_2017)
CARE_NH4_2017 <- CARE_NH4_2017 %>% rename(c("NH4_oct17"="NH4"))
```

## November 2017
```{r}
outfile201711 <- here::here("MonthlyNH4Data/GWRwSPEC.HEI_NH4_NA_201711_201711.nc")

nov17 <- raster(outfile201711, level=180, varname="NH4")
proj4string(nov17) <- CRS("+init=EPSG:4326")
df_nov17 <- raster::as.data.frame(nov17, xy=T)
```

Modify df_nov17 so that it matches CARE
```{r}
str(df_nov17)
df_nov17 <- df_nov17 %>% rename(c("lon"="x", "lat"="y"))
df_nov17$nrow <- seq.int(nrow(df_nov17))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_nov17[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2017 <- left_join(CARE_NH4_2017, df_nov17, by=c("nrow","lon","lat"))
str(CARE_NH4_2017)
CARE_NH4_2017 <- CARE_NH4_2017 %>% rename(c("NH4_nov17"="NH4"))
```

## Remove dataframes not in use
First we need to remove objects not in use in order to create space for our file
```{r}
#Removing files that we don't need anymore
rm(dec16, jan17, feb17, mar17, apr17, may17, jun17, jul17, aug17, sep17, oct17, nov17, dec17)

#Then can remove objects that fit a certain pattern - i.e. those starting with outfile
rm(list=ls(, pattern="^outfile2"))
rm(list=ls(,pattern="^df_"))
```

## December 2017
```{r}
outfile201712 <- here::here("MonthlyNH4Data/GWRwSPEC.HEI_NH4_NA_201712_201712.nc")

dec17 <- raster(outfile201712, level=180, varname="NH4")
proj4string(dec17) <- CRS("+init=EPSG:4326")
df_dec17 <- raster::as.data.frame(dec17, xy=T)
```

Modify df_dec17 so that it matches CARE
```{r}
str(df_dec17)
df_dec17 <- df_dec17 %>% rename(c("lon"="x", "lat"="y"))
df_dec17$nrow <- seq.int(nrow(df_dec17))
```

Create new columns in CARE that have the PM2.5 value for the lat/lon that is closest to the residential lat/lon
```{r}
match <- as.data.frame(nn2(df_dec17[,c(1,2)],S_coord[,c(2,3)],k=1))
match$ID <- S_coord$ID
match <- match %>% rename(c("nrow"="nn.idx", "dist"="nn.dists"))
CARE_NH4_2017 <- left_join(CARE_NH4_2017, df_dec17, by=c("nrow","lon","lat"))
str(CARE_NH4_2017)
CARE_NH4_2017 <- CARE_NH4_2017 %>% rename(c("NH4_dec17"="NH4"))
```

## Remove dataframes not in use
```{r}
#Then can remove objects that fit a certain pattern - i.e. those starting with outfile
rm(list=ls(, pattern="^outfile2"))

rm(list=ls(,pattern="^df_"))
```

## Make Excel file for year 2017
```{r}
write_xlsx(CARE_NH4_2017, path="CARE_fILD_2017_NH4_2021_11_05.xlsx")
system("say Just finished!")
```


## Remove dataframes not in use
```{r}
#Then can remove objects that fit a certain pattern - i.e. those starting with outfile
rm(list=ls(, pattern="^outfile2"))

rm(list=ls(,pattern="^df_"))
```


# Combine all CARE_NH4 files
Will produce a dataframe that has a column for the PM2.5 value for each month
```{r}
CARE_NH4 <- list(CARE_NH4_2000, CARE_NH4_2001, CARE_NH4_2002, CARE_NH4_2003, CARE_NH4_2004, CARE_NH4_2005, CARE_NH4_2006, CARE_NH4_2007, CARE_NH4_2008, CARE_NH4_2009, CARE_NH4_2010, CARE_NH4_2011, CARE_NH4_2012, CARE_NH4_2013, CARE_NH4_2014, CARE_NH4_2015, CARE_NH4_2016, CARE_NH4_2017) %>% reduce(left_join, by=c("nrow", "dist", "ID","lon","lat"))
```

## Convert that file into Excel for 2000-2018
```{r}
write_xlsx(CARE_NH4, path="CARE_fILD_2000_2017_NH4_2021_11_05.xlsx")
```


