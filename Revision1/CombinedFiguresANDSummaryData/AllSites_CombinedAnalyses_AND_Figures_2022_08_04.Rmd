---
title: "Combined Cohorts Figure Development"
author: "Gillian Goobie"
date: "04/01/2022"
output: 
  html_document: 
    toc: yes
    toc_float: yes
    number_sections: yes
    code_folding: hide
  bookdown::html_document2:
    toc: yes
    toc_float: yes
    number_sections: yes
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, message=FALSE, warning=FALSE, echo=F}
library(tidyverse)
library(readxl)
library(here)
library(writexl)
library(knitr)
library(lintr)
library(tidync)
library(maps)
library(ncmeta)
library(devtools)
library(RNetCDF)
library(ncdf4)
library(survival)
library(survminer)
library(lubridate)
library(cmprsk)
library(riskRegression)
library(prodlim)
library(RColorBrewer)
library(prodlim)
library(lme4)
library(performance)
library(psycho)
library(report)
library(rms)
library(splines)
library(Greg)
library(rstpm2)
library(pspline)
library(smoothHR)
library(raster)
library(forestplot)
```

# Importing Datasets
Here I am importing the file which contains monthly SS level estimates by satellite at nearest lon/lat to CAREPF patient residential addresses. These are linked to the patient ID.
```{r}
outfile1 <- here("AllSites_ConstituentsANDLungFxn_2022_04_01.xlsx")
constit <- read_excel(outfile1, sheet="constituent_breakdown")
fvc <- read_excel(outfile1, sheet="fvc_results")
dlco <- read_excel(outfile1, sheet="dlco_results")
```

# Stacked Bar Charts
## PM2.5 Total Mass
```{r}
str(constit)
constit$site <- as.factor(constit$site)
constit$site <- fct_relevel(constit$site, c("Simmons", "PFF", "CARE-PF"))

constit$constituent <- as.factor(constit$constituent)
constit$constituent <- fct_relevel(constit$constituent, c("SO4", "NO3", "NH4", "BC", "OM", "SS", "Soil", "Other"))
str(constit)
```

```{r}
(ggplot(constit, aes(fill=constituent, y=median, x=site))+
  geom_bar(position="stack", stat="identity")+
   labs(x="Cohort", y="Quantity of Each PM2.5 Constituent (ug/m^3)")+
   scale_fill_manual(values=c("SO4"="coral1", "NO3"="steelblue", "NH4"="gold1", "BC"="black", "OM"="green4", "SS"="slategray1", "Soil"="tan4", "Other"="wheat3")))
```

## Proportions
```{r}
(ggplot(constit, aes(fill=constituent, y=median, x=site))+
  geom_bar(position="fill", stat="identity")+
   labs(x="Cohort", y="Proportion of Each PM2.5 Constituent")+
   scale_fill_manual(values=c("SO4"="coral1", "NO3"="steelblue", "NH4"="gold1", "BC"="black", "OM"="green4", "SS"="slategray1", "Soil"="tan4", "Other"="wheat3")))
```


# Forest Plots
## FVC
### PM2.5, SO4, NO3, and NH4
```{r}
fvc <- structure(list(mean=c(NA, NA, -0.92, -0.53, -0.87, NA, -1.57, -2.06, -3.51, NA, -3.85, 0.11, -3.31, NA, -4.2, -2.8, -4.67),
                      lower=c(NA, NA, -1.43, -0.98, -1.26, NA, -2.48, -3.1, -4.8, NA, -7.43, -1.25, -5.38, NA, -6.57, -4.98, -7.29),
                      upper=c(NA, NA,  -0.41, -0.09, -0.48, NA, -0.67, -1.03, -2.22, NA, -0.28, 1.48, -1.24, NA, -1.84, -0.61, -2.04)),
                 .Names=c("mean","lower","upper"),
                 row.names=c(NA, -11L),
                 class="data.frame")

tabletext <- cbind(c("  Pollutant", "PM2.5", "  Simmons", "  PFF", "  CARE-PF", "SO4", "  Simmons", "  PFF", "  CARE-PF", "NO3", "  Simmons", "  PFF", "  CARE-PF", "NH4", "  Simmons", "  PFF", "  CARE-PF"),
                   c("Beta (95% CI)", "", "-0.92 (-1.43 to -0.41)", "-0.53 (-0.98 to -0.09)", "-0.87 (-1.26 to -0.48)", "", "-1.57 (-2.48 to -0.67)", "-2.06 (-3.10 to -1.03)", "-3.51 (-4.80 to -2.22)", "", "-3.85 (-7.43 to -0.28)", "0.11 (-1.25 to 1.48)", "-3.31 (-5.38 to -1.24)", "", "-4.20 (-6.57 to -1.84)", "-2.80 (-4.98 to -0.61)", "-4.67 (-7.29 to -2.04)"),
                   c("P-value", "", "0.0004", "0.02", "0.0001", "", "0.0007", "<0.0001", "<0.0001", "", "0.03", "0.87", "0.002", "", "0.0005", "0.01", "0.0005"))


fvc %>% forestplot(labeltext = tabletext, 
             is.summary = c(rep(TRUE, 2), rep(FALSE, 3), TRUE, rep(FALSE, 3), TRUE, rep(FALSE, 3), TRUE, rep(FALSE, 3)),
             clip = c(-8, 2), 
             col = fpColors(box = "royalblue",
                            line = "darkblue",
                           summary = "royalblue"))
```


### BC, OM, SS, and Soil
```{r}
fvc <- structure(list(mean=c(NA, NA, -5.71, -1.06, -7.92, NA, -2.62, 0.43, -0.27, NA, -26.36, -1.74, -7.07, NA, -7.24, 0.29, -4.11),
                      lower=c(NA, NA, -12.9, -4.24, -12.25, NA, -4.39, -0.41, -0.82, NA, -38.46, -4.02, -13.03, NA, -17.2, -1.82, -9.1),
                      upper=c(NA, NA, 1.48, 2.11, -3.60, NA, -0.86, 1.27, 0.28, NA, -14.27, 0.54, -1.11, NA, 2.71, 2.39, 0.88)),
                 .Names=c("mean","lower","upper"),
                 row.names=c(NA, -11L),
                 class="data.frame")

tabletext <- cbind(c("  Pollutant", "Black Carbon", "  Simmons", "  PFF", "  CARE-PF", "Organic Matter", "  Simmons", "  PFF", "  CARE-PF", "Sea Salt", "  Simmons", "  PFF", "  CARE-PF", "Soil", "  Simmons", "  PFF", "  CARE-PF"),
                   c("Beta (95% CI)", "", "-5.71 (-12.9 to 1.48)", "-1.06 (-4.24 to 2.11)", "-7.92 (-12.25 to -3.60)", "", "-2.62 (-4.39 to -0.86)", "0.43 (-0.41 to 1.27)", "-0.27 (-0.82 to 0.28)", "", "-26.36 (-38.46 to -14.27)", "-1.74 (-4.02 to 0.54)", "-7.07 (-13.03 to -1.11)", "", "-7.24 (-17.20 to 2.71)", "0.29 (-1.82 to 2.39)", "-4.11 (-9.10 to 0.88)"),
                   c("P-value", "", "0.12", "0.51", "0.0003", "", "0.003", "0.32", "0.34", "", "<0.0001", "0.14", "0.02", "", "0.15", "0.79", "0.11"))


fvc %>% forestplot(labeltext = tabletext, 
             is.summary = c(rep(TRUE, 2), rep(FALSE, 3), TRUE, rep(FALSE, 3), TRUE, rep(FALSE, 3), TRUE, rep(FALSE, 3)),
             clip = c(-30, 15), 
             col = fpColors(box = "royalblue",
                            line = "darkblue",
                           summary = "royalblue"))
```

## DLCO
### PM2.5, SO4, NO3, and NH4
```{r}
dlco <- structure(list(mean=c(NA, NA, 0.09, -0.92, 0.15, NA, 0.28, -3.54, 2.36, NA, 0.96, 0.64, 5.67, NA, 0.94, -5.55, 7.37),
                      lower=c(NA, NA, -0.44, -1.34, -0.29, NA, -0.66, -4.52, 0.81, NA, -2.72, -0.64, 3.23, NA, -1.51, -7.61, 4.24),
                      upper=c(NA, NA, 0.62, -0.50, 0.60, NA, 1.22, -2.57, 3.90, NA, 4.65, 1.93, 8.11, NA, 3.39, -3.49, 10.5)),
                 .Names=c("mean","lower","upper"),
                 row.names=c(NA, -11L),
                 class="data.frame")

tabletext <- cbind(c("  Pollutant", "PM2.5", "  Simmons", "  PFF", "  CARE-PF", "SO4", "  Simmons", "  PFF", "  CARE-PF", "NO3", "  Simmons", "  PFF", "  CARE-PF", "NH4", "  Simmons", "  PFF", "  CARE-PF"),
                   c("Beta (95% CI)", "", "0.09 (-0.44 to 0.62)", "-0.92 (-1.34 to -0.50)", "0.15 (-0.29 to 0.60)", "", "0.28 (-0.66 to 1.22)", "-3.54 (-4.52 to -2.57)", "2.36 (0.81 to 3.90)", "", "0.96 (-2.72 to 4.65)", "0.64 (-0.64 to 1.93)", "5.67 (3.23 to 8.11)", "", "0.94 (-1.51 to 3.39)", "-5.55 (-7.61 to -3.49)", "7.37 (4.24 to 10.5)"),
                   c("P-value", "", "0.74", "<0.0001", "0.50", "", "0.56", "<0.0001", "0.003", "", "0.61", "0.33", "<0.0001", "", "0.45", "<0.0001", "<0.0001"))


dlco %>% forestplot(labeltext = tabletext, 
             is.summary = c(rep(TRUE, 2), rep(FALSE, 3), TRUE, rep(FALSE, 3), TRUE, rep(FALSE, 3), TRUE, rep(FALSE, 3)),
             clip = c(-8, 11), 
             col = fpColors(box = "royalblue",
                            line = "darkblue",
                           summary = "royalblue"))
```


### BC, OM, SS, and Soil
```{r}
dlco <- structure(list(mean=c(NA, NA, 4.56, -4.18, -4.46, NA, -0.70, -0.27, -0.78, NA, -13.87, 3.13, -20.44, NA, -0.51, 2.30, 7.57),
                      lower=c(NA, NA, -2.92, -7.16, -9.42, NA, -2.51, -1.07, -1.39, NA, -26.33, 0.90, -26.81, NA, -10.66, 0.29, 1.67),
                      upper=c(NA, NA,  12.04, -1.19, 0.50, NA, 1.11, 0.52, -0.17, NA, -1.41, 5.37, -14.07, NA, 9.64, 4.31, 13.48)),
                 .Names=c("mean","lower","upper"),
                 row.names=c(NA, -11L),
                 class="data.frame")

tabletext <- cbind(c("  Pollutant", "Black Carbon", "  Simmons", "  PFF", "  CARE-PF", "Organic Matter", "  Simmons", "  PFF", "  CARE-PF", "Sea Salt", "  Simmons", "  PFF", "  CARE-PF", "Soil", "  Simmons", "  PFF", "  CARE-PF"),
                   c("Beta (95% CI)", "", "4.56 (-2.92 to 12.04)", "-4.18 (-7.16 to -1.19)", "-4.46 (-9.42 to 0.50)", "", "-0.70 (-2.51 to 1.11)", "-0.27 (-1.07 to 0.52)", "-0.78 (-1.39 to -0.17)", "", "-13.87 (-26.33 to -1.41)", "3.13 (0.90 to 5.37)", "-20.44 (-26.81 to -14.07)", "", "-0.51 (-10.66 to 9.64)", "2.30 (0.29 to 4.31)", "7.57 (1.67 to 13.48)"),
                   c("P-value", "", "0.23", "0.006", "0.08", "", "0.45", "0.50", "0.01", "", "0.03", "0.006", "<0.0001", "", "0.92", "0.02", "0.01"))


dlco %>% forestplot(labeltext = tabletext, 
             is.summary = c(rep(TRUE, 2), rep(FALSE, 3), TRUE, rep(FALSE, 3), TRUE, rep(FALSE, 3), TRUE, rep(FALSE, 3)),
             clip = c(-25, 15), 
             col = fpColors(box = "royalblue",
                            line = "darkblue",
                           summary = "royalblue"))
```



# Scatterplot Matrix
Upload Simmons PM2.5 matching data
```{r}
outfile2 <- here("Simmons_fILD_AllConstituentsMatched_2022_07_28.xlsx")
PM_Simm <- read_excel(outfile2, na="")
# Create cohort column
PM_Simm <- PM_Simm %>% mutate(cohort="Simmons")
PM_Simm <- PM_Simm %>% mutate(site="Simmons")
PM_Simm <- PM_Simm %>% dplyr::select(ID, cohort, site, dx_IPF, dx_yr, sex, race, dich_Race, smokeHx, age_dx, status, dx, dx_group, DeathTxCensor_date, fvc_pct, dlco_pct, time_DeathTxCensor, PM_5yrPreDx, PM_5yrPreCensor, SO4_5yrPreDx, SO4_5yrPreCensor, NO3_5yrPreDx, NO3_5yrPreCensor, NH4_5yrPreDx, NH4_5yrPreCensor, BC_5yrPreDx, BC_5yrPreCensor, OM_5yrPreDx, OM_5yrPreCensor, SS_5yrPreDx, SS_5yrPreCensor, Soil_5yrPreDx, Soil_5yrPreCensor)
```

PFF data
```{r}
outfile3 <- here("PFF_fILD_AllConstituentsMatched_2022_07_28.xlsx")
PM_PFF <- read_excel(outfile3, na="")
# Create cohort column
PM_PFF <- PM_PFF %>% mutate(cohort="PFF")
PM_PFF$ID <- paste(rep(1, 5), PM_PFF$ID, sep="")
PM_PFF <- PM_PFF %>% dplyr::select(ID, cohort, site, dx_IPF, dx_yr, sex, race, dich_Race, smokeHx, age_dx, status, dx, dx_group, DeathTxCensor_date, fvc_pct, dlco_pct, time_DeathTxCensor, PM_5yrPreDx, PM_5yrPreCensor, SO4_5yrPreDx, SO4_5yrPreCensor, NO3_5yrPreDx, NO3_5yrPreCensor, NH4_5yrPreDx, NH4_5yrPreCensor, BC_5yrPreDx, BC_5yrPreCensor, OM_5yrPreDx, OM_5yrPreCensor, SS_5yrPreDx, SS_5yrPreCensor, Soil_5yrPreDx, Soil_5yrPreCensor)
```

CARE-PF data
```{r}
outfile4 <- here("CAREPF_fILD_AllConstituentsMatched_2022_07_28.xlsx")
PM_CARE <- read_excel(outfile4, na="")
# Create cohort column
PM_CARE <- PM_CARE %>% mutate(cohort="CARE-PF")
PM_CARE <- PM_CARE %>% dplyr::select(ID, cohort, site, dx_IPF, dx_yr, sex, race, dich_Race, smokeHx, age_dx, status, dx, dx_group, DeathTxCensor_date, fvc_pct, dlco_pct, time_DeathTxCensor, PM_5yrPreDx, PM_5yrPreCensor, SO4_5yrPreDx, SO4_5yrPreCensor, NO3_5yrPreDx, NO3_5yrPreCensor, NH4_5yrPreDx, NH4_5yrPreCensor, BC_5yrPreDx, BC_5yrPreCensor, OM_5yrPreDx, OM_5yrPreCensor, SS_5yrPreDx, SS_5yrPreCensor, Soil_5yrPreDx, Soil_5yrPreCensor)
```

Combine the files
```{r}
PM <- rbind(PM_Simm, PM_PFF, PM_CARE)
```

# Correcting Factor Variables
```{r}
PM$site <- fct_relevel(PM$site, c("Simmons"))
PM$cohort <- fct_relevel(PM$cohort, c("Simmons", "PFF", "CARE-PF"))

PM$sex <- fct_relevel(PM$sex, c("Male","Female"))
PM$race <- fct_relevel(PM$race, c("W","B","A","I","U"))
PM$dich_Race <- fct_relevel(PM$dich_Race, c("White","Non-White"))
PM$smokeHx <- fct_relevel(PM$smokeHx, c("Never","Ever"))

#For dx and dx_group, I just want IPF to be first and then the rest of the categories are alphabetical
PM$dx <- fct_relevel(PM$dx, c("IPF"))
PM$dx_group <- fct_relevel(PM$dx_group, c("IPF"))
PM$dx_IPF <- fct_relevel(PM$dx_IPF, c("IPF"))
str(PM)
```

# Determining NH4 Source
Will first make molecular weight columns
```{r}
PM <- PM %>% mutate(mw_NH42SO4=132.138)
PM <- PM %>% mutate(mw_NH4NO3=80.043)
PM <- PM %>% mutate(mw_NH4=18.039)
PM <- PM %>% mutate(mw_SO4=96.06)
PM <- PM %>% mutate(mw_NO3=62.004)
```

Next will determine the fraction of NH4 that should be associated with SO4
```{r}
PM$propNH4wSO4 <- (132.138-96.06)/96.06
```

Next will determine the fraction of NH4 that should be associated with NO3
```{r}
PM$propNH4wNO3 <- (80.043-62.004)/62.004
```

Next determine the mass of NH4 assoc with SO4 for each patient
```{r}
PM <- PM %>% group_by(ID) %>% mutate(massNH4wSO4=(SO4_5yrPreCensor*propNH4wSO4))
```

Next determine the mass of NH4 assoc with NO3 for each patient
```{r}
PM <- PM %>% group_by(ID) %>% mutate(massNH4wNO3=(NO3_5yrPreCensor*propNH4wNO3))
```

Determine percent of NH4 associated with SO4 and NO3
```{r}
PM <- PM %>% group_by(ID) %>% mutate(pctNH4wSO4andNO3=((massNH4wSO4 + massNH4wNO3)/NH4_5yrPreCensor)*100)
summary(PM$pctNH4wSO4andNO3, na.rm=T)
```


# Median/IQR of Pollutants by Cohort/Site
```{r}
group_by(PM, site) %>%
  summarise(
    count = n(),
    mean = mean(PM_5yrPreCensor, na.rm = TRUE),
    sd = sd(PM_5yrPreCensor, na.rm = TRUE),
    median = median(PM_5yrPreCensor, na.rm = TRUE),
    quantile = quantile(PM_5yrPreCensor, probs=c(0.25), na.rm = TRUE),
    quantile2 = quantile(PM_5yrPreCensor, probs=c(0.75), na.rm = TRUE)
  )

group_by(PM, site) %>%
  summarise(
    count = n(),
    mean = mean(SO4_5yrPreCensor, na.rm = TRUE),
    sd = sd(SO4_5yrPreCensor, na.rm = TRUE),
    median = median(SO4_5yrPreCensor, na.rm = TRUE),
    quantile = quantile(SO4_5yrPreCensor, probs=c(0.25), na.rm = TRUE),
    quantile2 = quantile(SO4_5yrPreCensor, probs=c(0.75), na.rm = TRUE)
  )

group_by(PM, site) %>%
  summarise(
    count = n(),
    mean = mean(NO3_5yrPreCensor, na.rm = TRUE),
    sd = sd(NO3_5yrPreCensor, na.rm = TRUE),
    median = median(NO3_5yrPreCensor, na.rm = TRUE),
    quantile = quantile(NO3_5yrPreCensor, probs=c(0.25), na.rm = TRUE),
    quantile2 = quantile(NO3_5yrPreCensor, probs=c(0.75), na.rm = TRUE)
  )

group_by(PM, site) %>%
  summarise(
    count = n(),
    mean = mean(NH4_5yrPreCensor, na.rm = TRUE),
    sd = sd(NH4_5yrPreCensor, na.rm = TRUE),
    median = median(NH4_5yrPreCensor, na.rm = TRUE),
    quantile = quantile(NH4_5yrPreCensor, probs=c(0.25), na.rm = TRUE),
    quantile2 = quantile(NH4_5yrPreCensor, probs=c(0.75), na.rm = TRUE)
  )

group_by(PM, site) %>%
  summarise(
    count = n(),
    mean = mean(BC_5yrPreCensor, na.rm = TRUE),
    sd = sd(BC_5yrPreCensor, na.rm = TRUE),
    median = median(BC_5yrPreCensor, na.rm = TRUE),
    quantile = quantile(BC_5yrPreCensor, probs=c(0.25), na.rm = TRUE),
    quantile2 = quantile(BC_5yrPreCensor, probs=c(0.75), na.rm = TRUE)
  )

group_by(PM, site) %>%
  summarise(
    count = n(),
    mean = mean(OM_5yrPreCensor, na.rm = TRUE),
    sd = sd(OM_5yrPreCensor, na.rm = TRUE),
    median = median(OM_5yrPreCensor, na.rm = TRUE),
    quantile = quantile(OM_5yrPreCensor, probs=c(0.25), na.rm = TRUE),
    quantile2 = quantile(OM_5yrPreCensor, probs=c(0.75), na.rm = TRUE)
  )

group_by(PM, site) %>%
  summarise(
    count = n(),
    mean = mean(SS_5yrPreCensor, na.rm = TRUE),
    sd = sd(SS_5yrPreCensor, na.rm = TRUE),
    median = median(SS_5yrPreCensor, na.rm = TRUE),
    quantile = quantile(SS_5yrPreCensor, probs=c(0.25), na.rm = TRUE),
    quantile2 = quantile(SS_5yrPreCensor, probs=c(0.75), na.rm = TRUE)
  )

group_by(PM, site) %>%
  summarise(
    count = n(),
    mean = mean(Soil_5yrPreCensor, na.rm = TRUE),
    sd = sd(Soil_5yrPreCensor, na.rm = TRUE),
    median = median(Soil_5yrPreCensor, na.rm = TRUE),
    quantile = quantile(Soil_5yrPreCensor, probs=c(0.25), na.rm = TRUE),
    quantile2 = quantile(Soil_5yrPreCensor, probs=c(0.75), na.rm = TRUE)
  )
```

# Status and Time_DeathTxCensoring across full cohort
```{r}
table(PM$status)
summary(PM$time_DeathTxCensor)
```

# Correlation between 5yr Pre-Censor and 5yr Pre-Dx
```{r}
colnames(PM)
GGally::ggpairs(PM, columns=c(18:19), aes(color=PM$cohort))
```



# Tornado Plot for Multi-Constituent Models
```{r}
outfile5 <- here("EffectEstimates_ForMetaAnalysis_2022_07_29.xlsx")
multi <- read_excel(outfile5, sheet="MultiConstituentModelResults")

multi$pollutant <- fct_relevel(multi$pollutant, c("Soil", "SS", "OM", "BC", "NH4", "NO3", "SO4"))
```

## Tornado plot for Mortality Models
### Simmons
```{r}
mort_Simm <- multi %>% filter(cohort=="Simmons" & outcome=="mortality")
(mort_Simm %>% ggplot(aes(x=effect, y=pollutant, fill=pollutant))+
  geom_bar(stat="identity", position="identity", width=0.75)+
    scale_fill_manual(values = c("SO4" = "firebrick2",
                               "NO3" = "firebrick2",
                               "NH4" = "firebrick2",
                               "BC" = "forestgreen",
                               "OM" = "firebrick2",
                               "SS"="forestgreen",
                               "Soil"="firebrick2"))+
    scale_x_continuous(limits = c(-1, 1), expand = c(0, 0))+
    geom_text(aes(label=effect), stat="identity", position=position_stack(vjust=0.5), color="black")+
    theme_bw()+
    labs(x="Effect Size", y="PM2.5 Constituent"))
```

### PFF
```{r}
mort_PFF <- multi %>% filter(cohort=="PFF" & outcome=="mortality")
(mort_PFF %>% ggplot(aes(x=effect, y=pollutant, fill=pollutant))+
  geom_bar(stat="identity", position="identity", width=0.75)+
    scale_fill_manual(values = c("SO4" = "firebrick2",
                               "NO3" = "forestgreen",
                               "NH4" = "firebrick2",
                               "BC" = "forestgreen",
                               "OM" = "forestgreen",
                               "SS"="forestgreen",
                               "Soil"="firebrick2"))+
    scale_x_continuous(limits = c(-1, 1), expand = c(0, 0))+
    geom_text(aes(label=effect), stat="identity", position=position_stack(vjust=0.5), color="black")+
    theme_bw()+
    labs(x="Effect Size", y="PM2.5 Constituent"))
```

### CARE-PF
```{r}
mort_CARE <- multi %>% filter(cohort=="CARE-PF" & outcome=="mortality")
(mort_CARE %>% ggplot(aes(x=effect, y=pollutant, fill=pollutant))+
  geom_bar(stat="identity", position="identity", width=0.75)+
    scale_fill_manual(values = c("SO4" = "firebrick2",
                               "NO3" = "forestgreen",
                               "NH4" = "firebrick2",
                               "BC" = "forestgreen",
                               "OM" = "firebrick2",
                               "SS"="firebrick2",
                               "Soil"="forestgreen"))+
    scale_x_continuous(limits = c(-1, 1), expand = c(0, 0))+
    geom_text(aes(label=effect), stat="identity", position=position_stack(vjust=0.5), color="black")+
    theme_bw()+
    labs(x="Effect Size", y="PM2.5 Constituent"))
```

## Tornado plot for Baseline FVC Models
### Simmons
```{r}
FVC_Simm <- multi %>% filter(cohort=="Simmons" & outcome=="baselineFVC")
(FVC_Simm %>% ggplot(aes(x=effect, y=pollutant, fill=pollutant))+
  geom_bar(stat="identity", position="identity", width=0.75)+
    scale_fill_manual(values = c("SO4" = "firebrick2",
                               "NO3" = "firebrick2",
                               "NH4" = "firebrick2",
                               "BC" = "forestgreen",
                               "OM" = "firebrick2",
                               "SS"="forestgreen",
                               "Soil"="forestgreen"))+
    scale_x_continuous(limits = c(-1, 1), expand = c(0, 0))+
    geom_text(aes(label=effect), stat="identity", position=position_stack(vjust=0.5), color="black")+
    theme_bw()+
    labs(x="Effect Size", y="PM2.5 Constituent"))
```

### PFF
```{r}
FVC_PFF <- multi %>% filter(cohort=="PFF" & outcome=="baselineFVC")
(FVC_PFF %>% ggplot(aes(x=effect, y=pollutant, fill=pollutant))+
  geom_bar(stat="identity", position="identity", width=0.75)+
    scale_fill_manual(values = c("SO4" = "firebrick2",
                               "NO3" = "firebrick2",
                               "NH4" = "firebrick2",
                               "BC" = "forestgreen",
                               "OM" = "forestgreen",
                               "SS"="forestgreen",
                               "Soil"="forestgreen"))+
    scale_x_continuous(limits = c(-1, 1), expand = c(0, 0))+
    geom_text(aes(label=effect), stat="identity", position=position_stack(vjust=0.5), color="black")+
    theme_bw()+
    labs(x="Effect Size", y="PM2.5 Constituent"))
```

### CARE-PF
```{r}
FVC_CARE <- multi %>% filter(cohort=="CARE-PF" & outcome=="baselineFVC")
(FVC_CARE %>% ggplot(aes(x=effect, y=pollutant, fill=pollutant))+
  geom_bar(stat="identity", position="identity", width=0.75)+
    scale_fill_manual(values = c("SO4" = "firebrick2",
                               "NO3" = "forestgreen",
                               "NH4" = "firebrick2",
                               "BC" = "firebrick2",
                               "OM" = "firebrick2",
                               "SS"="firebrick2",
                               "Soil"="forestgreen"))+
    scale_x_continuous(limits = c(-1, 1), expand = c(0, 0))+
    geom_text(aes(label=effect), stat="identity", position=position_stack(vjust=0.5), color="black")+
    theme_bw()+
    labs(x="Effect Size", y="PM2.5 Constituent"))
```


## Tornado plot for Baseline DLCO Models
### Simmons
```{r}
DLCO_Simm <- multi %>% filter(cohort=="Simmons" & outcome=="baselineDLCO")
(DLCO_Simm %>% ggplot(aes(x=effect, y=pollutant, fill=pollutant))+
  geom_bar(stat="identity", position="identity", width=0.75)+
    scale_fill_manual(values = c("SO4" = "firebrick2",
                               "NO3" = "firebrick2",
                               "NH4" = "firebrick2",
                               "BC" = "forestgreen",
                               "OM" = "firebrick2",
                               "SS"="forestgreen",
                               "Soil"="firebrick2"))+
    scale_x_continuous(limits = c(-1, 1), expand = c(0, 0))+
    geom_text(aes(label=effect), stat="identity", position=position_stack(vjust=0.5), color="black")+
    theme_bw()+
    labs(x="Effect Size", y="PM2.5 Constituent"))
```

### PFF
```{r}
DLCO_PFF <- multi %>% filter(cohort=="PFF" & outcome=="baselineDLCO")
(DLCO_PFF %>% ggplot(aes(x=effect, y=pollutant, fill=pollutant))+
  geom_bar(stat="identity", position="identity", width=0.75)+
    scale_fill_manual(values = c("SO4" = "firebrick2",
                               "NO3" = "forestgreen",
                               "NH4" = "firebrick2",
                               "BC" = "forestgreen",
                               "OM" = "forestgreen",
                               "SS"="forestgreen",
                               "Soil"="forestgreen"))+
    scale_x_continuous(limits = c(-1, 1), expand = c(0, 0))+
    geom_text(aes(label=effect), stat="identity", position=position_stack(vjust=0.5), color="black")+
    theme_bw()+
    labs(x="Effect Size", y="PM2.5 Constituent"))
```

### CARE-PF
```{r}
DLCO_CARE <- multi %>% filter(cohort=="CARE-PF" & outcome=="baselineDLCO")
(DLCO_CARE %>% ggplot(aes(x=effect, y=pollutant, fill=pollutant))+
  geom_bar(stat="identity", position="identity", width=0.75)+
    scale_fill_manual(values = c("SO4" = "firebrick2",
                               "NO3" = "forestgreen",
                               "NH4" = "firebrick2",
                               "BC" = "forestgreen",
                               "OM" = "firebrick2",
                               "SS"="firebrick2",
                               "Soil"="forestgreen"))+
    scale_x_continuous(limits = c(-1, 1), expand = c(0, 0))+
    geom_text(aes(label=effect), stat="identity", position=position_stack(vjust=0.5), color="black")+
    theme_bw()+
    labs(x="Effect Size", y="PM2.5 Constituent"))
```



## Scatterplot Matrix
```{r, fig.height=7, fig.width=10}
colnames(PM)
GGally::ggpairs(PM, columns=c(19, 21, 23, 25, 27, 29, 31, 33), aes(color=PM$cohort))
```


Scatterplot of continuous PM_5yrPreCensor vs SO4_5yrPreCensor
```{r, height=5, width=5}
(PM %>% ggplot(aes(x=PM_5yrPreCensor, y=SO4_5yrPreCensor, color=cohort))+
   geom_point(alpha=0.7)+
   labs(x="PM2.5 in 5yr Pre-Censoring", y="SO4 in the 1year Pre-Sampling", title="PM2.5 and SO4 Constituent Correlation")+
   theme(plot.title = element_text(hjust = 0.5))+     
   geom_smooth(method="lm", se = FALSE) +
   scale_color_manual(values=c("gold1", "steelblue1", "red"))+
   xlim(2.5, 17)+
   ylim(0, 6.5))
```

Scatterplot of continuous PM_5yrPreCensor vs NO3_5yrPreCensor
```{r, height=5, width=5}
(PM %>% ggplot(aes(x=PM_5yrPreCensor, y=NO3_5yrPreCensor, color=cohort))+
   geom_point(alpha=0.7)+
   labs(x="PM2.5 in 5yr Pre-Censoring", y="NO3 in the 1year Pre-Sampling", title="PM2.5 and NO3 Constituent Correlation")+
   theme(plot.title = element_text(hjust = 0.5))+     
   geom_smooth(method="lm", se = FALSE) +
   scale_color_manual(values=c("gold1", "steelblue1", "red"))+
   xlim(2.5, 17)+
   ylim(0, 4))
```

Scatterplot of continuous PM_5yrPreCensor vs NH4_5yrPreCensor
```{r, height=5, width=5}
(PM %>% ggplot(aes(x=PM_5yrPreCensor, y=NH4_5yrPreCensor, color=cohort))+
   geom_point(alpha=0.7)+
   labs(x="PM2.5 in 5yr Pre-Censoring", y="NH4 in the 1year Pre-Sampling", title="PM2.5 and NH4 Constituent Correlation")+
   theme(plot.title = element_text(hjust = 0.5))+     
   geom_smooth(method="lm", se = FALSE) +
   scale_color_manual(values=c("gold1", "steelblue1", "red"))+
   xlim(2.5, 17)+
   ylim(0, 2.5))
```

Scatterplot of continuous PM_5yrPreCensor vs BC_5yrPreCensor
```{r, height=5, width=5}
(PM %>% ggplot(aes(x=PM_5yrPreCensor, y=BC_5yrPreCensor, color=cohort))+
   geom_point(alpha=0.7)+
   labs(x="PM2.5 in 5yr Pre-Censoring", y="BC in the 1year Pre-Sampling", title="PM2.5 and BC Constituent Correlation")+
   theme(plot.title = element_text(hjust = 0.5))+     
   geom_smooth(method="lm", se = FALSE) +
   scale_color_manual(values=c("gold1", "steelblue1", "red"))+
   xlim(2.5, 17)+
   ylim(0, 1.75))
```

Scatterplot of continuous PM_5yrPreCensor vs OM_5yrPreCensor
```{r, height=5, width=5}
(PM %>% ggplot(aes(x=PM_5yrPreCensor, y=OM_5yrPreCensor, color=cohort))+
   geom_point(alpha=0.7)+
   labs(x="PM2.5 in 5yr Pre-Censoring", y="OM in the 1year Pre-Sampling", title="PM2.5 and OM Constituent Correlation")+
   theme(plot.title = element_text(hjust = 0.5))+     
   geom_smooth(method="lm", se = FALSE) +
   scale_color_manual(values=c("gold1", "steelblue1", "red"))+
   xlim(2.5, 17)+
   ylim(0, 7))
```

Scatterplot of continuous PM_5yrPreCensor vs SS_5yrPreCensor
```{r, height=5, width=5}
(PM %>% ggplot(aes(x=PM_5yrPreCensor, y=SS_5yrPreCensor, color=cohort))+
   geom_point(alpha=0.7)+
   labs(x="PM2.5 in 5yr Pre-Censoring", y="SS in the 1year Pre-Sampling", title="PM2.5 and SS Constituent Correlation")+
   theme(plot.title = element_text(hjust = 0.5))+     
   geom_smooth(method="lm", se = FALSE) +
   scale_color_manual(values=c("gold1", "steelblue1", "red"))+
   xlim(2.5, 17)+
   ylim(0, 3))
```

Scatterplot of continuous PM_5yrPreCensor vs Soil_5yrPreCensor
```{r, height=5, width=5}
(PM %>% ggplot(aes(x=PM_5yrPreCensor, y=Soil_5yrPreCensor, color=cohort))+
   geom_point(alpha=0.7)+
   labs(x="PM2.5 in 5yr Pre-Censoring", y="Soil in the 1year Pre-Sampling", title="PM2.5 and Soil Constituent Correlation")+
   theme(plot.title = element_text(hjust = 0.5))+     
   geom_smooth(method="lm", se = FALSE) +
   scale_color_manual(values=c("gold1", "steelblue1", "red"))+
   xlim(2.5, 17)+
   ylim(0, 2.5))
```

Scatterplot of continuous SO4_5yrPreCensor vs NO3_5yrPreCensor
```{r, height=5, width=5}
(PM %>% ggplot(aes(x=SO4_5yrPreCensor, y=NO3_5yrPreCensor, color=cohort))+
   geom_point(alpha=0.7)+
   labs(x="SO4 in 5yr Pre-Censoring", y="NO3 in the 1year Pre-Sampling", title="SO4 and NO3 Constituent Correlation")+
   theme(plot.title = element_text(hjust = 0.5))+     
   geom_smooth(method="lm", se = FALSE) +
   scale_color_manual(values=c("gold1", "steelblue1", "red"))+
   xlim(0, 6.5)+
   ylim(0, 4))
```

Scatterplot of continuous SO4_5yrPreCensor vs NH4_5yrPreCensor
```{r, height=5, width=5}
(PM %>% ggplot(aes(x=SO4_5yrPreCensor, y=NH4_5yrPreCensor, color=cohort))+
   geom_point(alpha=0.7)+
   labs(x="SO4 in 5yr Pre-Censoring", y="NH4 in the 1year Pre-Sampling", title="SO4 and NH4 Constituent Correlation")+
   theme(plot.title = element_text(hjust = 0.5))+     
   geom_smooth(method="lm", se = FALSE) +
   scale_color_manual(values=c("gold1", "steelblue1", "red"))+
   xlim(0, 6.5)+
   ylim(0, 2.5))
```

Scatterplot of continuous SO4_5yrPreCensor vs BC_5yrPreCensor
```{r, height=5, width=5}
(PM %>% ggplot(aes(x=SO4_5yrPreCensor, y=BC_5yrPreCensor, color=cohort))+
   geom_point(alpha=0.7)+
   labs(x="SO4 in 5yr Pre-Censoring", y="BC in the 1year Pre-Sampling", title="SO4 and BC Constituent Correlation")+
   theme(plot.title = element_text(hjust = 0.5))+     
   geom_smooth(method="lm", se = FALSE) +
   scale_color_manual(values=c("gold1", "steelblue1", "red"))+
   xlim(0, 6.5)+
   ylim(0, 1.75))
```

Scatterplot of continuous SO4_5yrPreCensor vs OM_5yrPreCensor
```{r, height=5, width=5}
(PM %>% ggplot(aes(x=SO4_5yrPreCensor, y=OM_5yrPreCensor, color=cohort))+
   geom_point(alpha=0.7)+
   labs(x="SO4 in 5yr Pre-Censoring", y="OM in the 1year Pre-Sampling", title="SO4 and OM Constituent Correlation")+
   theme(plot.title = element_text(hjust = 0.5))+     
   geom_smooth(method="lm", se = FALSE) +
   scale_color_manual(values=c("gold1", "steelblue1", "red"))+
   xlim(0, 6.5)+
   ylim(0, 7))
```

Scatterplot of continuous SO4_5yrPreCensor vs SS_5yrPreCensor
```{r, height=5, width=5}
(PM %>% ggplot(aes(x=SO4_5yrPreCensor, y=SS_5yrPreCensor, color=cohort))+
   geom_point(alpha=0.7)+
   labs(x="SO4 in 5yr Pre-Censoring", y="SS in the 1year Pre-Sampling", title="SO4 and SS Constituent Correlation")+
   theme(plot.title = element_text(hjust = 0.5))+     
   geom_smooth(method="lm", se = FALSE) +
   scale_color_manual(values=c("gold1", "steelblue1", "red"))+
   xlim(0, 6.5)+
   ylim(0, 3))
```

Scatterplot of continuous SO4_5yrPreCensor vs Soil_5yrPreCensor
```{r, height=5, width=5}
(PM %>% ggplot(aes(x=SO4_5yrPreCensor, y=Soil_5yrPreCensor, color=cohort))+
   geom_point(alpha=0.7)+
   labs(x="SO4 in 5yr Pre-Censoring", y="Soil in the 1year Pre-Sampling", title="SO4 and Soil Constituent Correlation")+
   theme(plot.title = element_text(hjust = 0.5))+     
   geom_smooth(method="lm", se = FALSE) +
   scale_color_manual(values=c("gold1", "steelblue1", "red"))+
   xlim(0, 6.5)+
   ylim(0, 2.5))
```

Scatterplot of continuous NO3_5yrPreCensor vs NH4_5yrPreCensor
```{r, height=5, width=5}
(PM %>% ggplot(aes(x=NO3_5yrPreCensor, y=NH4_5yrPreCensor, color=cohort))+
   geom_point(alpha=0.7)+
   labs(x="NO3 in 5yr Pre-Censoring", y="NH4 in the 1year Pre-Sampling", title="NO3 and NH4 Constituent Correlation")+
   theme(plot.title = element_text(hjust = 0.5))+     
   geom_smooth(method="lm", se = FALSE) +
   scale_color_manual(values=c("gold1", "steelblue1", "red"))+
   xlim(0, 4)+
   ylim(0, 2.5))
```

Scatterplot of continuous NO3_5yrPreCensor vs BC_5yrPreCensor
```{r, height=5, width=5}
(PM %>% ggplot(aes(x=NO3_5yrPreCensor, y=BC_5yrPreCensor, color=cohort))+
   geom_point(alpha=0.7)+
   labs(x="NO3 in 5yr Pre-Censoring", y="BC in the 1year Pre-Sampling", title="NO3 and BC Constituent Correlation")+
   theme(plot.title = element_text(hjust = 0.5))+     
   geom_smooth(method="lm", se = FALSE) +
   scale_color_manual(values=c("gold1", "steelblue1", "red"))+
   xlim(0, 4)+
   ylim(0, 1.75))
```

Scatterplot of continuous NO3_5yrPreCensor vs OM_5yrPreCensor
```{r, height=5, width=5}
(PM %>% ggplot(aes(x=NO3_5yrPreCensor, y=OM_5yrPreCensor, color=cohort))+
   geom_point(alpha=0.7)+
   labs(x="NO3 in 5yr Pre-Censoring", y="OM in the 1year Pre-Sampling", title="NO3 and OM Constituent Correlation")+
   theme(plot.title = element_text(hjust = 0.5))+     
   geom_smooth(method="lm", se = FALSE) +
   scale_color_manual(values=c("gold1", "steelblue1", "red"))+
   xlim(0, 4)+
   ylim(0, 7))
```

Scatterplot of continuous NO3_5yrPreCensor vs SS_5yrPreCensor
```{r, height=5, width=5}
(PM %>% ggplot(aes(x=NO3_5yrPreCensor, y=SS_5yrPreCensor, color=cohort))+
   geom_point(alpha=0.7)+
   labs(x="NO3 in 5yr Pre-Censoring", y="SS in the 1year Pre-Sampling", title="NO3 and SS Constituent Correlation")+
   theme(plot.title = element_text(hjust = 0.5))+     
   geom_smooth(method="lm", se = FALSE) +
   scale_color_manual(values=c("gold1", "steelblue1", "red"))+
   xlim(0, 4)+
   ylim(0, 3))
```

Scatterplot of continuous NO3_5yrPreCensor vs Soil_5yrPreCensor
```{r, height=5, width=5}
(PM %>% ggplot(aes(x=NO3_5yrPreCensor, y=Soil_5yrPreCensor, color=cohort))+
   geom_point(alpha=0.7)+
   labs(x="NO3 in 5yr Pre-Censoring", y="Soil in the 1year Pre-Sampling", title="NO3 and Soil Constituent Correlation")+
   theme(plot.title = element_text(hjust = 0.5))+     
   geom_smooth(method="lm", se = FALSE) +
   scale_color_manual(values=c("gold1", "steelblue1", "red"))+
   xlim(0, 4)+
   ylim(0, 2.5))
```

Scatterplot of continuous NH4_5yrPreCensor vs BC_5yrPreCensor
```{r, height=5, width=5}
(PM %>% ggplot(aes(x=NH4_5yrPreCensor, y=BC_5yrPreCensor, color=cohort))+
   geom_point(alpha=0.7)+
   labs(x="NH4 in 5yr Pre-Censoring", y="BC in the 1year Pre-Sampling", title="NH4 and BC Constituent Correlation")+
   theme(plot.title = element_text(hjust = 0.5))+     
   geom_smooth(method="lm", se = FALSE) +
   scale_color_manual(values=c("gold1", "steelblue1", "red"))+
   xlim(0, 2.5)+
   ylim(0, 1.75))
```

Scatterplot of continuous NH4_5yrPreCensor vs OM_5yrPreCensor
```{r, height=5, width=5}
(PM %>% ggplot(aes(x=NH4_5yrPreCensor, y=OM_5yrPreCensor, color=cohort))+
   geom_point(alpha=0.7)+
   labs(x="NH4 in 5yr Pre-Censoring", y="OM in the 1year Pre-Sampling", title="NH4 and OM Constituent Correlation")+
   theme(plot.title = element_text(hjust = 0.5))+     
   geom_smooth(method="lm", se = FALSE) +
   scale_color_manual(values=c("gold1", "steelblue1", "red"))+
   xlim(0, 2.5)+
   ylim(0, 7))
```

Scatterplot of continuous NH4_5yrPreCensor vs SS_5yrPreCensor
```{r, height=5, width=5}
(PM %>% ggplot(aes(x=NH4_5yrPreCensor, y=SS_5yrPreCensor, color=cohort))+
   geom_point(alpha=0.7)+
   labs(x="NH4 in 5yr Pre-Censoring", y="SS in the 1year Pre-Sampling", title="NH4 and SS Constituent Correlation")+
   theme(plot.title = element_text(hjust = 0.5))+     
   geom_smooth(method="lm", se = FALSE) +
   scale_color_manual(values=c("gold1", "steelblue1", "red"))+
   xlim(0, 2.5)+
   ylim(0, 3))
```

Scatterplot of continuous NH4_5yrPreCensor vs Soil_5yrPreCensor
```{r, height=5, width=5}
(PM %>% ggplot(aes(x=NH4_5yrPreCensor, y=Soil_5yrPreCensor, color=cohort))+
   geom_point(alpha=0.7)+
   labs(x="NH4 in 5yr Pre-Censoring", y="Soil in the 1year Pre-Sampling", title="NH4 and Soil Constituent Correlation")+
   theme(plot.title = element_text(hjust = 0.5))+     
   geom_smooth(method="lm", se = FALSE) +
   scale_color_manual(values=c("gold1", "steelblue1", "red"))+
   xlim(0, 2.5)+
   ylim(0, 2.5))
```



Scatterplot of continuous BC_5yrPreCensor vs OM_5yrPreCensor
```{r, height=5, width=5}
(PM %>% ggplot(aes(x=BC_5yrPreCensor, y=OM_5yrPreCensor, color=cohort))+
   geom_point(alpha=0.7)+
   labs(x="BC in 5yr Pre-Censoring", y="OM in the 1year Pre-Sampling", title="BC and OM Constituent Correlation")+
   theme(plot.title = element_text(hjust = 0.5))+     
   geom_smooth(method="lm", se = FALSE) +
   scale_color_manual(values=c("gold1", "steelblue1", "red"))+
   xlim(0, 1.75)+
   ylim(0, 7))
```

Scatterplot of continuous BC_5yrPreCensor vs SS_5yrPreCensor
```{r, height=5, width=5}
(PM %>% ggplot(aes(x=BC_5yrPreCensor, y=SS_5yrPreCensor, color=cohort))+
   geom_point(alpha=0.7)+
   labs(x="BC in 5yr Pre-Censoring", y="SS in the 1year Pre-Sampling", title="BC and SS Constituent Correlation")+
   theme(plot.title = element_text(hjust = 0.5))+     
   geom_smooth(method="lm", se = FALSE) +
   scale_color_manual(values=c("gold1", "steelblue1", "red"))+
   xlim(0, 1.75)+
   ylim(0, 3))
```

Scatterplot of continuous BC_5yrPreCensor vs Soil_5yrPreCensor
```{r, height=5, width=5}
(PM %>% ggplot(aes(x=BC_5yrPreCensor, y=Soil_5yrPreCensor, color=cohort))+
   geom_point(alpha=0.7)+
   labs(x="BC in 5yr Pre-Censoring", y="Soil in the 1year Pre-Sampling", title="BC and Soil Constituent Correlation")+
   theme(plot.title = element_text(hjust = 0.5))+     
   geom_smooth(method="lm", se = FALSE) +
   scale_color_manual(values=c("gold1", "steelblue1", "red"))+
   xlim(0, 1.75)+
   ylim(0, 2.5))
```


Scatterplot of continuous OM_5yrPreCensor vs SS_5yrPreCensor
```{r, height=5, width=5}
(PM %>% ggplot(aes(x=OM_5yrPreCensor, y=SS_5yrPreCensor, color=cohort))+
   geom_point(alpha=0.7)+
   labs(x="OM in 5yr Pre-Censoring", y="SS in the 1year Pre-Sampling", title="OM and SS Constituent Correlation")+
   theme(plot.title = element_text(hjust = 0.5))+     
   geom_smooth(method="lm", se = FALSE) +
   scale_color_manual(values=c("gold1", "steelblue1", "red"))+
   xlim(0, 7)+
   ylim(0, 3))
```

Scatterplot of continuous OM_5yrPreCensor vs Soil_5yrPreCensor
```{r, height=5, width=5}
(PM %>% ggplot(aes(x=OM_5yrPreCensor, y=Soil_5yrPreCensor, color=cohort))+
   geom_point(alpha=0.7)+
   labs(x="OM in 5yr Pre-Censoring", y="Soil in the 1year Pre-Sampling", title="OM and Soil Constituent Correlation")+
   theme(plot.title = element_text(hjust = 0.5))+     
   geom_smooth(method="lm", se = FALSE) +
   scale_color_manual(values=c("gold1", "steelblue1", "red"))+
   xlim(0, 7)+
   ylim(0, 2.5))
```

Scatterplot of continuous SS_5yrPreCensor vs Soil_5yrPreCensor
```{r, height=5, width=5}
(PM %>% ggplot(aes(x=SS_5yrPreCensor, y=Soil_5yrPreCensor, color=cohort))+
   geom_point(alpha=0.7)+
   labs(x="SS in 5yr Pre-Censoring", y="Soil in the 1year Pre-Sampling", title="SS and Soil Constituent Correlation")+
   theme(plot.title = element_text(hjust = 0.5))+     
   geom_smooth(method="lm", se = FALSE) +
   scale_color_manual(values=c("gold1", "steelblue1", "red"))+
   xlim(0, 3)+
   ylim(0, 2.5))
```



### Density Plots
Density plot of PM_5yrPreCensor
```{r, height=5, width=5}
(PM %>% ggplot(aes(x=PM_5yrPreCensor, color=cohort))+
   geom_density(alpha=0.7, aes(fill=cohort))+
   labs(x="PM2.5 in 5yr Pre-Censoring", y="Density of Patients with this PM2.5 Level", title="PM2.5 Density Plot")+
   theme(plot.title = element_text(hjust = 0.5))+
   scale_color_manual(values=c("gold1", "steelblue1", "red"))+
   scale_fill_manual(values=c("lightgoldenrod1", "skyblue1", "indianred1"))+
   xlim(2.5, 17))
```

Density plot of SO4_5yrPreCensor
```{r, height=5, width=5}
(PM %>% ggplot(aes(x=SO4_5yrPreCensor, color=cohort))+
   geom_density(alpha=0.7, aes(fill=cohort))+
   labs(x="SO4 in 5yr Pre-Censoring", y="Density of Patients with this SO4 Level", title="SO4 Density Plot")+
   theme(plot.title = element_text(hjust = 0.5))+
   scale_color_manual(values=c("gold1", "steelblue1", "red"))+
   scale_fill_manual(values=c("lightgoldenrod1", "skyblue1", "indianred1"))+
   xlim(0, 6.5))
```

Density plot of NO3_5yrPreCensor
```{r, height=5, width=5}
(PM %>% ggplot(aes(x=NO3_5yrPreCensor, color=cohort))+
   geom_density(alpha=0.7, aes(fill=cohort))+
   labs(x="NO3 in 5yr Pre-Censoring", y="Density of Patients with this NO3 Level", title="NO3 Density Plot")+
   theme(plot.title = element_text(hjust = 0.5))+
   scale_color_manual(values=c("gold1", "steelblue1", "red"))+
   scale_fill_manual(values=c("lightgoldenrod1", "skyblue1", "indianred1"))+
   xlim(0, 4))
```

Density plot of NH4_5yrPreCensor
```{r, height=5, width=5}
(PM %>% ggplot(aes(x=NH4_5yrPreCensor, color=cohort))+
   geom_density(alpha=0.7, aes(fill=cohort))+
   labs(x="NH4 in 5yr Pre-Censoring", y="Density of Patients with this NH4 Level", title="NH4 Density Plot")+
   theme(plot.title = element_text(hjust = 0.5))+
   scale_color_manual(values=c("gold1", "steelblue1", "red"))+
   scale_fill_manual(values=c("lightgoldenrod1", "skyblue1", "indianred1"))+
   xlim(0, 2.5))
```

Density plot of BC_5yrPreCensor
```{r, height=5, width=5}
(PM %>% ggplot(aes(x=BC_5yrPreCensor, color=cohort))+
   geom_density(alpha=0.7, aes(fill=cohort))+
   labs(x="BC in 5yr Pre-Censoring", y="Density of Patients with this BC Level", title="BC Density Plot")+
   theme(plot.title = element_text(hjust = 0.5))+
   scale_color_manual(values=c("gold1", "steelblue1", "red"))+
   scale_fill_manual(values=c("lightgoldenrod1", "skyblue1", "indianred1"))+
   xlim(0, 1.75))
```

Density plot of OM_5yrPreCensor
```{r, height=5, width=5}
(PM %>% ggplot(aes(x=OM_5yrPreCensor, color=cohort))+
   geom_density(alpha=0.7, aes(fill=cohort))+
   labs(x="OM in 5yr Pre-Censoring", y="Density of Patients with this OM Level", title="OM Density Plot")+
   theme(plot.title = element_text(hjust = 0.5))+
   scale_color_manual(values=c("gold1", "steelblue1", "red"))+
   scale_fill_manual(values=c("lightgoldenrod1", "skyblue1", "indianred1"))+
   xlim(0, 7))
```

Density plot of SS_5yrPreCensor
```{r, height=5, width=5}
(PM %>% ggplot(aes(x=SS_5yrPreCensor, color=cohort))+
   geom_density(alpha=0.7, aes(fill=cohort))+
   labs(x="SS in 5yr Pre-Censoring", y="Density of Patients with this SS Level", title="SS Density Plot")+
   theme(plot.title = element_text(hjust = 0.5))+
   scale_color_manual(values=c("gold1", "steelblue1", "red"))+
   scale_fill_manual(values=c("lightgoldenrod1", "skyblue1", "indianred1"))+
   xlim(0, 3))
```

Density plot of Soil_5yrPreCensor
```{r, height=5, width=5}
(PM %>% ggplot(aes(x=Soil_5yrPreCensor, color=cohort))+
   geom_density(alpha=0.7, aes(fill=cohort))+
   labs(x="Soil in 5yr Pre-Censoring", y="Density of Patients with this Soil Level", title="Soil Density Plot")+
   theme(plot.title = element_text(hjust = 0.5))+
   scale_color_manual(values=c("gold1", "steelblue1", "red"))+
   scale_fill_manual(values=c("lightgoldenrod1", "skyblue1", "indianred1"))+
   xlim(0, 2.5))
```



# Summary Data for Combined Cohorts
## Summary of pollutants
```{r}
summary(PM$PM_5yrPreDx)
summary(PM$PM_5yrPreCensor)
summary(PM$SO4_5yrPreDx)
summary(PM$SO4_5yrPreCensor)
summary(PM$NO3_5yrPreDx)
summary(PM$NO3_5yrPreCensor)
summary(PM$NH4_5yrPreDx)
summary(PM$NH4_5yrPreCensor)
summary(PM$BC_5yrPreDx)
summary(PM$BC_5yrPreCensor)
summary(PM$OM_5yrPreDx)
summary(PM$OM_5yrPreCensor)
summary(PM$SS_5yrPreDx)
summary(PM$SS_5yrPreCensor)
summary(PM$Soil_5yrPreDx)
summary(PM$Soil_5yrPreCensor)
```

## Diagnosis year
```{r}
summary(PM$dx_yr)
```

